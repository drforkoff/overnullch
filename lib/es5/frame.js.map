{"version":3,"sources":["../../babel/src/frame.js"],"names":["_WIKI","_SITENAME","main","parent","allReady","lazyBoy","init","$","ajaxSetup","dataType","on","jq","data","slideToggle","settings","onToggle","click","toggleBehavior","menu","toggle","_frames","layout","_","contains","behavior","open","chans","live","hasClass","attr","router","noFollow","fadeToggle","window","test","navigator","userAgent","injector","inject","makeEscapeTagLiteralFn","fn","v","strings","result","i","length","replace","rx","escapeRegExp","openMenu","close","closeMenu","_open","flatProps","assocProps","allProps","concat","forEach","propGroup","val","LSfetchJSON","param","isEmpty","getChanSpecificPreferences","chid","ret","prop","includes","handleCheck","$ch","toggleClass","find","each","href","push","without","save","toggleAssoc","catname","hasOwnProperty","key","props","localStorage","JSON","stringify","$el","is","match","deleteCategory","$cat","parents","hide","show","restoreCats","deletedCats","handleBoardClick","brd","handleLinkClick","addClass","handleHomeClick","a","removeClass","history","replaceState","own","id","wiki","boards","name","url","build","model","html","reduce","htm","ch","buildChan","insertWidgets","cssCache","lessCompiler","compile","rebuildChan","chan","findIndex","sync","assign","prefix","defaults","hasBoards","userboards","useAnonym","escape","colors","headOnly","showDirs","preventRouterRegistering","register","cats","widgets","supported","wiType","widgetType","widgetID","newWidget","userboards_system","userboards_catname","cachedUserboards","proceedUbrds","ubrds","normalizeUbrds","eq","updateUserboards","get","done","bind","fail","console","error","err","status","http_code","contents","hiddenChans","h","cat","buildCat","flat","catID","hidden","hiddenCats","hiddenCompletely","desc","board","dir","cleanURL","external","postfix","chansCache","fetchPromises","Promise","resolve","reject","getJSON","Date","getTime","origin","myDrafts","myDraftsValid","draft","version","catalogVersions","all","then","versMap","allChans","changed","sect","ver","filter","section","map","remove","warn","removeItem","info","chg","versions","replaceWith","document","querySelectorAll","wph","getAttribute","pool","widget","parentNode","replaceChild","el","instant","postcount","parse","e","res","idClassEscaped","advanced_less","base","less","render","output","css","NodeList","prototype","Array","alias","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","removeChild","radio","streams","currentStream","saved","volume","stream","$_name","template","$_path","path","mixedRange","n","mime","audio","appendTo","playPause","onloadeddata","$selectWrapper","options","ix","setStream","append","change","value","addJob","$volumeter","buildVolumeter","reflectVolumeChange","setV","setVolume","onCategoryClose","paused","streamID","playing","setAttribute","play","force","networkState","pause","width","height","onchange","baseV","evToVal","ev","down","pageX","$vm","offset","left","buildSVG","cns","createElementNS","tag","svg","classList","add","cls","poly","bg","fg","$w","mousedown","mousemove","input","m","re","exec","index","lastIndex","range","exp","RegExp","split","flatten","currentHash","determineIdentity","guro","indicateOn","$chan","isOWN","title","decodeURIComponent","$brd","text","event","script_installed","scriptInstalled","frames","location","protocol","host","identity","follow","hash","clearHash","load","execute","que","ready","splice","job","addEventListener","pathname","postMessage","check3d","getComputedStyle","has3d","transforms","t","body","insertBefore","getPropertyValue","transform","update","showForm","scheduleUpdate","textStatus","jqXHR","currentList","responseText","onoff","link","buildLink","description","getDomainName","toggleShare","focus","ms","clearInterval","interval","setInterval"],"mappings":"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","file":"frame.js","sourcesContent":["\"use strict\"\r\n\r\nconst _WIKI = 'http://wiki.1chan.ca/'\r\n, _SITENAME = \"Овернульч\"\r\n\r\nfunction main() {\r\n  parent.allReady()\r\n\r\n  lazyBoy.init()\r\n\r\n  $.ajaxSetup({ dataType: 'json' })\r\n\r\n  // Colorization mode selector\r\n  $('body')\r\n  .on('click', '.toggler', function() {\r\n    $(jq`#${$(this).data('toggle')}`).slideToggle('fast', function() {\r\n      settings.onToggle($(this))\r\n    })\r\n  })\r\n  \r\n\r\n  $('#pinunpin').click(parent.toggleBehavior)\r\n\r\n  $('.menu-toggle').click(menu.toggle)\r\n  $('#menu-show').on('mouseenter', function() {\r\n    if(parent._frames.layout == 'vertical' && _.contains(['overlay', 'shift'], parent._frames.behavior)) {\r\n      menu.open()\r\n    }\r\n  })\r\n\r\n  settings.init()\r\n  chans.init()\r\n  live.init()\r\n\r\n  $('#refresh').click(function() {\r\n    if ($(this).hasClass('script-installed')) {\r\n      parent.$('#main').attr('src', router.noFollow)\r\n    }\r\n    else {\r\n      $('#noscript-warning').fadeToggle('fast')\r\n    }\r\n  })\r\n\r\n  if (('netscape' in window) && / rv:/.test(navigator.userAgent)) {\r\n    injector.inject('no-shadow-for-you', `.showlive #live-toggle svg, #live-panel svg {filter: none!important; -webkit-filter: none!important;}`)\r\n  }\r\n}\r\n\r\n// Produces a function which applies fn() to all values\r\nfunction makeEscapeTagLiteralFn(fn = v => v) {\r\n  return function(strings, ...values) {\r\n    let result = \"\"\r\n    for (let i = 0; i < strings.length; i++) {\r\n      result += strings[i]\r\n      if (i < values.length) {\r\n        result += fn(''+values[i])\r\n      }\r\n    }\r\n    return result\r\n  }\r\n}\r\n// Escape tag literal functions for jQuery queries and regular expressions\r\nvar jq = makeEscapeTagLiteralFn(v => v.replace(/([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^`{|}~ ])/g, \"\\\\$1\"))\r\n, rx = makeEscapeTagLiteralFn(_.escapeRegExp)\r\n\r\nvar menu = {\r\n  open: function() {\r\n    parent.openMenu()\r\n  },\r\n  close: function() {\r\n    parent.closeMenu()\r\n  },\r\n  toggle: function() {\r\n    if(parent._open) menu.close()\r\n    else menu.open()\r\n  }\r\n}\r\n\r\nvar settings = {\r\n  flatProps: ['hiddenChans', 'showDirs', 'useAnonym', 'headOnly'],\r\n  assocProps: ['hiddenCats', 'deletedCats', 'cachedUserboards'],\r\n  init: function() {\r\n    this.allProps = this.flatProps.concat(this.assocProps)\r\n    ;['flatProps', 'assocProps'].forEach((propGroup) => {\r\n      this[propGroup].forEach(param => {\r\n        let val = LSfetchJSON(param)\r\n        this[param] = _.isEmpty(val) ? (propGroup==='flatProps' ? [] : {}) : val\r\n      })\r\n    })\r\n  },\r\n  getChanSpecificPreferences: function(chid) {\r\n    let ret = {}\r\n    this.flatProps.forEach(prop => {\r\n      ret[prop] = !!_.includes(this[prop], chid)\r\n    })\r\n    this.assocProps.forEach(prop => {\r\n      ret[prop] = this[prop][chid] || []\r\n    })\r\n    return ret\r\n  },\r\n  handleCheck: function(prop, chid) {\r\n    let on = !_.includes(this[prop], chid)\r\n\r\n    let $ch = $(jq`.chan_${chid}`)\r\n    if (prop === 'showDirs' || prop === 'headOnly') {\r\n      $ch.toggleClass(prop, !!on)\r\n    }\r\n    if (prop === 'useAnonym') {\r\n      $ch.find('a[data-href]').each(function() {\r\n        let href = (on ? 'http://anonym.to?' : '') + $(this).data('href')\r\n        $(this).attr('href', href)\r\n      })\r\n    }\r\n\r\n    this.toggle(chid, prop, on)\r\n\r\n    return false\r\n  },\r\n  toggle: function(chid, prop, on) {\r\n    if (!on) {\r\n      this[prop] = _.without(this[prop], chid)\r\n    }\r\n    else {\r\n      this[prop].push(chid)\r\n    }\r\n    this.save()\r\n  },\r\n  toggleAssoc: function(prop, chid, catname, on) {\r\n    if (! this[prop].hasOwnProperty(chid)) {\r\n      if (on) {\r\n        this[prop][chid] = [catname]\r\n      }\r\n    }\r\n    else {\r\n      if (on) {\r\n        this[prop][chid].push(catname)\r\n      }\r\n      else {\r\n        this[prop][chid] = _.without(this[prop][chid], catname)\r\n      }\r\n    }\r\n    this.save()\r\n    return this[prop][chid].length\r\n  },\r\n  save: function(key) {\r\n    let props = key ? [key] : this.allProps\r\n    props.forEach(prop => localStorage[prop] = JSON.stringify(this[prop]))\r\n  },\r\n  onToggle: function($el) {\r\n    let on = $el.is(':visible')\r\n    if ($el.hasClass('boards')) {\r\n      let chid = $el.attr('id').match(/^boards_(.+)/)[1]\r\n      this.toggle(chid, 'hiddenChans', !on)\r\n    }\r\n    if ($el.hasClass('cat-boards')) {\r\n      this.toggleAssoc('hiddenCats', $el.data('chid'), $el.data('catname'), !on)\r\n    }\r\n  },\r\n  deleteCategory: function(chid, catname) {\r\n    let $cat = $(jq`#cat_${chid}_${catname}`).parents('.category')\r\n    $cat.hide()\r\n    this.toggleAssoc('deletedCats', chid, catname, true)\r\n    $cat.parents('.chan').find('.restore-cats').show()\r\n  },\r\n  restoreCats: function(chid) {\r\n    let $ch = $(jq`.chan_${chid}`)\r\n    $ch.find('.category').show()\r\n    $ch.find('.restore-cats').hide()\r\n    if (this.deletedCats.hasOwnProperty(chid)) {\r\n      this.deletedCats[chid] = []\r\n      this.save()\r\n    }\r\n  }\r\n}\r\n\r\nfunction handleBoardClick(brd) {\r\n  handleLinkClick(brd)\r\n  $(brd).addClass('boardover').parents('.chan').addClass('onchan')\r\n}\r\n\r\nfunction handleHomeClick(a) {\r\n  handleLinkClick(a)\r\n  $(a).parents('.chan').addClass('onchan')\r\n}\r\n\r\nfunction handleLinkClick(a) {\r\n  $('.boardover').removeClass('boardover')\r\n  $('.onchan').removeClass('onchan')\r\n  if(parent._frames.layout == 'horizontal') {\r\n    menu.close()\r\n  }\r\n  parent.history.replaceState(null, null, `/#/${a.href}`);\r\n}\r\n\r\nvar chans = {\r\n  own: {\r\n    own: true,\r\n    id: '!OWN',\r\n    wiki: 'Овернульч',\r\n    boards: [\r\n      {\r\n        \"name\": \"\",\r\n        \"boards\": [\r\n          {\r\n            \"desc\": \"Метадоска\",\r\n            \"dir\": \"meta\"\r\n          },\r\n          {\r\n            \"desc\": \"Каталог сайтов\",\r\n            \"dir\": \"catalog\"\r\n          },\r\n          {\r\n            \"desc\": \"Редактор сайтов\",\r\n            \"dir\": \"editor\"\r\n          },\r\n          {\r\n            \"desc\": \"Ballsmash\",\r\n            \"dir\": \"mash\"\r\n          }/*,\r\n          {\r\n            \"desc\": \"Библиотека лупов\",\r\n            \"dir\": \"loops\"\r\n          }*/\r\n        ]\r\n      }\r\n    ],\r\n    // colors:[\"aaaaaa\",\"bbbbbb\"],\r\n    name: \"Овернульч\",\r\n    url: 'http://0chan.one'\r\n  },\r\n  build: function(chans) {\r\n    this.model = chans\r\n    $('#content').html([this.own].concat(chans).reduce((htm, ch) => htm + this.buildChan(ch), ''))\r\n    this.insertWidgets()\r\n    let cssCache = localStorage['compiledCSS']\r\n    if (cssCache) {\r\n      injector.inject('framestyles', cssCache)\r\n    }\r\n    else {\r\n      lessCompiler.compile(this.model.concat(this.own))\r\n    }\r\n  },\r\n  rebuildChan: function(chan) {\r\n    this.model[_.findIndex(this.model, {id: chan.id})] = chan\r\n    $(jq`.chan_${chan.id}`).html(this.buildChan(chan))\r\n    this.insertWidgets()\r\n    this.sync()\r\n  },\r\n  buildChan: function(chan) {\r\n    _.assign(chan, settings.getChanSpecificPreferences(chan.id))\r\n    if (! (chan.wiki && chan.wiki.match(/https?:\\/\\//))) {\r\n      chan.wiki = _WIKI+(chan.wiki || chan.name)\r\n    }\r\n    if (chan.prefix === '') {\r\n      delete chan.prefix\r\n    }\r\n    _.defaults(chan, this.defaults)\r\n\r\n    let hasBoards = (chan.boards && chan.boards.length) || chan.userboards\r\n    , url = chan.own ? `${chan.url}/index.html` : (((!chan.own && chan.useAnonym) ? 'http://anonym.to?' : '') + chan.url)\r\n    , name = _.escape(chan.name)\r\n    , htm = html`\r\n    <div class=\"chan chan_${chan.id}${!chan.colors ? ' uncolorized' : ''}${chan.headOnly ? ' headOnly' : ''}${chan.showDirs ? ' showDirs' : ''}${!hasBoards ? ' no-boards' : ''}\">\r\n      <a onclick=\"handleHomeClick(this)\" target=\"main\" href=\"${url}\" class=\"chan-header head-link\" data-href=\"${chan.url}\"${chan.own ? ' onclick=\"router.clearHash()\"' : ''}>\r\n        <div class=\"chan-name\">${name}</div>\r\n      </a>\r\n      <div class=\"chan-header\">\r\n        <div class=\"chan-name toggler\" data-toggle=\"boards_${chan.id}\">${name}</div>\r\n      </div>\r\n      <div class=\"chan-overlay chan-overlay-left\">\r\n        ${hasBoards ? html`<a onclick=\"handleHomeClick(this)\" class=\"iconic-link home-link\" target=\"main\" href=\"${url}\" data-href=\"${chan.url}\" title=\"Домашняя страница\"${chan.own ? ' onclick=\"router.clearHash()\"' : ''}>\r\n          <svg class=\"icon\"><use xlink:href=\"#i-home\"></use></svg>\r\n        </a>` : ''}\r\n        <a class=\"iconic-link\" target=\"main\" href=\"${chan.wiki}\" title=\"Информация на вики\">\r\n          <svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg>\r\n        </a>\r\n      </div>\r\n      <div class=\"chan-overlay chan-overlay-right\">\r\n        <button class=\"toggler\" data-toggle=\"settings_${chan.id}\" title=\"Меню сайта\">\r\n          <svg class=\"icon\"><use xlink:href=\"#i-dots\"></use></svg>\r\n        </button>\r\n      </div>\r\n      <div class=\"chan-menu\" style=\"display:none\" id=\"settings_${chan.id}\">\r\n        <div class=\"settings-entry ifnoboards-hide\">\r\n          <label for=\"showdirs_${chan.id}\">\r\n          <input type=\"checkbox\" id=\"showdirs_${chan.id}\" ${chan.showDirs ? 'checked' : ''} onchange=\"settings.handleCheck('showDirs', '${chan.id}')\">\r\n          <span>Показывать директории</span>\r\n          </label>\r\n        </div>\r\n        <div class=\"settings-entry ifnoboards-hide\">\r\n          <label for=\"headonly_${chan.id}\">\r\n          <input type=\"checkbox\" id=\"headonly_${chan.id}\" ${chan.headOnly ? 'checked' : ''} onchange=\"settings.handleCheck('headOnly', '${chan.id}')\">\r\n          <span>Скрыть доски</span>\r\n          </label>\r\n        </div>\r\n        ${!chan.own ? \r\n        html`<div class=\"settings-entry\">\r\n          <label for=\"useanonym_${chan.id}\">\r\n          <input type=\"checkbox\" id=\"useanonym_${chan.id}\" ${chan.useAnonym ? 'checked' : ''} onchange=\"settings.handleCheck('useAnonym', '${chan.id}')\">\r\n          <span>Использовать anonym.to</span>\r\n          </label>\r\n        </div>\r\n        <div class=\"settings-entry restore-cats\" ${chan.deletedCats.length ? '' : 'style=\"display:none\"'}>\r\n          <button class=\"trash-btn\" onclick=\"settings.restoreCats('${chan.id}')\">\r\n            <svg class=\"icon\">\r\n              <use class=\"i-trash\" xlink:href=\"#i-trash\"></use>\r\n              <use class=\"i-trash-open\" xlink:href=\"#i-trash-open\"></use>\r\n            </svg>\r\n            <span>Восстановить категории</span>\r\n          </button>\r\n        </div>\r\n        <div class=\"settings-entry\">\r\n          <button onclick=\"chans.remove('${chan.id}')\">\r\n            <svg class=\"icon\"><use xlink:href=\"#i-delete\"></use></svg>\r\n            <span>Удалить из фрейма</span>\r\n          </button>\r\n        </div>` : ''}\r\n      </div>`\r\n\r\n    if (!this.preventRouterRegistering) {\r\n    \trouter.register(chan)\r\n    }\r\n\r\n    let cats = chan.boards\r\n\r\n    widgets.supported.forEach(wiType => {\r\n      if (chan.hasOwnProperty(wiType)) {\r\n        cats = [{\r\n          name: widgets[wiType].name,\r\n          widgetType: wiType,\r\n          widgetID: widgets[wiType].newWidget(chan[wiType], chan.id)\r\n        }].concat(cats)\r\n      }\r\n    })\r\n\r\n    if (chan.userboards) {\r\n      if (!chan.userboards_system) {\r\n        chan.userboards_system = 'instant'\r\n      }\r\n\r\n      cats = [{\r\n        name: chan.userboards_catname,\r\n        boards: chan.cachedUserboards,\r\n        userboards: true\r\n      }].concat(cats)\r\n\r\n      let proceedUbrds = data => {\r\n        let ubrds = normalizeUbrds[chan.userboards_system](data)\r\n        if (! _.eq(chan.cachedUserboards, ubrds)) {\r\n          this.updateUserboards(chan, ubrds)\r\n        }\r\n      }\r\n\r\n      $.get(chan.userboards)\r\n      .done(proceedUbrds.bind(this))\r\n      .fail(err => {\r\n        console.error(err)\r\n        $.get(`/cors-proxy.php?url=${chan.userboards}`)\r\n        .done(data => {\r\n          if(data.status.http_code == 200) {\r\n            proceedUbrds(data.contents)\r\n          }\r\n        })\r\n        .fail(function(err) {\r\n          console.error(err)\r\n        })\r\n      })\r\n    }\r\n\r\n    if (cats && cats.length) {\r\n      htm += `<div class=\"boards\" id=\"boards_${chan.id}\" ${chan.hiddenChans ? 'style=\"display:none\"' : ''}>`\r\n      + cats.reduce((h, cat) => h + this.buildCat(chan, cat, !(cats.length > 1)), '')\r\n      + '</div>'\r\n    }\r\n\r\n    htm += `</div>`\r\n\r\n    return htm\r\n  },\r\n  buildCat: function(chan, cat, flat) {\r\n    cat.name = _.escape(cat.name).replace(' ', ' ')\r\n    let catID = cat.widgetType ? `!${cat.widgetType}` : cat.name\r\n    , hidden = _.includes(chan.hiddenCats, catID)\r\n    , hasBoards = (cat.boards && cat.boards.length)\r\n    , hide = ' style=\"display:none\"'\r\n    , hiddenCompletely = (!cat.widgetID && !hasBoards) || _.includes(chan.deletedCats, catID)\r\n    , htm = `<div class=\"category${cat.userboards ? ' userboards' : ''}\"${hiddenCompletely ? hide : ''}${cat.widgetID ? ` data-widget=\"${cat.widgetID}\"` : ''}>`\r\n    if (!flat) {\r\n      htm += html`\r\n      <div class=\"cat-header toggler\" data-toggle=\"cat_${chan.id}_${catID}\">\r\n        <div class=\"ch-name\">${cat.name}</div>\r\n        <div class=\"cat-options\">\r\n          <svg class=\"icon i-delete del-cat\" onclick=\"event.stopPropagation();settings.deleteCategory('${chan.id}', '${catID}')\"><use xlink:href=\"#i-delete\"></use></svg>\r\n        </div>\r\n      </div>`\r\n    }\r\n    if (hasBoards || cat.widgetID) {\r\n      htm += `<div class=\"cat-boards\"${hidden ? hide : ''}${!flat ? ` id=\"cat_${chan.id}_${catID}\" data-chid=\"${chan.id}\" data-catname=\"${catID}\"` : ''}>`\r\n    }\r\n    if (hasBoards) {\r\n      cat.boards.forEach(board => {\r\n        let desc = _.escape(board.desc)\r\n        , dir = _.escape(board.dir)\r\n        , cleanURL = board.external ? board.url : (chan.url + chan.prefix + dir + chan.postfix)\r\n        , url = (chan.useAnonym ? 'http://anonym.to?' : '') + cleanURL\r\n        htm += html`\r\n        <a target=\"main\" href=\"${url}\" class=\"board${board.external ? ' external' : ''}\" data-href=\"${cleanURL}\" data-dir=\"${dir}\" onclick=\"handleLinkClick(this)\">\r\n          ${board.external ? '' : `<span class=\"board-dir\">/${dir}/ - </span>`}<span class=\"board-name\">${desc}</span>\r\n        </a>`\r\n      })\r\n      htm += '</div>'\r\n    }\r\n    if(cat.widgetID) {\r\n      htm += `<div class=\"widget-placeholder\" id=\"${cat.widgetID}\"></div></div>` // /.widget-placeholder /.cat-boards\r\n    }\r\n    \r\n    htm += `</div>` // /.category\r\n\r\n    return htm\r\n  },\r\n  defaults: {\r\n    userboards_catname: '2.0',\r\n    prefix: '/',\r\n    postfix: ''\r\n  },\r\n  init: function() {\r\n    // Build frame from cache\r\n    let chansCache = LSfetchJSON('myChans_new')\r\n    if (chansCache) {\r\n      // Style frame from cache\r\n      this.build(chansCache)\r\n    }\r\n    // Get some fress JSON\r\n    let fetchPromises = [new Promise((resolve, reject) => {\r\n      $.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\r\n      .done(data => {\r\n        data.origin = 'server'\r\n        resolve(data)\r\n      })\r\n      .fail(reject)\r\n    })]\r\n    let myDrafts = LSfetchJSON('mydrafts')\r\n    if (myDrafts && myDrafts.chans) {\r\n      fetchPromises.push(new Promise((resolve, reject) => {\r\n        let myDraftsValid = []\r\n        myDrafts.chans.forEach(draft => {\r\n          if (draft.name && draft.url) {\r\n            draft.id = `${draft.id}!draft`\r\n            myDraftsValid.push(draft)\r\n          }\r\n        })\r\n        resolve({\r\n          origin: 'drafts',\r\n          chans: myDraftsValid,\r\n          version: myDrafts.version || 'unknown'\r\n        })\r\n      }))\r\n    }\r\n    // Versions from the last update\r\n    let catalogVersions = LSfetchJSON('catalogVersions')\r\n    Promise.all(fetchPromises).then(data => {\r\n      let versMap = {}\r\n      , allChans = []\r\n      , changed = []\r\n      data.forEach(sect => {\r\n        versMap[sect.origin] = sect.version\r\n        allChans = allChans.concat(sect.chans)\r\n        let ver = catalogVersions ? (+catalogVersions[sect.origin] || null) : null\r\n        if (chansCache && chansCache.length) {\r\n          // Check if data for currect origin is newer\r\n          if (ver !== +sect.version) {\r\n            changed.push({\r\n              origin: sect.origin,\r\n              version: sect.version\r\n            })\r\n            let filter = sect.origin == 'drafts' ? {section: 'drafts'} : (i => (i.section == 'default' || i.section == 'custom'))\r\n            // Update all installed chans\r\n            _.map(_.filter(chansCache, filter), 'id').forEach(id => {\r\n              let ch = _.find(sect.chans, {id: id})\r\n              if (ch) {\r\n                this.rebuildChan(ch)\r\n              }\r\n              else {\r\n                this.remove(id)\r\n                console.warn(`Removed unknown chan #${id} from frame`)\r\n              }\r\n            })\r\n          }\r\n        }\r\n      })\r\n      // Register chans in router to properly display name\r\n      allChans.forEach(router.register.bind(router))\r\n      this.preventRouterRegistering = true\r\n\r\n      if (!(chansCache && chansCache.length)) {\r\n        localStorage.removeItem('compiledCSS')\r\n        this.build(_.filter(allChans, 'included'))\r\n      }\r\n      if (changed.length) {\r\n        // Restyle chans if needed\r\n        lessCompiler.compile(this.model.concat(this.own))\r\n        changed.forEach(chg => {\r\n          console.info(`Updated ${chg.origin}-originated chans' cache to v.=${chg.version}`)\r\n        })\r\n      }\r\n      this.versions = versMap\r\n      this.sync()\r\n    })\r\n  },\r\n  preventRouterRegistering: false,\r\n  remove: function(chid) {\r\n    _.remove(this.model, {id: chid})\r\n    $(jq`.chan_${chid}`).remove()\r\n    this.sync()\r\n    return false\r\n  },\r\n  updateUserboards: function(chan, boards) {\r\n    let cat = {\r\n      name: chan.userboards_catname,\r\n      boards: boards,\r\n      userboards: true\r\n    }\r\n    $(jq`.chan_${chan.id} .userboards`).replaceWith(this.buildCat(chan, cat, false))\r\n    settings.cachedUserboards[chan.id] = boards\r\n    settings.save('cachedUserboards')\r\n  },\r\n  sync: function() {\r\n    _.each(this.model, ch => delete ch.cachedUserboards)\r\n    localStorage['catalogVersions'] = JSON.stringify(this.versions)\r\n    localStorage['myChans_new'] = JSON.stringify(this.model)\r\n  },\r\n  insertWidgets: function() {\r\n    document.querySelectorAll('.widget-placeholder').forEach(wph => {\r\n      let widgetID = wph.getAttribute('id')\r\n      if(widgets.pool.hasOwnProperty(widgetID)) {\r\n        let widget = widgets.pool[widgetID]\r\n        wph.parentNode.replaceChild(widget.el, wph)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nvar normalizeUbrds = {\r\n  instant: data => data.map(brd => {\r\n    if (brd.name) {\r\n      brd.dir = brd.name\r\n    }\r\n    delete brd.postcount\r\n    delete brd.name\r\n    return brd\r\n  }),\r\n  '0chan': data => data.boards.map(brd => {\r\n    brd.desc = brd.name\r\n    delete brd.name\r\n    return brd\r\n  })\r\n}\r\n\r\nfunction LSfetchJSON(key) {\r\n  let val = null, data = localStorage[key]\r\n  if (typeof data !== 'undefined') {\r\n    try {\r\n      val = JSON.parse(data)\r\n    }\r\n    catch(e) {\r\n      console.error(e)\r\n      localStorage.removeItem(key)\r\n    }\r\n  }\r\n  return val\r\n}\r\n\r\nvar lessCompiler = {\r\n  compile: function(chans) {\r\n    let res = ''\r\n    chans.forEach(ch => {\r\n      if (ch.colors) {\r\n        let idClassEscaped = ('chan_'+ch.id).replace('!', '\\\\!')\r\n        res += `.${idClassEscaped} { \r\n          @bgcolor: #${ch.colors[0]};  @linkcolor: #${ch.colors[1]}; `\r\n          + (ch.advanced_less || this.base) + '}\\n\\n'\r\n      }\r\n    })\r\n    less.render(res, (err, output) => {\r\n      if (err) {\r\n        console.error(err)\r\n      }\r\n      else {\r\n        localStorage['compiledCSS'] = output.css\r\n        injector.inject('framestyles', output.css)\r\n      }\r\n    })\r\n  },\r\n  base: \"background: @bgcolor; a, .chan-overlay .icon { color: @linkcolor; } &:hover { background: darken(@bgcolor, 8%); } &.onchan { box-shadow: inset -2px 0 fadeout(@linkcolor, 25%); } & when (lightness(@bgcolor) < 70%) { color: #C3C3C3; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: white; } .board:hover { background: rgba(255, 255, 255, .08); } } & when (lightness(@bgcolor) > 70%) { color: #404040; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: black; } .board:hover { background: rgba(0, 0, 0, .08); } }\"\r\n}\r\n\r\nNodeList.prototype.forEach = Array.prototype.forEach\r\n// NodeList.prototype.map = Array.prototype.map\r\n\r\nvar injector = {\r\n  inject: function(alias, css) {\r\n    var id = `injector:${alias}`\r\n    var existing = document.getElementById(id)\r\n    if (existing) {\r\n      existing.innerHTML = css\r\n      return\r\n    }\r\n    var head = document.head || document.getElementsByTagName('head')[0]\r\n    , style = document.createElement('style')\r\n    style.type = 'text/css'\r\n    style.id = id\r\n    if (style.styleSheet) {\r\n      style.styleSheet.cssText = css\r\n    } else {\r\n      style.appendChild(document.createTextNode(css))\r\n    }\r\n    head.appendChild(style)\r\n  },\r\n  remove: function(alias) {\r\n    var id = `injector:${alias}`\r\n    var style = document.getElementById(id)\r\n    if (style) {\r\n      var head = document.head || document.getElementsByTagName('head')[0]\r\n      if (head)\r\n        head.removeChild(document.getElementById(id))\r\n    }\r\n  }\r\n}\r\n\r\nvar widgets = {\r\n  pool: {},\r\n  supported: ['radio']\r\n}\r\nwidgets.radio = {\r\n  name: \"Радио\",\r\n  newWidget: function(props, id) {\r\n    var widget = {\r\n      streams: [],\r\n      currentStream: null,\r\n      url: props.url, \r\n      $el: $(`<div class=\"radio-widget disabled\"></div>`)\r\n    }\r\n\r\n    var saved = {\r\n      volume: +(localStorage[`radio_${id}_volume`] || 1),\r\n      stream: +(localStorage[`radio_${id}_streamid`] || 0),\r\n    }\r\n\r\n    props.streams.forEach(stream => {\r\n      if(stream.hasOwnProperty('n')) {\r\n        var $_name = _.template(stream.name)\r\n        , $_path = _.template(stream.path)\r\n        this.mixedRange(stream.n).forEach(n => {\r\n          widget.streams.push({\r\n            name: $_name({n: n}),\r\n            path: $_path({n: n}),\r\n            mime: stream.mime\r\n          })\r\n        })\r\n      }\r\n      else\r\n        widget.streams.push(stream)\r\n    })\r\n\r\n    widget.audio = $('<audio controls>')\r\n    .appendTo(widget.$el)[0]\r\n    widget.playPause = this.playPause.bind(widget)\r\n    widget.audio.volume = saved.volume\r\n    widget.audio.onloadeddata = () => widget.$el.removeClass('disabled')\r\n\r\n    $(html`<div class=\"rw-playpause\">\r\n      <div class=\"pause-icon\"></div>\r\n      <div class=\"play-icon\"></div>\r\n    </div>`)\r\n    .appendTo(widget.$el)\r\n    .click(widget.playPause)\r\n\r\n    var $selectWrapper = $('<div class=\"select-wrapper\">')\r\n    var options = []\r\n    widget.streams.forEach((stream, ix) => {\r\n      options.push(`<option value=\"${ix}\">${stream.name}</option>`)\r\n    })\r\n    widget.setStream = this.setStream.bind(widget)\r\n    $('<select>')\r\n    .append(options)\r\n    .val(saved.stream)\r\n    .change(function() {\r\n      widget.setStream(+this.value)\r\n      localStorage[`radio_${id}_streamid`] = +this.value\r\n    })\r\n    .appendTo($selectWrapper)\r\n    $selectWrapper.appendTo(widget.$el)\r\n    \r\n    lazyBoy.addJob(() => widget.setStream(saved.stream))\r\n \r\n    var $volumeter = this.buildVolumeter(id, 70, 20, v => {\r\n       widget.audio.volume = v\r\n       localStorage[`radio_${id}_volume`] = v\r\n    }, saved.volume)\r\n    widget.$el.append($volumeter)\r\n    widget.reflectVolumeChange = $volumeter.setV\r\n    widget.setVolume = this.setVolume.bind(widget)\r\n\r\n    widget.onCategoryClose = () => {\r\n      if(!widget.audio.paused)\r\n        widget.playPause()\r\n    }\r\n\r\n    widget.el = widget.$el[0]\r\n    widgets.pool[`radio_${id}`] = widget\r\n    return `radio_${id}`\r\n  },\r\n  all: {},\r\n  setStream: function(streamID, play) {\r\n    if(this.currentStream === streamID)\r\n      return\r\n    var stream = this.streams[streamID]\r\n    , playing = !this.audio.paused\r\n    this.audio.setAttribute('src', this.url + stream.path)\r\n    this.audio.setAttribute('type', stream.mime)\r\n    if(playing)\r\n      this.audio.play()\r\n  },\r\n  setVolume: function(v) {\r\n    this.audio.volume = v\r\n    this.reflectVolumeChange(v)\r\n  },\r\n  playPause: function(force) {\r\n    force = force || null\r\n    if(this.audio.networkState == 3) {\r\n      this.audio.pause()\r\n      this.$el.removeClass('streaming')\r\n    }\r\n    else if(this.audio.paused) {\r\n      $('.radio-widget audio').each(function() {\r\n        this.pause()\r\n      })\r\n      this.audio.play()\r\n      this.$el.addClass('streaming')\r\n    }\r\n    else {\r\n      this.audio.pause()\r\n      this.$el.removeClass('streaming')\r\n    }\r\n  },\r\n  buildVolumeter: function(id, width, height, onchange, baseV) {\r\n    baseV = baseV || 1\r\n\r\n    var $vm = $('<div class=\"volumeter\">')\r\n\r\n    var buildSVG = cls => {\r\n      var cns = tag => document.createElementNS(\"http://www.w3.org/2000/svg\", tag)\r\n\r\n      var svg = cns('svg')\r\n      svg.setAttribute('width', width)\r\n      svg.setAttribute('height', height)\r\n      svg.setAttribute('viewBox', `0 0 ${width} ${height}`)\r\n      svg.classList.add(cls)\r\n\r\n      var poly = cns('polygon')\r\n      poly.setAttribute('points', `0,${height} ${width},0 ${width},${height}`)\r\n      svg.appendChild(poly)\r\n\r\n      return svg\r\n    }\r\n\r\n    var bg = buildSVG('vm-bg')\r\n    , fg = buildSVG('vm-fg')\r\n\r\n    var $w = $('<div class=\"vm-fg-wrapper\">')\r\n    $w[0].appendChild(fg)\r\n\r\n    $vm.append($w)\r\n    $vm[0].appendChild(bg)\r\n\r\n    $vm.setV = val => $w.css({width: `${val * width}px`})\r\n    $vm.setV(baseV)\r\n\r\n    var down = false\r\n\r\n    function evToVal(ev) {\r\n      if(down) {\r\n        var val = (ev.pageX - $vm.offset().left) / width\r\n        if(val < 0) val = 0\r\n        if(val > 1) val = 1\r\n        $vm.setV(val)\r\n        if(onchange) \r\n          onchange(val)\r\n      }\r\n    }\r\n\r\n    $vm.mousedown(function(ev) {\r\n      down = true\r\n      evToVal(ev)\r\n    })\r\n    \r\n    $('body')\r\n    .mousemove(evToVal)\r\n    .on('mouseup mouseleave blur', ev => {\r\n      down = false\r\n    })\r\n\r\n    return $vm\r\n  },\r\n  mixedRange: function(input) {\r\n    var m\r\n    , output = []\r\n    , re = /(?:([0-9]+)(?:\\-([0-9]+))?(?:, ?)?)/g\r\n    \r\n    while ((m = re.exec(input)) !== null) {\r\n      if (m.index === re.lastIndex) {\r\n        re.lastIndex++\r\n      }\r\n      if(m[2]) {\r\n        output = output.concat(_.range(m[1], +m[2]+1))\r\n      }\r\n      else\r\n        output.push(+m[1])\r\n    }\r\n\r\n    return output\r\n  }\r\n}\r\n\r\nvar router = {\r\n  chans: {},\r\n  register: function(chan) {\r\n    this.chans[chan.id] = {\r\n      exp: new RegExp(rx`^(https?:\\/\\/${chan.url.split(/^https?:\\/\\//)[1] || chan.url})(?:${chan.prefix || chans.defaults.prefix}([^\\/\\?#]+))?`),\r\n      name: chan.name,\r\n      boards: _.flatten(_.map(chan.boards, 'boards'))\r\n    }\r\n  },\r\n  currentHash: '',\r\n  determineIdentity: function(url) {\r\n    let result = null\r\n    // console.log('router.chans:', this.chans)\r\n    _.find(this.chans, (chan, chid) => {\r\n      // console.log(`Checking ${chid}...`)\r\n      let guro = chan.exp.exec(url)\r\n      if (guro !== null) {\r\n        let dir = guro[2] || null\r\n        result = {\r\n          id: chid,\r\n          name: chan.name\r\n        }\r\n        if (dir) {\r\n          result.dir = dir\r\n          let brd = _.find(chan.boards, {dir: dir})\r\n          if (brd) {\r\n            result.desc = brd.desc\r\n          }\r\n        }\r\n        return 1\r\n      }\r\n      else return false\r\n    })\r\n    return result\r\n  },\r\n  indicateOn: function(i) { \r\n    let $chan = $(jq`.chan_${i.id}`)\r\n    , isOWN = (i.id === '!OWN')\r\n    , title = !isOWN ? i.name : ''\r\n    $('.onchan').removeClass('onchan')\r\n    $('.boardover').removeClass('boardover')\r\n    if($chan.length) {\r\n      $chan.addClass('onchan')\r\n    }\r\n    if (i.dir) {\r\n      i.dir = decodeURIComponent(i.dir)\r\n      var $brd = $chan.find(jq`a[data-dir=\"${i.dir}\"]`)\r\n      if($brd.length) {\r\n        $brd.addClass('boardover')\r\n        if (!i.desc) {\r\n          i.desc = $brd.find('.board-name').text()\r\n        }\r\n      }\r\n      if (i.desc) {\r\n        title += (!isOWN ? ':' : '') + i.desc\r\n      }\r\n    }\r\n    parent.document.title = (title ? `${title} • ` : '') + _SITENAME\r\n  },\r\n  sync: function(event) {\r\n    if (typeof event.data !== 'string') return;\r\n\r\n    if(event.data.match(/overnullchlive\\.html/)) {\r\n      parent.script_installed = true;\r\n      scriptInstalled()\r\n      try {\r\n        parent.frames.main.scriptInstalled()\r\n      }\r\n      catch(e) {  }\r\n      return\r\n    }\r\n    //prevent frame nesting\r\n    if (event.data.split(/\\/$/)[0] == parent.location.protocol + '//' + parent.location.host) {\r\n      parent.frames['main'].location.href = '/index.html'\r\n      this.noFollow = '/index.html'\r\n      return\r\n    }\r\n    //prevent follow\r\n    router.noFollow = event.data;\r\n    // set the hash\r\n    parent.history.replaceState(null, null, '/#/'+event.data)\r\n    // define chan\r\n    var identity = router.determineIdentity(event.data)\r\n    if(identity) {\r\n      router.indicateOn(identity)\r\n    }\r\n    else parent.document.title = _SITENAME;\r\n  },\r\n  follow: function() {\r\n  \tif (parent.location.hash && this.noFollow.split(/#\\/?/)[1] !== parent.location.hash) {\r\n  \t\tlet url = parent.location.hash.split(/#\\/?/)[1]\r\n  \t\tparent.frames['main'].location.href = url\r\n  \t\tthis.noFollow = url\r\n  \t}\r\n  },\r\n  clearHash: function() {\r\n    parent.document.title = _SITENAME;\r\n    parent.history.replaceState({}, parent.document.title, \"/\");\r\n  },\r\n  noFollow: false\r\n}\r\n\r\nfunction scriptInstalled() {\r\n  $('#refresh').addClass('script-installed').attr('title', 'Обновить')\r\n}\r\n\r\nvar lazyBoy = {\r\n  init: function() {\r\n    $(window).load(this.execute.bind(this))\r\n  },\r\n  que: [],\r\n  execute: function() {\r\n    this.ready = true\r\n    while (this.que.length) {\r\n      this.que.splice(0, 1)[0]()\r\n    }\r\n  },\r\n  addJob: function(job) {\r\n    if (this.ready) {\r\n      job()\r\n    }\r\n    else {\r\n      this.que.push(job)\r\n    }\r\n  },\r\n  ready: false\r\n}\r\n\r\nwindow.addEventListener(\"message\", router.sync, false)\r\n\r\ntry {\r\n  if (parent.frames.main.document.location.pathname.match(/catalog/)) {\r\n    parent.frames.main.window.postMessage('overnullchlive.html', chans.own.url)\r\n  }\r\n}\r\ncatch(e) {}\r\n\r\n\r\nfunction check3d() {\r\n  if (!window.getComputedStyle) {\r\n    return false;\r\n  }\r\n  \r\n  var el = document.createElement('p'),\r\n  has3d,\r\n  transforms = {\r\n    'webkitTransform':'-webkit-transform',\r\n    'OTransform':'-o-transform',\r\n    'msTransform':'-ms-transform',\r\n    'MozTransform':'-moz-transform',\r\n    'transform':'transform'\r\n  };\r\n\r\n  // Add it to the body to get the computed style\r\n  document.body.insertBefore(el, null);\r\n\r\n  for(var t in transforms){\r\n    if( el.style[t] !== undefined ){\r\n      el.style[t] = 'translate3d(1px,1px,1px)';\r\n      has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);\r\n    }\r\n  }\r\n\r\n  document.body.removeChild(el);\r\n\r\n  return (has3d !== undefined && has3d.length > 0 && has3d !== \"none\");\r\n}\r\n\r\nvar live = {\r\n  init: function() {\r\n    let transform = `transform: translate${check3d() ? '3d' : ''}(-50%${check3d() ? ',0,0' : ''});`\r\n    injector.inject('paneshift', `.showlive .pane-container { ${transform} -o-${transform} -webkit-${transform} -moz-${transform} -ms-${transform} }`)\r\n    this.update()\r\n    $('#live-toggle').click(() => {\r\n      if(parent._frames.layout == 'horizontal' && !parent._open) {\r\n        menu.open()\r\n        this.toggle(true)\r\n        return\r\n      }\r\n      this.toggle()\r\n    })\r\n    $('#live-add').click(this.showForm.bind(this))\r\n    $('#live-refresh').click(this.update.bind(this))\r\n    this.scheduleUpdate(60 * 1000)\r\n  },\r\n  update: function() {\r\n    $.get(`/live/live.json?v=${new Date().getTime()}`)\r\n    .done((data, textStatus, jqXHR) => {\r\n      if (this.hasOwnProperty('currentList') && this.currentList === jqXHR.responseText) {\r\n        return\r\n      }\r\n      this.build(data)\r\n      this.currentList = jqXHR.responseText\r\n    })\r\n  },\r\n  toggle: function(onoff) {\r\n    $('body').toggleClass('showlive', onoff)\r\n  },\r\n  build: function(data) {\r\n    $('#live-content').html(data.reduce((htm, link) => htm + this.buildLink(link), ''))\r\n  },\r\n  buildLink: function(link) {\r\n    return html`<a target=\"main\" href=\"${_.escape(link.url)}\" class=\"board external\" onclick=\"handleBoardClick(this)\">\r\n      <span class=\"board-name\">${_.escape(link.description)}</span>\r\n      <span class=\"link-domain\">${_.escape(this.getDomainName(link.url))}</span>\r\n    </a>`\r\n  },\r\n  showForm: function() {\r\n    if (parent._frames.layout == 'horizontal') {\r\n      menu.close()\r\n    }\r\n    parent.frames.live.$('#url').val(parent.location.hash.split(/^#\\/?/)[1])\r\n    parent.toggleShare()\r\n    parent.frames.live.$('#description').focus()\r\n  },\r\n  getDomainName: url => url.match(/^https?:\\/\\/(?:www\\.)?([^\\/#\\?]+)/i)[1],\r\n  scheduleUpdate: function(ms) {\r\n    clearInterval(this.interval)\r\n    this.interval = setInterval(this.update.bind(this), ms)\r\n  }\r\n}"]}