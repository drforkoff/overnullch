{"version":3,"sources":["../../babel/src/chantop.js"],"names":["chanTop","vstep","init","$el","list","addClass","empty","chans","load","makeCSS","count","css","_","range","forEach","p","props","has3d","prefix","injector","inject","length","chan","$","buildChan","find","click","installer","toggle","id","append","API","getRates","upd","setInterval","Date","getTime","lastUpdated","interval","is","stahp","clearInterval","updateRatings","data","oldIDs","map","newIDs","difference","document","location","reload","rating","text","arrange","isInstalled","xPlus","addRemove","name","escape","wiki","match","conf","section","_id","ballv","url","sortByOrder","i","attr","arranged","hov","order","oldRating","deltaClass","delta","removeClass","setTimeout","mockRandOrder","rand","Math","random","round","request","getChallenge","captcha","code","vote","lr","handleError","v","act","method","toSend","ajax","type","done","error","handleData","fail","e","hasOwnProperty","rates","Masher","setNewChallenge","challengers","console","log","debug","er","specialErrors","enter_captcha","updateCaptcha","wrong_captcha","force_reload","val","focus","ev","stopPropagation","pool","gradient","catbg","split","pair","left","right","colors","unprefixed","res","exec","rest","without","gradientDirection","ret","gradientType","isNaN","parseFloat","gradientStops","each","main","ajaxSetup","dataType","getJSON","version","initAll","err","default","window","width","unexpand","hasClass","toggleClass","scrollTop","submit","preventDefault","keydown","keyCode","installed","versions","LSfetchJSON","server","myChans","found","mych","push","filter","sync","withVersions","localStorage","JSON","stringify","chid","indicate","xp","ar","install","toInstall","uninstall","removed","remove","alias","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","styleSheet","cssText","appendChild","createTextNode","removeChild","getComputedStyle","el","transforms","t","body","insertBefore","getPropertyValue","key","parse","removeItem"],"mappings":"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","file":"chantop.js","sourcesContent":["'use strict';\r\n\r\nvar chanTop = {\r\n\tvstep: 50,\r\n\tinit: function($el, list) {\r\n\t\tthis.$el = $el.addClass('chantop')\r\n\t\tthis.$el.empty()\r\n\t\tthis.chans = list\r\n\t\tthis.load()\r\n\t},\r\n\tmakeCSS: function(count) {\r\n\t\tvar css = '', vstep = this.vstep\r\n\t\t_.range(count).forEach(function(p) {\r\n\t\t\tvar props = ''\r\n\t\t\tif(has3d) {\r\n\t\t\t\t['', '-webkit-'].forEach(function(prefix) {\r\n\t\t\t\t\tprops += `${prefix}transform: translate3d(0, ${vstep*p}px, 0);\\n`\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tprops += `top: ${vstep*p + 10}px;`\r\n\t\t\tcss += `#co-${p} {\\n${props}}\\n`\r\n\t\t})\r\n\t\tcss += `.chantop { height: ${count*vstep}px }`\r\n\t\tinjector.inject('chantop-positions', css)\r\n\t},\r\n\tload: function() {\r\n\t\tthis.makeCSS(this.chans.length)\r\n\t\tthis.chans.forEach(chan => {\r\n\t\t\tchan.$el = $(this.buildChan(chan))\r\n\t\t\tchan.$el.find('.adder-remover').click(() => {\r\n\t\t\t\tinstaller.toggle(chan.id)\r\n\t\t\t})\r\n\t\t\tthis.$el.append(chan.$el)\r\n\t\t})\r\n\t\tAPI.getRates()\r\n\t\tthis.upd = setInterval(() => {\r\n\t\t\tif(new Date().getTime() - this.lastUpdated > this.interval/2 \r\n\t\t\t&& !$('#chantop').is(':hover') \r\n\t\t\t&& $('#chantop').css('visibility') !== 'hidden')\r\n\t\t\t\tAPI.getRates()\r\n\t\t}, this.interval)\r\n\t},\r\n\tstahp: function() {\r\n\t\tclearInterval(this.upd)\r\n\t},\r\n\tupdateRatings: function(data) {\r\n\t\tthis.lastUpdated = new Date().getTime()\r\n\t\tlet oldIDs = _.map(this.chans, 'id')\r\n\t\t, newIDs = _.map(data, 'id')\r\n\t\tif (newIDs.length !== oldIDs.length || _.difference(oldIDs, newIDs).length) {\r\n\t\t\tdocument.location.reload()\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.chans.forEach(chan => {\r\n\t\t\tchan.rating = +_.find(data, {id: chan.id}).rating\r\n\t\t\tchan.$el.find('.chan-rating').text(chan.rating)\r\n\t\t})\r\n\t\tthis.arrange()\r\n\t},\r\n\tinterval: 5000,\r\n\tbuildChan: function(chan) {\r\n\t\tlet isInstalled = installer.isInstalled(chan.id)\r\n\t\t, xPlus = isInstalled ? '×' : '+'\r\n\t\t, addRemove = isInstalled ? 'Удалить' : 'Добавить'\r\n\t\t, name = _.escape(chan.name)\r\n\t\t, wiki = (chan.wiki && chan.wiki.match(/https?:\\/\\//)) ? chan.wiki : (conf.wiki+(chan.wiki || name))\r\n\t\treturn html`<div class=\"ct-chan\">\r\n\t\t\t<img src=\"/chans/balls/${chan.section}/${chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}\" alt=\"${name}\" class=\"chan-avatar\">\r\n\t\t\t<div class=\"catc-addremove adder-remover\" title=\"${addRemove}\">${xPlus}</div>\r\n\t\t\t<a href=\"${_.escape(chan.url)}\" target=\"_blank\" class=\"chan-name\"><span>${name}</span></a>\r\n\t\t\t<div class=\"chan-rating\">${chan.rating}</div>\r\n\t\t\t<div class=\"chan-rating-delta\"></div>\r\n\t\t\t<a target=\"_blank\" href=\"${wiki}\" class=\"catc-info\" title=\"Информация\">i</a>\r\n\t\t</div>`\r\n\t},\r\n\tarrange: function() {\r\n\t\t_.sortByOrder(chanTop.chans, ['rating', 'name'], ['desc', 'asc'])\r\n\t\t.forEach((chan, i) => {\r\n\t\t\tchan.$el.attr('id', `co-${i}`)\r\n\t\t\tif(this.arranged) {\r\n\t\t\t\tvar hov = ' hovering'\r\n\t\t\t\tif(i < chan.order)\r\n\t\t\t\t\thov += ' going-up'\r\n\t\t\t\telse if(i > chan.order)\r\n\t\t\t\t\thov += ' going-down'\r\n\t\t\t\telse\r\n\t\t\t\t\thov = ''\r\n\t\t\t\tif(chan.rating !== chan.oldRating) {\r\n\t\t\t\t\tvar delta = chan.rating - chan.oldRating\r\n\t\t\t\t\t, deltaClass\r\n\t\t\t\t\tif(delta > 0) {\r\n\t\t\t\t\t\tdeltaClass = 'plus'\r\n\t\t\t\t\t\tdelta= '+'+delta\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse \r\n\t\t\t\t\t\tdeltaClass = 'minus'\r\n\t\t\t\t\tchan.$el.find('.chan-rating-delta').text(`${delta}`)\r\n\t\t\t\t\t.removeClass('plus minus').addClass(deltaClass)\r\n\t\t\t\t}\r\n\t\t\t\tchan.$el.addClass(hov+(delta ? ' delta-show' : ''))\r\n\t\t\t\tsetTimeout(() => chan.$el.removeClass('hovering going-down going-up delta-show'), 1000)\r\n\t\t\t}\r\n\t\t\tchan.order = i\r\n\t\t\tchan.oldRating = chan.rating\r\n\t\t})\r\n\t\tthis.arranged = true\r\n\t},\r\n\tarranged: false,\r\n\tmockRandOrder: function(rand) {\r\n\t\trand = rand || 0.3\r\n\t\tthis.chans.forEach(chan => {\r\n\t\t\tif(Math.random() < rand) {\r\n\t\t\t\tchan.rating = Math.round(Math.random() * 1000)\r\n\t\t\t\tchan.$el.find('.chan-rating').text(`${chan.rating}`)\r\n\t\t\t}\r\n\t\t})\r\n\t\tthis.arrange()\r\n\t}\r\n}\r\n\r\nvar API = {\r\n\tgetRates: function() {\r\n\t\tthis.request('rates')\r\n\t},\r\n\tgetChallenge: function() {\r\n\t\tthis.request('challenge')\r\n\t},\r\n\tcaptcha: function(code) {\r\n\t\tthis.request('captcha', 'POST', {captcha: code})\r\n\t},\r\n\tvote: function(lr) {\r\n\t\tif(lr !== 'left' && lr !== 'right')\r\n\t\t\tthis.handleError('You can only vote Left or Right')\r\n\t\tthis.request('vote', 'POST', {v: lr})\r\n\t},\r\n\trequest: function(act, method, toSend) {\r\n\t\t$.ajax({\r\n\t\t\turl: `api.php?act=${act}`,\r\n\t\t\ttype: method || 'GET',\r\n\t\t\tdata: toSend || null,\r\n\t\t}).done(data => {\r\n\t\t\tif(data.error)\r\n\t\t\t\treturn this.handleError(data.error)\r\n\t\t\tthis.handleData(data.data)\r\n\t\t})\r\n\t\t.fail(e => this.handleError('XHR error: ', e))\r\n\t},\r\n\thandleData: function(data) {\r\n\t\tif(data.hasOwnProperty('vote_success')) {\r\n\t\t\t$('body').removeClass('enter-captcha')\r\n\t\t}\r\n\t\tif(data.hasOwnProperty('rates'))\r\n\t\t\tchanTop.updateRatings(data.rates)\r\n\t\tif(data.hasOwnProperty('challengers'))\r\n\t\t\tMasher.setNewChallenge(data.challengers)\r\n\t\tif(data.hasOwnProperty('debug'))\r\n\t\t\tconsole.log(data.debug)\r\n\t},\r\n\thandleError: function(er) {\r\n\t\tif(this.specialErrors.hasOwnProperty(er))\r\n\t\t\tthis.specialErrors[er]()\r\n\t\telse\r\n\t\t\tconsole.error(er)\r\n\t\treturn false\r\n\t},\r\n\tspecialErrors: {\r\n\t\tenter_captcha: function() {\r\n\t\t\t$('body').addClass('enter-captcha')\r\n\t\t\tupdateCaptcha()\r\n\t\t},\r\n\t\twrong_captcha: function() {\r\n\t\t\t$('#captcha-panel').addClass('wrong')\r\n\t\t\tsetTimeout(() => $('#captcha-panel').removeClass('wrong'), 1000)\r\n\t\t\tupdateCaptcha()\r\n\t\t},\r\n\t\tforce_reload: () => document.location.reload()\r\n\t}\r\n}\r\n\r\nfunction updateCaptcha() {\r\n\t$('#cpanel-wrap img').attr('src', '/captcha.php?color=200,200,200')\r\n\t$('input[name=captcha]').val('').focus()\r\n}\r\n\r\nvar Masher = {\r\n\tinit: function($el, list) {\r\n\t\tthis.$el = $el\r\n\t\tvar css = ''\r\n\t\tlist.forEach(chan => {\r\n\t\t\tvar $el = $(this.buildChan(chan))\r\n\t\t\t$el.find('a, .chan-options').click(ev => {\r\n\t\t\t\tev.stopPropagation()\r\n\t\t\t})\r\n\t\t\t$el.find('.adder-remover').click(() => {\r\n\t\t\t\tinstaller.toggle(chan.id)\r\n\t\t\t})\r\n\t\t\tthis.pool[chan.id] = $el\r\n\t\t\tcss += `\\n#ch_${chan.id} {\\n ${this.gradient(chan.catbg)} \\n}`\r\n\t\t})\r\n\t\tinjector.inject('catalog-gradients', css)\r\n\t\t$('.challenger').click(function() {\r\n\t\t\t$('.catalog-chan').addClass('post')\r\n\t\t\tAPI.vote($(this).attr('id').split('c-')[1])\r\n\t\t})\r\n\t\tAPI.getChallenge()\r\n\t},\r\n\tpool: {},\r\n\tbuildChan: chan => {\r\n\t\tlet isInstalled = installer.isInstalled(chan.id)\r\n\t\t, xPlus = isInstalled ? '×' : '+'\r\n\t\t, addRemove = isInstalled ? 'Удалить' : 'Добавить'\r\n\t\t, name = _.escape(chan.name)\r\n\t\t, wiki = (chan.wiki && chan.wiki.match(/https?:\\/\\//)) ? chan.wiki : (conf.wiki+(chan.wiki || name))\r\n\t\treturn html`<div class=\"catalog-chan\">\r\n\t\t  <div class=\"cc-ball-wrap\" id=\"ch_${chan.id}\">\r\n\t\t    <img src=\"/chans/balls/${chan.section}/${chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}\" alt=\"${name}\" class=\"cc-ball\">\r\n\t\t    <a href=\"${_.escape(chan.url)}\" target=\"_blank\" class=\"channame-overlay\">${name}</a>\r\n\t\t    <div class=\"chan-options co-add adder-remover\" title=\"${addRemove}\">${xPlus}</div>\r\n\t\t    <a href=\"${wiki}\" target=\"_blank\" class=\"chan-options co-info\" title=\"Информация\">i</a>\r\n\t\t  </div>\r\n\t\t</div>`\r\n\t},\r\n\tsetNewChallenge: function(pair) {\r\n\t\tvar [left, right] = pair.map(lr => lr = this.pool[lr.id].addClass('pre').removeClass('post'))\r\n\t\t$('#c-left').append(left)\r\n\t\t$('#c-right').append(right)\r\n\t\tsetTimeout(() => {\r\n\t\t\t$('.challenger .catalog-chan').removeClass('pre')\r\n\t\t}, 500)\r\n\t},\r\n\tgradient: function(colors) {\r\n\t\tlet unprefixed = `linear-gradient(to bottom, #${colors[0]} 0%, #${colors[1]} 100%)`\r\n\t\t, res = /(((?:radial|linear)-gradient)\\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\\));?/i.exec(unprefixed);\r\n\t\tif (res === null) return 'background:' + unprefixed;\r\n\t\tres = _.rest(_.without(res, undefined));\r\n\t\tvar ret = res[0]+'; ';\r\n\t\tvar gradientType = res[1];\r\n\t\tvar gradientDirection;\r\n\t\tif (!isNaN(res[2])) gradientDirection = (90 - parseFloat(res[2])) + 'deg, ';\r\n\t\telse if (res[2] == 'bottom') gradientDirection = 'top, ';\r\n\t\telse if (res[2] == 'right') gradientDirection = 'left, ';\r\n\t\telse gradientDirection = 'center, ellipse cover, ';\r\n\t\tvar gradientStops = res[3];\r\n\t\t_.each(['-o-', '-webkit-', '-moz-'], function(prefix) {\r\n\t\t\tret += 'background:' + prefix + gradientType + '(' + gradientDirection + gradientStops + '); ';\r\n\t\t});\r\n\t\treturn 'background:' + ret;\r\n\t}\r\n}\r\n\r\nfunction main() {\r\n\t$.ajaxSetup({\r\n\t\tdataType: 'json'\r\n\t})\r\n\r\n\t$.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\r\n\t.done(data => {\r\n\t\tif (data.chans && data.version) {\r\n\t\t\tinitAll(data.chans, data.version)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error('bad-json')\r\n\t\t}\r\n\t})\r\n\t.fail(err => console.error(err))\r\n\r\n\thas3d = has3d()\r\n}\r\n\r\nfunction initAll(chans, version) {\r\n\tchans.forEach(chan => {\r\n\t\tchan.section = chan.default ? 'default' : 'custom'\r\n\t})\t\r\n\tinstaller.init(chans, version)\r\n\tchanTop.init($('#chantop'), chans)\r\n\tMasher.init($('#battleground'), chans)\r\n\r\n\t$('header').click(() => {\r\n\t\tif($(window).width() <= 640) {\r\n\t\t\tvar unexpand = $('body').hasClass('xpnd')\r\n\t\t\t$('body').toggleClass('xpnd')\r\n\t\t\tif(!unexpand)\r\n\t\t\t\t$('#battleground-wrap').scrollTop(0)\r\n\t\t}\r\n\t})\r\n\t$('#cpanel-wrap img').click(updateCaptcha)\r\n\t$('#captcha-panel').submit(ev => {\r\n\t\tev.preventDefault()\r\n\t\tAPI.captcha($('input[name=captcha]').val())\r\n\t})\r\n\t$(window).keydown(function(ev) {\r\n\t\tif($('body').hasClass('enter-captcha'))\r\n\t\t\treturn\r\n\t\tif(ev.keyCode == 37 || ev.keyCode == 65)\r\n\t\t\tAPI.vote('left')\r\n\t\tif(ev.keyCode == 39 || ev.keyCode == 68)\r\n\t\t\tAPI.vote('right')\r\n\t})\r\n}\r\n\r\nvar installer = {\r\n\tinstalled: [],\r\n\tinit: function(list, version) {\r\n\t\tthis.list = list\r\n\t\tthis.versions = LSfetchJSON('catalogVersions') || {}\r\n\t\tthis.versions.server = version\r\n\t\tlet myChans = LSfetchJSON('myChans_new')\r\n\t\t, freshList = []\r\n\t\tif (myChans && myChans.length) {\r\n\t\t\tmyChans.forEach(mych => {\r\n\t\t\t\tlet found = _.find(list, {id: mych.id})\r\n\t\t\t\tthis.installed.push(found || mych)\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.installed = _.filter(list, {'included': true})\r\n\t\t}\r\n\t\tthis.sync(true)\r\n\t},\r\n\tsync: function(withVersions) {\r\n\t\tlocalStorage['myChans_new'] = JSON.stringify(this.installed)\r\n\t\tif (withVersions) {\r\n\t\t\tlocalStorage['catalogVersions'] = JSON.stringify(this.versions)\r\n\t\t}\r\n\t},\r\n\tisInstalled: function(chid) {\r\n\t\treturn !!_.find(this.installed, {id: chid})\r\n\t},\r\n\tindicate: function(chid, xp, ar) {\r\n\t\t[Masher.pool[chid], _.find(chanTop.chans, {id: chid}).$el].forEach($el => {\r\n\t\t\t$el.find('.adder-remover').text(xp).attr('title', ar)\r\n\t\t})\r\n\t}, \r\n\tinstall: function(chid) {\r\n\t\tlet toInstall = _.find(this.list, {id: chid})\r\n\t\tif (toInstall) {\r\n\t\t\tthis.installed.push(toInstall)\r\n\t\t\tthis.sync()\r\n\t\t\tthis.indicate(chid, '×', 'Удалить')\r\n\t\t}\r\n\t},\r\n\tuninstall: function(chid) {\r\n\t\tvar removed = _.remove(this.installed, {id: chid})\r\n\t\tif (removed) {\r\n\t\t\tthis.sync()\r\n\t\t\tthis.indicate(chid, '+', 'Добавить')\r\n\t\t}\r\n\t},\r\n\ttoggle: function(chid) {\r\n\t\tif(this.isInstalled(chid))\r\n\t\t\tthis.uninstall(chid)\r\n\t\telse\r\n\t\t\tthis.install(chid)\r\n\t}\r\n}\r\n\r\nvar conf = {\r\n\twiki: 'http://wiki.1chan.ca/'\r\n}\r\n\r\nvar injector = {\r\n  inject: function(alias, css) {\r\n    var id = `injector:${alias}`\r\n    var existing = document.getElementById(id)\r\n    if(existing) {\r\n      existing.innerHTML = css\r\n      return\r\n    }\r\n    var head = document.head || document.getElementsByTagName('head')[0]\r\n    , style = document.createElement('style');\r\n    style.type = 'text/css'\r\n    style.id = id\r\n    if (style.styleSheet) {\r\n      style.styleSheet.cssText = css\r\n    } else {\r\n      style.appendChild(document.createTextNode(css))\r\n    }\r\n    head.appendChild(style)\r\n  },\r\n  remove: function(alias) {\r\n    var id = `injector:${alias}`\r\n    var style = document.getElementById(id)\r\n    if(style) {\r\n      var head = document.head || document.getElementsByTagName('head')[0]\r\n      if(head)\r\n        head.removeChild(document.getElementById(id))\r\n    }\r\n  }\r\n}\r\n\r\nfunction has3d() {\r\n  if (!window.getComputedStyle) {\r\n    return false;\r\n  }\r\n  \r\n  var el = document.createElement('p'),\r\n  has3d,\r\n  transforms = {\r\n    'webkitTransform':'-webkit-transform',\r\n    'OTransform':'-o-transform',\r\n    'msTransform':'-ms-transform',\r\n    'MozTransform':'-moz-transform',\r\n    'transform':'transform'\r\n  };\r\n\r\n  // Add it to the body to get the computed style\r\n  document.body.insertBefore(el, null);\r\n\r\n  for(var t in transforms){\r\n    if( el.style[t] !== undefined ){\r\n      el.style[t] = 'translate3d(1px,1px,1px)';\r\n      has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);\r\n    }\r\n  }\r\n\r\n  document.body.removeChild(el);\r\n\r\n  return (has3d !== undefined && has3d.length > 0 && has3d !== \"none\");\r\n}\r\n\r\nfunction LSfetchJSON(key) {\r\n  let val = null, data = localStorage[key]\r\n  if (typeof data !== 'undefined') {\r\n    try {\r\n      val = JSON.parse(data)\r\n    }\r\n    catch(e) {\r\n      console.error(e)\r\n      localStorage.removeItem(key)\r\n    }\r\n  }\r\n  return val\r\n}"]}