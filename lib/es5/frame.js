"use strict";var _templateObject=_taggedTemplateLiteral(["#",""],["#",""]),_templateObject2=_taggedTemplateLiteral([".chan_",""],[".chan_",""]),_templateObject3=_taggedTemplateLiteral(["#cat_","_",""],["#cat_","_",""]),_templateObject4=_taggedTemplateLiteral([".chan_"," .userboards"],[".chan_"," .userboards"]),_templateObject5=_taggedTemplateLiteral(["^(https?://",")(?:","([^/?#]+))?"],["^(https?:\\/\\/",")(?:","([^\\/\\?#]+))?"]),_templateObject6=_taggedTemplateLiteral(["a[data-dir=\"","\"]"],["a[data-dir=\"","\"]"]);function _taggedTemplateLiteral(strings,raw){return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}var _WIKI="http://wiki.1chan.ca/",_SITENAME="\u041E\u0432\u0435\u0440\u043D\u0443\u043B\u044C\u0447";function main(){parent.allReady(),lazyBoy.init(),$.ajaxSetup({dataType:"json"}),$("body").on("click",".toggler",function(){$(jq(_templateObject,$(this).data("toggle"))).slideToggle("fast",function(){settings.onToggle($(this))})}),$("#pinunpin").click(parent.toggleBehavior),$(".menu-toggle").click(menu.toggle),$("#menu-show").on("mouseenter",function(){"vertical"==parent._frames.layout&&_.contains(["overlay","shift"],parent._frames.behavior)&&menu.open()}),settings.init(),chans.init(),live.init(),$("#refresh").click(function(){$(this).hasClass("script-installed")?parent.$("#main").attr("src",router.noFollow):$("#noscript-warning").fadeToggle("fast")}),"netscape"in window&&/ rv:/.test(navigator.userAgent)&&injector.inject("no-shadow-for-you",".showlive #live-toggle svg, #live-panel svg {filter: none!important; -webkit-filter: none!important;}")}function makeEscapeTagLiteralFn(){var fn=0<arguments.length&&arguments[0]!==void 0?arguments[0]:function(v){return v};return function(strings){for(var result="",i=0;i<strings.length;i++)result+=strings[i],i<(1>=arguments.length?0:arguments.length-1)&&(result+=fn(""+(arguments.length<=i+1?void 0:arguments[i+1])));return result}}var jq=makeEscapeTagLiteralFn(function(v){return v.replace(/([!"#$%&'()*+,\-./:;<=>?@[\\\]^`{|}~ ])/g,"\\$1")}),rx=makeEscapeTagLiteralFn(_.escapeRegExp),menu={open:function open(){parent.openMenu()},close:function close(){parent.closeMenu()},toggle:function toggle(){parent._open?menu.close():menu.open()}},settings={flatProps:["hiddenChans","showDirs","useAnonym","headOnly"],assocProps:["hiddenCats","deletedCats","cachedUserboards"],init:function init(){var _this=this;this.allProps=this.flatProps.concat(this.assocProps),["flatProps","assocProps"].forEach(function(propGroup){_this[propGroup].forEach(function(param){var val=LSfetchJSON(param);_this[param]=_.isEmpty(val)?"flatProps"===propGroup?[]:{}:val})})},getChanSpecificPreferences:function getChanSpecificPreferences(chid){var _this2=this,ret={};return this.flatProps.forEach(function(prop){ret[prop]=!!_.includes(_this2[prop],chid)}),this.assocProps.forEach(function(prop){ret[prop]=_this2[prop][chid]||[]}),ret},handleCheck:function handleCheck(prop,chid){var on=!_.includes(this[prop],chid),$ch=$(jq(_templateObject2,chid));return("showDirs"===prop||"headOnly"===prop)&&$ch.toggleClass(prop,!!on),"useAnonym"===prop&&$ch.find("a[data-href]").each(function(){var href=(on?"http://anonym.to?":"")+$(this).data("href");$(this).attr("href",href)}),this.toggle(chid,prop,on),!1},toggle:function toggle(chid,prop,on){on?this[prop].push(chid):this[prop]=_.without(this[prop],chid),this.save()},toggleAssoc:function toggleAssoc(prop,chid,catname,on){return this[prop].hasOwnProperty(chid)?on?this[prop][chid].push(catname):this[prop][chid]=_.without(this[prop][chid],catname):on&&(this[prop][chid]=[catname]),this.save(),this[prop][chid].length},save:function save(key){var _this3=this,props=key?[key]:this.allProps;props.forEach(function(prop){return localStorage[prop]=JSON.stringify(_this3[prop])})},onToggle:function onToggle($el){var on=$el.is(":visible");if($el.hasClass("boards")){var chid=$el.attr("id").match(/^boards_(.+)/)[1];this.toggle(chid,"hiddenChans",!on)}$el.hasClass("cat-boards")&&this.toggleAssoc("hiddenCats",$el.data("chid"),$el.data("catname"),!on)},deleteCategory:function deleteCategory(chid,catname){var $cat=$(jq(_templateObject3,chid,catname)).parents(".category");$cat.hide(),this.toggleAssoc("deletedCats",chid,catname,!0),$cat.parents(".chan").find(".restore-cats").show()},restoreCats:function restoreCats(chid){var $ch=$(jq(_templateObject2,chid));$ch.find(".category").show(),$ch.find(".restore-cats").hide(),this.deletedCats.hasOwnProperty(chid)&&(this.deletedCats[chid]=[],this.save())}};function handleBoardClick(brd){handleLinkClick(brd),$(brd).addClass("boardover").parents(".chan").addClass("onchan")}function handleHomeClick(a){handleLinkClick(a),$(a).parents(".chan").addClass("onchan")}function handleLinkClick(a){$(".boardover").removeClass("boardover"),$(".onchan").removeClass("onchan"),"horizontal"==parent._frames.layout&&menu.close(),parent.history.replaceState(null,null,"/#/"+a.href)}var chans={own:{own:!0,id:"!OWN",wiki:"\u041E\u0432\u0435\u0440\u043D\u0443\u043B\u044C\u0447",boards:[{name:"",boards:[{desc:"\u041C\u0435\u0442\u0430\u0434\u043E\u0441\u043A\u0430",dir:"meta"},{desc:"\u041A\u0430\u0442\u0430\u043B\u043E\u0433 \u0441\u0430\u0439\u0442\u043E\u0432",dir:"catalog"},{desc:"\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0441\u0430\u0439\u0442\u043E\u0432",dir:"editor"},{desc:"Ballsmash",dir:"mash"}]}],name:"\u041E\u0432\u0435\u0440\u043D\u0443\u043B\u044C\u0447",url:"http://0chan.one"},build:function build(chans){var _this4=this;this.model=chans,$("#content").html([this.own].concat(chans).reduce(function(htm,ch){return htm+_this4.buildChan(ch)},"")),this.insertWidgets();var cssCache=localStorage.compiledCSS;cssCache?injector.inject("framestyles",cssCache):lessCompiler.compile(this.model.concat(this.own))},rebuildChan:function rebuildChan(chan){this.model[_.findIndex(this.model,{id:chan.id})]=chan,$(jq(_templateObject2,chan.id)).html(this.buildChan(chan)),this.insertWidgets(),this.sync()},buildChan:function buildChan(chan){var _this5=this;_.assign(chan,settings.getChanSpecificPreferences(chan.id)),chan.wiki&&chan.wiki.match(/https?:\/\//)||(chan.wiki=_WIKI+(chan.wiki||chan.name)),""===chan.prefix&&delete chan.prefix,_.defaults(chan,this.defaults);var hasBoards=chan.boards&&chan.boards.length||chan.userboards,url=chan.own?chan.url+"/index.html":(!chan.own&&chan.useAnonym?"http://anonym.to?":"")+chan.url,name=_.escape(chan.name),htm="<div class=\"chan chan_"+chan.id+(chan.colors?"":" uncolorized")+(chan.headOnly?" headOnly":"")+(chan.showDirs?" showDirs":"")+(hasBoards?"":" no-boards")+"\"><a onclick=\"handleHomeClick(this)\" target=\"main\" href=\""+url+"\" class=\"chan-header head-link\" data-href=\""+chan.url+"\""+(chan.own?" onclick=\"router.clearHash()\"":"")+"><div class=\"chan-name\">"+name+"</div></a><div class=\"chan-header\"><div class=\"chan-name toggler\" data-toggle=\"boards_"+chan.id+"\">"+name+"</div></div><div class=\"chan-overlay chan-overlay-left\">"+(hasBoards?"<a onclick=\"handleHomeClick(this)\" class=\"iconic-link home-link\" target=\"main\" href=\""+url+"\" data-href=\""+chan.url+"\" title=\"\u0414\u043E\u043C\u0430\u0448\u043D\u044F\u044F \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0430\""+(chan.own?" onclick=\"router.clearHash()\"":"")+"><svg class=\"icon\"><use xlink:href=\"#i-home\"></use></svg></a>":"")+"<a class=\"iconic-link\" target=\"main\" href=\""+chan.wiki+"\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043D\u0430 \u0432\u0438\u043A\u0438\"><svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg></a></div><div class=\"chan-overlay chan-overlay-right\"><button class=\"toggler\" data-toggle=\"settings_"+chan.id+"\" title=\"\u041C\u0435\u043D\u044E \u0441\u0430\u0439\u0442\u0430\"><svg class=\"icon\"><use xlink:href=\"#i-dots\"></use></svg></button></div><div class=\"chan-menu\" style=\"display:none\" id=\"settings_"+chan.id+"\"><div class=\"settings-entry ifnoboards-hide\"><label for=\"showdirs_"+chan.id+"\"><input type=\"checkbox\" id=\"showdirs_"+chan.id+"\" "+(chan.showDirs?"checked":"")+" onchange=\"settings.handleCheck('showDirs', '"+chan.id+"')\"><span>\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0438</span></label></div><div class=\"settings-entry ifnoboards-hide\"><label for=\"headonly_"+chan.id+"\"><input type=\"checkbox\" id=\"headonly_"+chan.id+"\" "+(chan.headOnly?"checked":"")+" onchange=\"settings.handleCheck('headOnly', '"+chan.id+"')\"><span>\u0421\u043A\u0440\u044B\u0442\u044C \u0434\u043E\u0441\u043A\u0438</span></label></div>"+(chan.own?"":"<div class=\"settings-entry\"><label for=\"useanonym_"+chan.id+"\"><input type=\"checkbox\" id=\"useanonym_"+chan.id+"\" "+(chan.useAnonym?"checked":"")+" onchange=\"settings.handleCheck('useAnonym', '"+chan.id+"')\"><span>\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C anonym.to</span></label></div><div class=\"settings-entry restore-cats\" "+(chan.deletedCats.length?"":"style=\"display:none\"")+"><button class=\"trash-btn\" onclick=\"settings.restoreCats('"+chan.id+"')\"><svg class=\"icon\"><use class=\"i-trash\" xlink:href=\"#i-trash\"></use><use class=\"i-trash-open\" xlink:href=\"#i-trash-open\"></use></svg><span>\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438</span></button></div><div class=\"settings-entry\"><button onclick=\"chans.remove('"+chan.id+"')\"><svg class=\"icon\"><use xlink:href=\"#i-delete\"></use></svg><span>\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438\u0437 \u0444\u0440\u0435\u0439\u043C\u0430</span></button></div>")+"</div>";this.preventRouterRegistering||router.register(chan);var cats=chan.boards;if(widgets.supported.forEach(function(wiType){chan.hasOwnProperty(wiType)&&(cats=[{name:widgets[wiType].name,widgetType:wiType,widgetID:widgets[wiType].newWidget(chan[wiType],chan.id)}].concat(cats))}),chan.userboards){chan.userboards_system||(chan.userboards_system="instant"),cats=[{name:chan.userboards_catname,boards:chan.cachedUserboards,userboards:!0}].concat(cats);var proceedUbrds=function(data){var ubrds=normalizeUbrds[chan.userboards_system](data);_.eq(chan.cachedUserboards,ubrds)||_this5.updateUserboards(chan,ubrds)};$.get(chan.userboards).done(proceedUbrds.bind(this)).fail(function(err){console.error(err),$.get("/cors-proxy.php?url="+chan.userboards).done(function(data){200==data.status.http_code&&proceedUbrds(data.contents)}).fail(function(err){console.error(err)})})}return cats&&cats.length&&(htm+="<div class=\"boards\" id=\"boards_"+chan.id+"\" "+(chan.hiddenChans?"style=\"display:none\"":"")+">"+cats.reduce(function(h,cat){return h+_this5.buildCat(chan,cat,!(1<cats.length))},"")+"</div>"),htm+="</div>",htm},buildCat:function buildCat(chan,cat,flat){cat.name=_.escape(cat.name).replace(" ","\xA0");var catID=cat.widgetType?"!"+cat.widgetType:cat.name,hidden=_.includes(chan.hiddenCats,catID),hasBoards=cat.boards&&cat.boards.length,hiddenCompletely=!cat.widgetID&&!hasBoards||_.includes(chan.deletedCats,catID),htm="<div class=\"category"+(cat.userboards?" userboards":"")+"\""+(hiddenCompletely?" style=\"display:none\"":"")+(cat.widgetID?" data-widget=\""+cat.widgetID+"\"":"")+">";return flat||(htm+="<div class=\"cat-header toggler\" data-toggle=\"cat_"+chan.id+"_"+catID+"\"><div class=\"ch-name\">"+cat.name+"</div><div class=\"cat-options\"><svg class=\"icon i-delete del-cat\" onclick=\"event.stopPropagation();settings.deleteCategory('"+chan.id+"', '"+catID+"')\"><use xlink:href=\"#i-delete\"></use></svg></div></div>"),(hasBoards||cat.widgetID)&&(htm+="<div class=\"cat-boards\""+(hidden?" style=\"display:none\"":"")+(flat?"":" id=\"cat_"+chan.id+"_"+catID+"\" data-chid=\""+chan.id+"\" data-catname=\""+catID+"\"")+">"),hasBoards&&(cat.boards.forEach(function(board){var desc=_.escape(board.desc),dir=_.escape(board.dir),cleanURL=board.external?board.url:chan.url+chan.prefix+dir+chan.postfix,url=(chan.useAnonym?"http://anonym.to?":"")+cleanURL;htm+="<a target=\"main\" href=\""+url+"\" class=\"board"+(board.external?" external":"")+"\" data-href=\""+cleanURL+"\" data-dir=\""+dir+"\" onclick=\"handleLinkClick(this)\">"+(board.external?"":"<span class=\"board-dir\">/"+dir+"/ - </span>")+"<span class=\"board-name\">"+desc+"</span></a>"}),htm+="</div>"),cat.widgetID&&(htm+="<div class=\"widget-placeholder\" id=\""+cat.widgetID+"\"></div></div>"),htm+="</div>",htm},defaults:{userboards_catname:"2.0",prefix:"/",postfix:""},init:function init(){var _this6=this,chansCache=LSfetchJSON("myChans_new");chansCache&&this.build(chansCache);var fetchPromises=[new Promise(function(resolve,reject){$.getJSON("/chans/chans.json?v="+new Date().getTime()).done(function(data){data.origin="server",resolve(data)}).fail(reject)})],myDrafts=LSfetchJSON("mydrafts");myDrafts&&myDrafts.chans&&fetchPromises.push(new Promise(function(resolve){var myDraftsValid=[];myDrafts.chans.forEach(function(draft){draft.name&&draft.url&&(draft.id+="!draft",myDraftsValid.push(draft))}),resolve({origin:"drafts",chans:myDraftsValid,version:myDrafts.version||"unknown"})}));var catalogVersions=LSfetchJSON("catalogVersions");Promise.all(fetchPromises).then(function(data){var versMap={},allChans=[],changed=[];data.forEach(function(sect){versMap[sect.origin]=sect.version,allChans=allChans.concat(sect.chans);var ver=catalogVersions?+catalogVersions[sect.origin]||null:null;if(chansCache&&chansCache.length&&ver!==+sect.version){changed.push({origin:sect.origin,version:sect.version});var filter="drafts"==sect.origin?{section:"drafts"}:function(i){return"default"==i.section||"custom"==i.section};_.map(_.filter(chansCache,filter),"id").forEach(function(id){var ch=_.find(sect.chans,{id:id});ch?_this6.rebuildChan(ch):(_this6.remove(id),console.warn("Removed unknown chan #"+id+" from frame"))})}}),allChans.forEach(router.register.bind(router)),_this6.preventRouterRegistering=!0,chansCache&&chansCache.length||(localStorage.removeItem("compiledCSS"),_this6.build(_.filter(allChans,"included"))),changed.length&&(lessCompiler.compile(_this6.model.concat(_this6.own)),changed.forEach(function(chg){console.info("Updated "+chg.origin+"-originated chans' cache to v.="+chg.version)})),_this6.versions=versMap,_this6.sync()})},preventRouterRegistering:!1,remove:function remove(chid){return _.remove(this.model,{id:chid}),$(jq(_templateObject2,chid)).remove(),this.sync(),!1},updateUserboards:function updateUserboards(chan,boards){var cat={name:chan.userboards_catname,boards:boards,userboards:!0};$(jq(_templateObject4,chan.id)).replaceWith(this.buildCat(chan,cat,!1)),settings.cachedUserboards[chan.id]=boards,settings.save("cachedUserboards")},sync:function sync(){_.each(this.model,function(ch){return delete ch.cachedUserboards}),localStorage.catalogVersions=JSON.stringify(this.versions),localStorage.myChans_new=JSON.stringify(this.model)},insertWidgets:function insertWidgets(){document.querySelectorAll(".widget-placeholder").forEach(function(wph){var widgetID=wph.getAttribute("id");if(widgets.pool.hasOwnProperty(widgetID)){var widget=widgets.pool[widgetID];wph.parentNode.replaceChild(widget.el,wph)}})}},normalizeUbrds={instant:function instant(data){return data.map(function(brd){return brd.name&&(brd.dir=brd.name),delete brd.postcount,delete brd.name,brd})},"0chan":function chan(data){return data.boards.map(function(brd){return brd.desc=brd.name,delete brd.name,brd})}};function LSfetchJSON(key){var val=null,data=localStorage[key];if("undefined"!=typeof data)try{val=JSON.parse(data)}catch(e){console.error(e),localStorage.removeItem(key)}return val}var lessCompiler={compile:function compile(chans){var _this7=this,res="";chans.forEach(function(ch){if(ch.colors){var idClassEscaped=("chan_"+ch.id).replace("!","\\!");res+="."+idClassEscaped+" { \n          @bgcolor: #"+ch.colors[0]+";  @linkcolor: #"+ch.colors[1]+"; "+(ch.advanced_less||_this7.base)+"}\n\n"}}),less.render(res,function(err,output){err?console.error(err):(localStorage.compiledCSS=output.css,injector.inject("framestyles",output.css))})},base:"background: @bgcolor; a, .chan-overlay .icon { color: @linkcolor; } &:hover { background: darken(@bgcolor, 8%); } &.onchan { box-shadow: inset -2px 0 fadeout(@linkcolor, 25%); } & when (lightness(@bgcolor) < 70%) { color: #C3C3C3; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: white; } .board:hover { background: rgba(255, 255, 255, .08); } } & when (lightness(@bgcolor) > 70%) { color: #404040; a:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover { color: black; } .board:hover { background: rgba(0, 0, 0, .08); } }"};NodeList.prototype.forEach=Array.prototype.forEach;var injector={inject:function inject(alias,css){var id="injector:"+alias,existing=document.getElementById(id);if(existing)return void(existing.innerHTML=css);var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css",style.id=id,style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css)),head.appendChild(style)},remove:function remove(alias){var id="injector:"+alias,style=document.getElementById(id);if(style){var head=document.head||document.getElementsByTagName("head")[0];head&&head.removeChild(document.getElementById(id))}}},widgets={pool:{},supported:["radio"]};widgets.radio={name:"\u0420\u0430\u0434\u0438\u043E",newWidget:function newWidget(props,id){var _this8=this,widget={streams:[],currentStream:null,url:props.url,$el:$("<div class=\"radio-widget disabled\"></div>")},saved={volume:+(localStorage["radio_"+id+"_volume"]||1),stream:+(localStorage["radio_"+id+"_streamid"]||0)};props.streams.forEach(function(stream){if(stream.hasOwnProperty("n")){var $_name=_.template(stream.name),$_path=_.template(stream.path);_this8.mixedRange(stream.n).forEach(function(n){widget.streams.push({name:$_name({n:n}),path:$_path({n:n}),mime:stream.mime})})}else widget.streams.push(stream)}),widget.audio=$("<audio controls>").appendTo(widget.$el)[0],widget.playPause=this.playPause.bind(widget),widget.audio.volume=saved.volume,widget.audio.onloadeddata=function(){return widget.$el.removeClass("disabled")},$("<div class=\"rw-playpause\"><div class=\"pause-icon\"></div><div class=\"play-icon\"></div></div>").appendTo(widget.$el).click(widget.playPause);var $selectWrapper=$("<div class=\"select-wrapper\">"),options=[];widget.streams.forEach(function(stream,ix){options.push("<option value=\""+ix+"\">"+stream.name+"</option>")}),widget.setStream=this.setStream.bind(widget),$("<select>").append(options).val(saved.stream).change(function(){widget.setStream(+this.value),localStorage["radio_"+id+"_streamid"]=+this.value}).appendTo($selectWrapper),$selectWrapper.appendTo(widget.$el),lazyBoy.addJob(function(){return widget.setStream(saved.stream)});var $volumeter=this.buildVolumeter(id,70,20,function(v){widget.audio.volume=v,localStorage["radio_"+id+"_volume"]=v},saved.volume);return widget.$el.append($volumeter),widget.reflectVolumeChange=$volumeter.setV,widget.setVolume=this.setVolume.bind(widget),widget.onCategoryClose=function(){widget.audio.paused||widget.playPause()},widget.el=widget.$el[0],widgets.pool["radio_"+id]=widget,"radio_"+id},all:{},setStream:function setStream(streamID){if(this.currentStream!==streamID){var stream=this.streams[streamID],playing=!this.audio.paused;this.audio.setAttribute("src",this.url+stream.path),this.audio.setAttribute("type",stream.mime),playing&&this.audio.play()}},setVolume:function setVolume(v){this.audio.volume=v,this.reflectVolumeChange(v)},playPause:function playPause(force){force=force||null,3==this.audio.networkState?(this.audio.pause(),this.$el.removeClass("streaming")):this.audio.paused?($(".radio-widget audio").each(function(){this.pause()}),this.audio.play(),this.$el.addClass("streaming")):(this.audio.pause(),this.$el.removeClass("streaming"))},buildVolumeter:function buildVolumeter(id,width,height,onchange,baseV){function evToVal(ev){if(down){var val=(ev.pageX-$vm.offset().left)/width;0>val&&(val=0),1<val&&(val=1),$vm.setV(val),onchange&&onchange(val)}}baseV=baseV||1;var $vm=$("<div class=\"volumeter\">"),buildSVG=function(cls){var cns=function(tag){return document.createElementNS("http://www.w3.org/2000/svg",tag)},svg=cns("svg");svg.setAttribute("width",width),svg.setAttribute("height",height),svg.setAttribute("viewBox","0 0 "+width+" "+height),svg.classList.add(cls);var poly=cns("polygon");return poly.setAttribute("points","0,"+height+" "+width+",0 "+width+","+height),svg.appendChild(poly),svg},bg=buildSVG("vm-bg"),fg=buildSVG("vm-fg"),$w=$("<div class=\"vm-fg-wrapper\">");$w[0].appendChild(fg),$vm.append($w),$vm[0].appendChild(bg),$vm.setV=function(val){return $w.css({width:val*width+"px"})},$vm.setV(baseV);var down=!1;return $vm.mousedown(function(ev){down=!0,evToVal(ev)}),$("body").mousemove(evToVal).on("mouseup mouseleave blur",function(){down=!1}),$vm},mixedRange:function mixedRange(input){for(var m,output=[],re=/(?:([0-9]+)(?:\-([0-9]+))?(?:, ?)?)/g;null!==(m=re.exec(input));)m.index===re.lastIndex&&re.lastIndex++,m[2]?output=output.concat(_.range(m[1],+m[2]+1)):output.push(+m[1]);return output}};var router={chans:{},register:function register(chan){this.chans[chan.id]={exp:new RegExp(rx(_templateObject5,chan.url.split(/^https?:\/\//)[1]||chan.url,chan.prefix||chans.defaults.prefix)),name:chan.name,boards:_.flatten(_.map(chan.boards,"boards"))}},currentHash:"",determineIdentity:function determineIdentity(url){var result=null;return _.find(this.chans,function(chan,chid){var guro=chan.exp.exec(url);if(null!==guro){var dir=guro[2]||null;if(result={id:chid,name:chan.name},dir){result.dir=dir;var brd=_.find(chan.boards,{dir:dir});brd&&(result.desc=brd.desc)}return 1}return!1}),result},indicateOn:function indicateOn(i){var $chan=$(jq(_templateObject2,i.id)),isOWN="!OWN"===i.id,title=isOWN?"":i.name;if($(".onchan").removeClass("onchan"),$(".boardover").removeClass("boardover"),$chan.length&&$chan.addClass("onchan"),i.dir){i.dir=decodeURIComponent(i.dir);var $brd=$chan.find(jq(_templateObject6,i.dir));$brd.length&&($brd.addClass("boardover"),!i.desc&&(i.desc=$brd.find(".board-name").text())),i.desc&&(title+=(isOWN?"":":")+i.desc)}parent.document.title=(title?title+" \u2022 ":"")+_SITENAME},sync:function sync(event){if("string"==typeof event.data){if(event.data.match(/overnullchlive\.html/)){parent.script_installed=!0,scriptInstalled();try{parent.frames.main.scriptInstalled()}catch(e){}return}if(event.data.split(/\/$/)[0]==parent.location.protocol+"//"+parent.location.host)return parent.frames.main.location.href="/index.html",void(this.noFollow="/index.html");router.noFollow=event.data,parent.history.replaceState(null,null,"/#/"+event.data);var identity=router.determineIdentity(event.data);identity?router.indicateOn(identity):parent.document.title=_SITENAME}},follow:function follow(){if(parent.location.hash&&this.noFollow.split(/#\/?/)[1]!==parent.location.hash){var url=parent.location.hash.split(/#\/?/)[1];parent.frames.main.location.href=url,this.noFollow=url}},clearHash:function clearHash(){parent.document.title=_SITENAME,parent.history.replaceState({},parent.document.title,"/")},noFollow:!1};function scriptInstalled(){$("#refresh").addClass("script-installed").attr("title","\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C")}var lazyBoy={init:function init(){$(window).load(this.execute.bind(this))},que:[],execute:function execute(){for(this.ready=!0;this.que.length;)this.que.splice(0,1)[0]()},addJob:function addJob(job){this.ready?job():this.que.push(job)},ready:!1};window.addEventListener("message",router.sync,!1);try{parent.frames.main.document.location.pathname.match(/catalog/)&&parent.frames.main.window.postMessage("overnullchlive.html",chans.own.url)}catch(e){}function check3d(){if(!window.getComputedStyle)return!1;var has3d,el=document.createElement("p"),transforms={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var t in document.body.insertBefore(el,null),transforms)void 0!==el.style[t]&&(el.style[t]="translate3d(1px,1px,1px)",has3d=window.getComputedStyle(el).getPropertyValue(transforms[t]));return document.body.removeChild(el),void 0!==has3d&&0<has3d.length&&"none"!==has3d}var live={init:function init(){var _this9=this,transform="transform: translate"+(check3d()?"3d":"")+"(-50%"+(check3d()?",0,0":"")+");";injector.inject("paneshift",".showlive .pane-container { "+transform+" -o-"+transform+" -webkit-"+transform+" -moz-"+transform+" -ms-"+transform+" }"),this.update(),$("#live-toggle").click(function(){return"horizontal"!=parent._frames.layout||parent._open?void _this9.toggle():(menu.open(),void _this9.toggle(!0))}),$("#live-add").click(this.showForm.bind(this)),$("#live-refresh").click(this.update.bind(this)),this.scheduleUpdate(60000)},update:function update(){var _this10=this;$.get("/live/live.json?v="+new Date().getTime()).done(function(data,textStatus,jqXHR){_this10.hasOwnProperty("currentList")&&_this10.currentList===jqXHR.responseText||(_this10.build(data),_this10.currentList=jqXHR.responseText)})},toggle:function toggle(onoff){$("body").toggleClass("showlive",onoff)},build:function build(data){var _this11=this;$("#live-content").html(data.reduce(function(htm,link){return htm+_this11.buildLink(link)},""))},buildLink:function buildLink(link){return"<a target=\"main\" href=\""+_.escape(link.url)+"\" class=\"board external\" onclick=\"handleBoardClick(this)\"><span class=\"board-name\">"+_.escape(link.description)+"</span><span class=\"link-domain\">"+_.escape(this.getDomainName(link.url))+"</span></a>"},showForm:function showForm(){"horizontal"==parent._frames.layout&&menu.close(),parent.frames.live.$("#url").val(parent.location.hash.split(/^#\/?/)[1]),parent.toggleShare(),parent.frames.live.$("#description").focus()},getDomainName:function getDomainName(url){return url.match(/^https?:\/\/(?:www\.)?([^\/#\?]+)/i)[1]},scheduleUpdate:function scheduleUpdate(ms){clearInterval(this.interval),this.interval=setInterval(this.update.bind(this),ms)}};
//# sourceMappingURL=frame.js.map