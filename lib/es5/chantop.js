"use strict";var _templateObject=_taggedTemplateLiteral(["<div class=\"ct-chan\">\n\t\t\t<img src=\"/chans/balls/","/",".png?uid=","","\" alt=\"","\" class=\"chan-avatar\">\n\t\t\t<div class=\"catc-addremove adder-remover\" title=\"","\">","</div>\n\t\t\t<a href=\"","\" target=\"_blank\" class=\"chan-name\"><span>","</span></a>\n\t\t\t<div class=\"chan-rating\">","</div>\n\t\t\t<div class=\"chan-rating-delta\"></div>\n\t\t\t<a target=\"_blank\" href=\"","\" class=\"catc-info\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\">i</a>\n\t\t</div>"],["<div class=\"ct-chan\">\n\t\t\t<img src=\"/chans/balls/","/",".png?uid=","","\" alt=\"","\" class=\"chan-avatar\">\n\t\t\t<div class=\"catc-addremove adder-remover\" title=\"","\">","</div>\n\t\t\t<a href=\"","\" target=\"_blank\" class=\"chan-name\"><span>","</span></a>\n\t\t\t<div class=\"chan-rating\">","</div>\n\t\t\t<div class=\"chan-rating-delta\"></div>\n\t\t\t<a target=\"_blank\" href=\"","\" class=\"catc-info\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\">i</a>\n\t\t</div>"]),_templateObject2=_taggedTemplateLiteral(["<div class=\"catalog-chan\">\n\t\t  <div class=\"cc-ball-wrap\" id=\"ch_","\">\n\t\t    <img src=\"/chans/balls/","/",".png?uid=","","\" alt=\"","\" class=\"cc-ball\">\n\t\t    <a href=\"","\" target=\"_blank\" class=\"channame-overlay\">","</a>\n\t\t    <div class=\"chan-options co-add adder-remover\" title=\"","\">","</div>\n\t\t    <a href=\"","\" target=\"_blank\" class=\"chan-options co-info\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\">i</a>\n\t\t  </div>\n\t\t</div>"],["<div class=\"catalog-chan\">\n\t\t  <div class=\"cc-ball-wrap\" id=\"ch_","\">\n\t\t    <img src=\"/chans/balls/","/",".png?uid=","","\" alt=\"","\" class=\"cc-ball\">\n\t\t    <a href=\"","\" target=\"_blank\" class=\"channame-overlay\">","</a>\n\t\t    <div class=\"chan-options co-add adder-remover\" title=\"","\">","</div>\n\t\t    <a href=\"","\" target=\"_blank\" class=\"chan-options co-info\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\">i</a>\n\t\t  </div>\n\t\t</div>"]);function _sliceIterator(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _slicedToArray(a,b){if(Array.isArray(a))return a;return Symbol.iterator in Object(a)?_sliceIterator(a,b):void 0}function _taggedTemplateLiteral(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}var chanTop={vstep:50,init:function c(a,b){this.$el=a.addClass("chantop"),this.$el.empty(),this.chans=b,this.load()},makeCSS:function d(a){var b="",c=this.vstep;_.range(a).forEach(function(a){var d="";has3d?["","-webkit-"].forEach(function(b){d+="".concat(b,"transform: translate3d(0, ").concat(c*a,"px, 0);\n")}):d+="top: ".concat(c*a+10,"px;"),b+="#co-".concat(a," {\n").concat(d,"}\n")}),b+=".chantop { height: ".concat(a*c,"px }"),injector.inject("chantop-positions",b)},load:function b(){var a=this;this.makeCSS(this.chans.length),this.chans.forEach(function(b){b.$el=$(a.buildChan(b)),b.$el.find(".adder-remover").click(function(){installer.toggle(b.id)}),a.$el.append(b.$el)}),API.getRates(),this.upd=setInterval(function(){new Date().getTime()-a.lastUpdated>a.interval/2&&!$("#chantop").is(":hover")&&"hidden"!==$("#chantop").css("visibility")&&API.getRates()},this.interval)},stahp:function a(){clearInterval(this.upd)},updateRatings:function d(a){this.lastUpdated=new Date().getTime();var b=_.map(this.chans,"id"),c=_.map(a,"id");return c.length!==b.length||_.difference(b,c).length?void document.location.reload():void(this.chans.forEach(function(b){b.rating=+_.find(a,{id:b.id}).rating,b.$el.find(".chan-rating").text(b.rating)}),this.arrange())},interval:5e3,buildChan:function g(a){var b=installer.isInstalled(a.id),c=b?"\xD7":"+",d=b?"\u0423\u0434\u0430\u043B\u0438\u0442\u044C":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",e=_.escape(a.name),f=a.wiki&&a.wiki.match(/https?:\/\//)?a.wiki:conf.wiki+(a.wiki||e);return html(_templateObject,a.section,a.id,a._id,a.ballv?"&v=".concat(a.ballv):"",e,d,c,_.escape(a.url),e,a.rating,f)},arrange:function b(){var a=this;_.sortByOrder(chanTop.chans,["rating","name"],["desc","asc"]).forEach(function(b,c){if(b.$el.attr("id","co-".concat(c)),a.arranged){var d=" hovering";if(c<b.order?d+=" going-up":c>b.order?d+=" going-down":d="",b.rating!==b.oldRating){var e,f=b.rating-b.oldRating;0<f?(e="plus",f="+"+f):e="minus",b.$el.find(".chan-rating-delta").text("".concat(f)).removeClass("plus minus").addClass(e)}b.$el.addClass(d+(f?" delta-show":"")),setTimeout(function(){return b.$el.removeClass("hovering going-down going-up delta-show")},1e3)}b.order=c,b.oldRating=b.rating}),this.arranged=!0},arranged:!1,mockRandOrder:function b(a){a=a||.3,this.chans.forEach(function(b){Math.random()<a&&(b.rating=Math.round(1e3*Math.random()),b.$el.find(".chan-rating").text("".concat(b.rating)))}),this.arrange()}},API={getRates:function a(){this.request("rates")},getChallenge:function a(){this.request("challenge")},captcha:function b(a){this.request("captcha","POST",{captcha:a})},vote:function b(a){"left"!==a&&"right"!==a&&this.handleError("You can only vote Left or Right"),this.request("vote","POST",{v:a})},request:function e(a,b,c){var d=this;$.ajax({url:"api.php?act=".concat(a),type:b||"GET",data:c||null}).done(function(a){return a.error?d.handleError(a.error):void d.handleData(a.data)}).fail(function(a){return d.handleError("XHR error: ",a)})},handleData:function b(a){a.hasOwnProperty("vote_success")&&$("body").removeClass("enter-captcha"),a.hasOwnProperty("rates")&&chanTop.updateRatings(a.rates),a.hasOwnProperty("challengers")&&Masher.setNewChallenge(a.challengers),a.hasOwnProperty("debug")&&console.log(a.debug)},handleError:function b(a){return this.specialErrors.hasOwnProperty(a)?this.specialErrors[a]():console.error(a),!1},specialErrors:{enter_captcha:function a(){$("body").addClass("enter-captcha"),updateCaptcha()},wrong_captcha:function a(){$("#captcha-panel").addClass("wrong"),setTimeout(function(){return $("#captcha-panel").removeClass("wrong")},1e3),updateCaptcha()},force_reload:function a(){return document.location.reload()}}};function updateCaptcha(){$("#cpanel-wrap img").attr("src","/captcha.php?color=200,200,200"),$("input[name=captcha]").val("").focus()}var Masher={init:function e(a,b){var c=this;this.$el=a;var d="";b.forEach(function(a){var b=$(c.buildChan(a));b.find("a, .chan-options").click(function(a){a.stopPropagation()}),b.find(".adder-remover").click(function(){installer.toggle(a.id)}),c.pool[a.id]=b,d+="\n#ch_".concat(a.id," {\n ").concat(c.gradient(a.catbg)," \n}")}),injector.inject("catalog-gradients",d),$(".challenger").click(function(){$(".catalog-chan").addClass("post"),API.vote($(this).attr("id").split("c-")[1])}),API.getChallenge()},pool:{},buildChan:function g(a){var b=installer.isInstalled(a.id),c=b?"\xD7":"+",d=b?"\u0423\u0434\u0430\u043B\u0438\u0442\u044C":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",e=_.escape(a.name),f=a.wiki&&a.wiki.match(/https?:\/\//)?a.wiki:conf.wiki+(a.wiki||e);return html(_templateObject2,a.id,a.section,a.id,a._id,a.ballv?"&v=".concat(a.ballv):"",e,_.escape(a.url),e,d,c,f)},setNewChallenge:function g(a){var b=this,c=a.map(function(a){return a=b.pool[a.id].addClass("pre").removeClass("post")}),d=_slicedToArray(c,2),e=d[0],f=d[1];$("#c-left").append(e),$("#c-right").append(f),setTimeout(function(){$(".challenger .catalog-chan").removeClass("pre")},500)},gradient:function h(a){var b="linear-gradient(to bottom, #".concat(a[0]," 0%, #").concat(a[1]," 100%)"),c=/(((?:radial|linear)-gradient)\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\));?/i.exec(b);if(null===c)return"background:"+b;c=_.rest(_.without(c,void 0));var d,e=c[0]+"; ",f=c[1];d=isNaN(c[2])?"bottom"==c[2]?"top, ":"right"==c[2]?"left, ":"center, ellipse cover, ":90-parseFloat(c[2])+"deg, ";var g=c[3];return _.each(["-o-","-webkit-","-moz-"],function(a){e+="background:"+a+f+"("+d+g+"); "}),"background:"+e}};function main(){$.ajaxSetup({dataType:"json"}),$.getJSON("/chans/chans.json?v=".concat(new Date().getTime())).done(function(a){a.chans&&a.version?initAll(a.chans,a.version):console.error("bad-json")}).fail(function(a){return console.error(a)}),has3d=has3d()}function initAll(a,b){a.forEach(function(a){a.section=a.default?"default":"custom"}),installer.init(a,b),chanTop.init($("#chantop"),a),Masher.init($("#battleground"),a),$("header").click(function(){if(640>=$(window).width()){var a=$("body").hasClass("xpnd");$("body").toggleClass("xpnd"),a||$("#battleground-wrap").scrollTop(0)}}),$("#cpanel-wrap img").click(updateCaptcha),$("#captcha-panel").submit(function(a){a.preventDefault(),API.captcha($("input[name=captcha]").val())}),$(window).keydown(function(a){$("body").hasClass("enter-captcha")||((37==a.keyCode||65==a.keyCode)&&API.vote("left"),(39==a.keyCode||68==a.keyCode)&&API.vote("right"))})}var installer={installed:[],init:function e(a,b){var c=this;this.list=a,this.versions=LSfetchJSON("catalogVersions")||{},this.versions.server=b;var d=LSfetchJSON("myChans_new");d&&d.length?d.forEach(function(b){var d=_.find(a,{id:b.id});c.installed.push(d||b)}):this.installed=_.filter(a,{included:!0}),this.sync(!0)},sync:function b(a){localStorage.myChans_new=JSON.stringify(this.installed),a&&(localStorage.catalogVersions=JSON.stringify(this.versions))},isInstalled:function b(a){return!!_.find(this.installed,{id:a})},indicate:function d(a,b,c){[Masher.pool[a],_.find(chanTop.chans,{id:a}).$el].forEach(function(a){a.find(".adder-remover").text(b).attr("title",c)})},install:function c(a){var b=_.find(this.list,{id:a});b&&(this.installed.push(b),this.sync(),this.indicate(a,"\xD7","\u0423\u0434\u0430\u043B\u0438\u0442\u044C"))},uninstall:function c(a){var b=_.remove(this.installed,{id:a});b&&(this.sync(),this.indicate(a,"+","\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C"))},toggle:function b(a){this.isInstalled(a)?this.uninstall(a):this.install(a)}},conf={wiki:"http://wiki.1chan.ca/"},injector={inject:function g(a,b){var c="injector:".concat(a),d=document.getElementById(c);if(d)return void(d.innerHTML=b);var e=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css",f.id=c,f.styleSheet?f.styleSheet.cssText=b:f.appendChild(document.createTextNode(b)),e.appendChild(f)},remove:function e(a){var b="injector:".concat(a),c=document.getElementById(b);if(c){var d=document.head||document.getElementsByTagName("head")[0];d&&d.removeChild(document.getElementById(b))}}};function has3d(){if(!window.getComputedStyle)return!1;var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var d in document.body.insertBefore(b,null),c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&0<a.length&&"none"!==a}function LSfetchJSON(a){var b=null,c=localStorage[a];if("undefined"!=typeof c)try{b=JSON.parse(c)}catch(b){console.error(b),localStorage.removeItem(a)}return b}
//# sourceMappingURL=chantop.js.map