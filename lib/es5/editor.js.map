{"version":3,"sources":["../../babel/src/editor.js"],"names":["IS_ADMIN","main","saveAsNewDraft","libchan","setMode","drafts","submit","LSfetchJSON","$","addClass","toggleClass","setTimeout","injector","inject","ajaxSetup","dataType","each","prepend","append","$tipper","parents","find","showErrors","mkErrorShower","errorDescriptors","attr","patternRX","RegExp","validate","silent","isDraft","Promise","resolve","reject","$this","val","errors","trim","maxlength","minlength","length","push","match","vconv","data","validations","hasOwnProperty","prop","finalize","setTipperState","afterValid","then","err","on","$sect","_","noop","change","gradient","update","bind","click","$use","minus","indexOf","_from","_to","_ref","id","tree","addBoard","removeBoard","$cat","hasClass","removeCategory","removeClass","addCategory","isMouseDown","radio","removeStream","focus","validateUI","load","_libdata","ev","preventDefault","stopPropagation","clearTimeout","offTimeout","currentTarget","target","$ch","parent","downloadJSON","ball","handleFile","getData","toggleView","text","removeAttribute","setAttribute","inc","override","clearInterval","incrementor","$input","offset","setInterval","validateJSON","styles","html","preamble","base","bindID","$b","jq","trigger","window","updateBindings","$area","slideDown","preValue","refreshCaptcha","toggle","addStream","Sortable","create","document","querySelector","handle","animation","toggleLib","lastTab","tabID","$lib","f","replace","toLowerCase","remove","upForm","init","getJSON","Date","getTime","done","library","build","chans","clear","clone","current","Math","random","localStorage","make","direction","stop1","stop2","prefixify","input","res","exec","rest","without","gradientDirection","ret","gradientType","isNaN","parseFloat","gradientStops","prefix","getValue","grad","alias","css","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","removeChild","originalEvent","files","dataTransfer","reader","FileReader","onload","e","setBall","result","readAsDataURL","chan","src","section","_id","ballv","$ball","one","width","height","file","fType","map","pos","abs","sign","catbg","stop","jscolor","fromString","toDataURL","getDataUri","top","left","cats","htm","JSON","parse","isFlat","name","boards","forEach","buildCat","cat","querySelectorAll","makeBoardsSortable","stringify","deconstruct","boardHeight","addBoardButtonHeight","buildBoards","empty","maxHeight","escape","buildBoard","brd","escHTML","external","dir","url","desc","recalcHeight","$brds","jQuery","n","px","$btn","board","$parent","el","group","onAdd","from","to","shake","obj","keys","r","allDirs","walkCat","catNames","dupCats","findDuplicates","$cats","i","dupDirs","$dirs","k","join","flat","$boards","$desc","$dir","$name","JSON_valid","errs","Array","$msgbox","any","mul","reduce","er","HTMLElement","fn","state","arr","dubs","role","vars","v","bgColor","linkColor","callback","userCode","parseInput","lessCode","less","render","message","colors","c","advanced_less","lessFormatter","minify","succ","errors_found","brackets","isBalanced","str","bracket","openBrackets","isClean","len","pop","reset","field","buildStream","strm","path","mime","$strm","streams","hide","proceed","$streams","stream","$range","mixedRange","dupProps","pluck","$inputs","addChan","default","buildChan","console","error","ballSrc","search","wiki","dlbtn","$chan","fresh","appendTo","highlight","libdata","editChan","assign","replaceWith","deleteChan","sect","included","userboards","userboards_catname","userboards_system","postfix","show","prettify","rinse","_schema","integrity","required","optional","adminOnly","specialComps","pairs","objects","isNewBall","conversions","toFile","defaults","fns","eq","first","second","vals","cur","nu","toBlob","schema","props","intCls","cmpCls","eqFn","convCls","conv","defCls","mode","collectData","dataPromises","pr","treeToUI","validUI","admy","all","proceedWithData","isUpload","fd","FormData","propSchema","apnd","uniq","DO_DEBUG","log","value","w","model","lsDrafts","parsed","Error","removeItem","splice","findIndex","sync","add","edit","edited","version","newid","guro","draft","css_beautify","urlencode","encodeURI","checkuniq","get","encodeURIComponent","fail","NodeList","prototype","Blob","inspect","entries","pair","fr","String","split","bstr","atob","u8arr","Uint8Array","charCodeAt","image","Image","canvas","naturalWidth","naturalHeight","getContext","drawImage","m","output","re","index","lastIndex","concat","range","$form","actorFieldMap","fields","actor","fieldActorMap","draftDelete","checkFields","action","candidate","send","request","XMLHttpRequest","open","_this","status","response","warn","unbusy","handleResponse","admin","msg","includes","messages","filter","added","moveto","makeEscapeTagLiteralFn","strings","key","dlAnchorElem"],"mappings":"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","file":"editor.js","sourcesContent":["\"use strict\";\r\n\r\nvar IS_ADMIN = false;\r\n\r\nconst main = () => {\r\n\tif(LSfetchJSON('IS_ADMIN')) {\r\n\t\tIS_ADMIN = true\r\n\t\t$('body').addClass('is-admin')\r\n\t}\r\n\r\n\t$('#chan-library').toggleClass('expanded', localStorage['chanlib-expanded'] == 1)\r\n\tsetTimeout(() => injector.inject('lib-collapse', `.collapsible-content {  transition: width 0.3s; }`), 100)\r\n\r\n\t$.ajaxSetup({\r\n\t\tdataType: 'json'\r\n\t})\r\n\r\n\t$('.tipper').each(function() {\r\n\t\t$(this).prepend(`\r\n\t\t\t<svg class=\"icon t-i-q\"><use xlink:href=\"#i-question\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-e\"><use xlink:href=\"#i-warning\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-s spinning\"><use xlink:href=\"#i-spinner\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-ok\"><use xlink:href=\"#i-check\"></use></svg>`)\r\n\t})\r\n\t.append(`<div class=\"tooltip-wrap error-msg\"><div class=\"tooltip\"></div></div>`)\r\n\t\r\n\t$('.validable')\r\n\t.each(function() {\r\n\t\tlet $tipper = $(this).parents('.tip-container').find('.tipper')\r\n\t\tthis.showErrors = mkErrorShower($tipper)\r\n\t\tthis.errorDescriptors = {\r\n\t\t\t'too-long': '   ',\r\n\t\t\t'too-short': '   ',\r\n\t\t\t'invalid': '  ',\r\n\t\t\t'missing': '   ',\r\n\t\t\t'occupied': ' '\r\n\t\t}\r\n\t\tif ($(this).attr('pattern'))\r\n\t\t\tthis.patternRX = new RegExp($(this).attr('pattern'))\r\n\t\tthis.validate = (silent, isDraft) => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet $this = $(this)\r\n\t\t\t\t, val = $this.val()\r\n\t\t\t\t, errors = []\r\n\r\n\t\t\t\tval = val.trim()\r\n\t\t\t\t$this.val(val)\r\n\r\n\t\t\t\tif (val) {\r\n\t\t\t\t\tlet maxlength = $this.attr('maxlength')\r\n\t\t\t\t\t, minlength = $this.attr('minlength')\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (minlength && val.length < minlength)\r\n\t\t\t\t\t\terrors.push(`    (  ${minlength} .)`)\r\n\r\n\t\t\t\t\tif (this.patternRX && !val.match(this.patternRX)) \r\n\t\t\t\t\t\terrors.push('invalid')\r\n\r\n\t\t\t\t\tlet vconv = $this.data('valconvert')\r\n\t\t\t\t\tif (vconv && validations.hasOwnProperty(vconv)) {\r\n\t\t\t\t\t\tval = validations[vconv](val)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (maxlength && val.length > maxlength)\r\n\t\t\t\t\t\terrors.push(` .   (${maxlength} )`)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif ($(this).prop('required')) {\r\n\t\t\t\t\t\terrors.push('missing')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet finalize = () => {\r\n\t\t\t\t\tif (! silent)\r\n\t\t\t\t\t\tthis.showErrors(errors)\r\n\t\t\t\t\tif (! errors.length) {\r\n\t\t\t\t\t\t$tipper.setTipperState('valid')\r\n\t\t\t\t\t\tresolve(val)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (isDraft)\r\n\t\t\t\t\t\t\tresolve(val)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject(errors)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet afterValid = $this.data('aftervalid')\r\n\t\t\t\tif (! errors.length) {\r\n\t\t\t\t\t$tipper.setTipperState('spinner')\r\n\t\t\t\t\tif (afterValid && validations[afterValid]) {\r\n\t\t\t\t\t\tvalidations[afterValid](val, $this.data('uniq'))\r\n\t\t\t\t\t\t.then(() => finalize(), err => {\r\n\t\t\t\t\t\t\terrors.push(err)\r\n\t\t\t\t\t\t\tfinalize()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse finalize()\r\n\t\t\t\t}\r\n\t\t\t\telse finalize()\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n\t.on('focus', function() {\r\n\t\tlet $this = $(this)\r\n\t\t, $sect = $this.parents('.tip-container')\r\n\t\t, $tipper = $sect.find('.tipper')\r\n\t})\r\n\r\n\t$('.validable:not(.no-val-onblur)').on('blur', function() { \r\n\t\tthis.validate().then(_.noop, _.noop)\r\n\t})\r\n\t\r\n\t$('#color-selector .colorbox').change(gradient.update.bind(gradient))\r\n\r\n\t$('#change-direction').click(function() {\r\n\t\tlet $use = $(this).find('use')\r\n\t\t, minus = $use.attr('transform').indexOf('-90') < 0\r\n\t\t$use.attr('transform', `rotate(${minus ? '-' : ''}90 8 8)`)\r\n\t\tvar _from = $('#bgc-from')[0], _to = $('#bgc-to')[0];\r\n\t\tvar _ref = [_to.id, _from.id];\r\n\t\t_from.id = _ref[0];\r\n\t\t_to.id = _ref[1];\r\n\t\tgradient.update()\r\n\t})\r\n\r\n\t$('body')\r\n\t.on('click', '.add-board', function() {\r\n\t\ttree.addBoard($(this))\r\n\t})\r\n\t.on('click', '.delboard', function() {\r\n\t\ttree.removeBoard($(this))\r\n\t})\r\n\t.on('click', '.delcat', function() {\r\n\t\tlet $cat = $(this).parents('.tree-cat')\r\n\t\tif ($cat.hasClass('predelete') || $cat.hasClass('empty'))\r\n\t\t\ttree.removeCategory($(this))\r\n\t\telse\r\n\t\t\t$cat.addClass('predelete')\r\n\t})\r\n\t.on('click', '.cat-undelete', function() {\r\n\t\t$(this).parents('.tree-cat').removeClass('predelete')\r\n\t})\r\n\t.on('click', '.f-minus, .f-plus', function() {\r\n\t\t$(this).parents('.tree-cat').toggleClass('hidden')\r\n\t})\r\n\t.on('click', '.add-cat', tree.addCategory.bind(tree))\r\n\t.on('input', '.board-dir', function() {\r\n\t\t$(this).parents('.cat-brd').toggleClass('external', !! $(this).val().match(/^https?:\\/\\//))\r\n\t})\r\n\t.on('mouseup mouseleave blur touchend touchcancel', function(ev) {\r\n\t\tisMouseDown = false\r\n\t})\r\n\t.on('click', '.delstream', function() { radio.removeStream($(this)) })\r\n\t.on('click', '.templatize', function() {\r\n\t\t$(this).parents('.stream').toggleClass('templated').find('.stream-range').focus()\r\n\t})\r\n\t.on('blur', '#tree input', tree.validateUI.bind(tree))\r\n\t.on('click', '.lib-chan', function() {\r\n\t\tlibchan.load(this._libdata)\r\n\t})\r\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tev.stopPropagation()\r\n\t})\r\n\t.on('dragenter', function(ev) {\r\n\t\t$(this).addClass('dropping')\r\n\t\tclearTimeout(this.offTimeout)\r\n\t})\r\n\t.on('dragend drop dragleave', function(ev) {\r\n\t\tif (ev.currentTarget === ev.target) {\r\n\t\t\tthis.offTimeout = setTimeout(() => {\r\n\t\t\t\t$(this).removeClass('dropping')\r\n\t\t\t}, 100)\r\n\t\t}\r\n\t})\r\n\t.on('click', '.export-draft', function(ev) {\r\n\t\tev.stopPropagation()\r\n\t\tlet $ch = $(this).parent('.lib-chan')\r\n\t\t, data = $ch[0]._libdata\r\n\t\tdownloadJSON(data, data.id)\r\n\t})\r\n\r\n\t$('.chanball-wrap')\r\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tev.stopPropagation()\r\n\t})\r\n\t.on('dragenter dragover', function(ev) {\r\n\t\t$(this).addClass('file-over')\r\n\t\tclearTimeout(this.offTimeout)\r\n\t})\r\n\t.on('dragend drop dragleave', function(ev) {\r\n\t\tthis.offTimeout = setTimeout(() => {\r\n\t\t\t$(this).removeClass('file-over')\r\n\t\t}, 100)\r\n\t})\r\n\t.on('drop', ball.handleFile.bind(ball))\r\n\r\n\t$('#radio-editor').on('blur', 'input', () => {\r\n\t\tradio.getData().then(_.noop, _.noop)\r\n\t})\r\n\r\n\tvar isMouseDown = false\r\n\r\n\t$('.chanball-dropzone').click(() => $('#chanballFileInput').click())\r\n\t$('#chanballFileInput').on('change', ball.handleFile.bind(ball))\r\n\r\n\t$('#view-toggle .switch-body').click(() => tree.toggleView())\r\n\t$('#view-toggle label').click(function(ev) {\r\n\t\ttree.toggleView($(this).text())\r\n\t})\r\n\r\n\t$('#reup-chanball').click(() => {\r\n\t\t$('#chanballFileInput').click()\r\n\t})\r\n\r\n\t$('.password-reveal').on('mousedown', function() {\r\n\t\t$(this).parent().find('input').attr('type', 'text')\r\n\t})\r\n\t.on('mouseleave mouseup', function() {\r\n\t\t$(this).parent().find('input').attr('type', 'password')\r\n\t});\r\n\r\n\t$('#pswd').on('focus', function() {\r\n\t\tthis.removeAttribute('readonly')\r\n\t})\r\n\t.on('blur', function() {\r\n\t\tthis.setAttribute('readonly', true)\r\n\t})\r\n\r\n\t$('.cb-position-tweaker button')\r\n\t.on('mousedown touchstart', function() {\r\n\t\tisMouseDown = true\r\n\t\tlet inc = override => {\r\n\t\t\tif (!override && !isMouseDown)\r\n\t\t\t\treturn clearInterval(this.incrementor)\r\n\t\t\tlet $input = $(this).parent().find('input')\r\n\t\t\t, inc = +$(this).data('inc')\r\n\t\t\t$input.val(+$input.val() + inc)\r\n\t\t\tball.offset()\r\n\t\t}\r\n\t\tinc(true)\r\n\t\tthis.incrementor = setInterval(inc, 150)\r\n\t})\r\n\t.parent().find('input').on('input paste change', ball.offset)\r\n\r\n\t$('#tree-json').on('blur', function() {\r\n\t\ttree.validateJSON()\r\n\t})\r\n\r\n\t$('#chan-name').on('input paste change', function() {\r\n\t\t$('.channame-overlay').text($(this).val())\r\n\t})\r\n\r\n\t$('#color-theme input.color').change(styles.update.bind(styles))\r\n\t$('#less-enter').on('input', styles.update.bind(styles))\r\n\r\n\t$('#less-preamble').html(styles.preamble('html'))\r\n\t$('#less-enter').val(styles.base)\r\n\r\n\t$('.binded').each(function() {\r\n\t\tlet $this =  $(this)\r\n\t\t, bindID = $this.data('bind')\r\n\t\t, $b = $(jq`#${bindID}`)\r\n\t\tif (! $b.length) return;\r\n\t\t$b.on('input change paste', function() {\r\n\t\t\t$this.text($(this).val() || `{${bindID}}`)\r\n\t\t}).trigger('change')\r\n\t})\r\n\twindow.updateBindings = () => {\r\n\t\t$('.binded').each(function() {\r\n\t\t\t$(jq`#${$(this).data('bind')}`).trigger('change')\r\n\t\t})\r\n\t}\r\n\r\n\t$('#advance-less').change(function() {\r\n\t\tlet $area = $('#less-enter');\r\n\t\tif ($(this).prop('checked')) {\r\n\t\t\t$('.advanced-less').slideDown(() => {\r\n\t\t\t\t$area.prop('disabled', 0)\r\n\t\t\t\tif ($area[0].preValue)\r\n\t\t\t\t\t$area.val($area[0].preValue)\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$area[0].preValue = $area.val()\r\n\t\t\t$area.val(styles.base).prop('disabled', 1)\r\n\t\t}\r\n\t\tstyles.update()\r\n\t})\r\n\r\n\t$('.captcha').click(refreshCaptcha).addClass('not-loaded')\r\n\r\n\t$('.widget-list input').on('change', function() {\r\n\t\t$(jq`#${$(this).attr('name')}`).toggle($(this).prop('checked'))\r\n\t})\r\n\r\n\t$('.expander').click(function() {\r\n\t\t$(this).parents('.expandee').toggleClass('expanded')\r\n\t})\r\n\r\n\t$('#onchan').on('change', function() {\r\n\t\t$('.chan').toggleClass('onchan', $(this).prop('checked'))\r\n\t})\r\n\r\n\tstyles.update()\r\n\r\n\t$('#add-stream').click(radio.addStream.bind(radio))\r\n\r\n\tSortable.create(document.querySelector('#categories'), {\r\n\t\thandle: '.cat-dragger',\r\n\t\tanimation: 150\r\n\t})\r\n\r\n\tSortable.create(document.querySelector('#streams'), {\r\n\t\thandle: '.dragger',\r\n\t\tanimation: 150\r\n\t})\r\n\r\n\t$('.sidebar').click(toggleLib)\r\n\r\n\tlet lastTab = 'default'\r\n\t$('.tab').click(function() {\r\n\t\tlet tabID = $(this).data('tab')\r\n\t\t, $lib = $('#chan-library')\r\n\t\t, f = false\r\n\t\tif (tabID === 'search') {\r\n\t\t\tif ($lib.hasClass('show-search'))\r\n\t\t\t\ttabID = lastTab\r\n\t\t\telse\r\n\t\t\t\tf = true\r\n\t\t}\r\n\t\telse lastTab = tabID\r\n\t\t$lib.find('.tab').removeClass('selected')\r\n\t\t$lib.find(`.tab[data-tab=${tabID}]`).addClass('selected')\r\n\t\t$lib.removeClass('show-custom show-default show-drafts show-search').addClass(`show-${tabID}`)\r\n\t\tf && $('#searchbox').focus()\r\n\t})\r\n\r\n\t$('#searchbox').on('input paste', function() {\r\n\t\tlet val = $(this).val().trim().replace(/\\\"/g, '\\\\\"').toLowerCase()\r\n\t\tif (val.length)\r\n\t\t\tinjector.inject('lib-search', `.show-search .lib-chan[data-search *= \"${val}\"] {height: 40px}`)\r\n\t\telse\r\n\t\t\tinjector.remove('lib-search')\r\n\t})\r\n\r\n\tupForm.init()\r\n\r\n\t$.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\r\n\t.done(data => library.build(data.chans)) \r\n\r\n\t$('#new-chan').click(() => libchan.clear())\r\n\t$('#clone-this').click(() => libchan.clone())\r\n\t$('#publish').click(() => upForm.toggle('upload'))\r\n\t$('#delete-this').click(() => upForm.toggle('delete'))\r\n\t$('#save-draft').click(() => drafts.submit())\r\n\r\n\tfunction saveAsNewDraft() {\r\n\t\tlibchan.setMode('new', 'drafts')\r\n\t\tdrafts.submit(1)\r\n\t\treturn false\r\n\t}\r\n\t$('#draft-saveasnew').click(saveAsNewDraft)\r\n\t$('#draft-changeid').click(() => {\r\n\t\tdrafts.remove(libchan.current.id)\r\n\t\tsaveAsNewDraft()\r\n\t})\r\n\t$('#draft-savemodifiedid').click(() => {\r\n\t\t$('#chan-id').val($('#proposed-id').text())\r\n\t\tdrafts.submit()\r\n\t\treturn false\r\n\t})\r\n\t$('#draft-overwrite').click(() => {\r\n\t\tdrafts.remove($('#id-to-overwrite').text())\r\n\t\tdrafts.submit()\r\n\t\treturn false\r\n\t})\r\n\r\n\tdrafts.load()\r\n}\r\n\r\nfunction refreshCaptcha() {\r\n\t$('.captcha').attr('src', `/captcha.php?color=255,255,255&v=${Math.random()}`).removeClass('not-loaded')\r\n\t$('#captcha').val('')\r\n}\r\n\r\nfunction toggleLib(on) {\r\n\t$('#chan-library').toggleClass('expanded', on)\r\n\tlocalStorage['chanlib-expanded'] = +$('#chan-library').hasClass('expanded')\r\n}\r\n\r\nvar gradient = {\r\n\tmake: (direction, stop1, stop2) =>\r\n\t\t(direction !== 'radial') \r\n\t\t\t? `linear-gradient(to ${direction}, ${stop1} 0%, ${stop2} 100%)`\r\n\t\t\t: `radial-gradient(ellipse at center, ${stop1} 0%, ${stop2} 100%)`,\r\n\tprefixify: function(input) {\r\n\t\tvar res = /(((?:radial|linear)-gradient)\\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\\));?/i.exec(input);\r\n\t\tif (res === null) return 'background:' + input;\r\n\t\tres = _.rest(_.without(res, undefined));\r\n\t\tvar ret = res[0]+'; ';\r\n\t\tvar gradientType = res[1];\r\n\t\tvar gradientDirection;\r\n\t\tif (!isNaN(res[2])) gradientDirection = (90 - parseFloat(res[2])) + 'deg, ';\r\n\t\telse if (res[2] == 'bottom') gradientDirection = 'top, ';\r\n\t\telse if (res[2] == 'right') gradientDirection = 'left, ';\r\n\t\telse gradientDirection = 'center, ellipse cover, ';\r\n\t\tvar gradientStops = res[3];\r\n\t\t_.each(['-o-', '-webkit-', '-moz-'], function(prefix) {\r\n\t\t\tret += 'background:' + prefix + gradientType + '(' + gradientDirection + gradientStops + '); ';\r\n\t\t});\r\n\t\treturn 'background:' + ret;\r\n\t},\r\n\tgetValue: function() {\r\n\t\tlet stop1 = '#' + $('#bgc-from').val()\r\n\t\t, stop2 = '#' + $('#bgc-to').val()\r\n\t\treturn this.make('bottom', stop1, stop2)\r\n\t},\r\n\tupdate: function() {\r\n\t\tlet grad = this.getValue()\r\n\t\tinjector.inject('chanball-background', `.chanball-wrap { ${this.prefixify(grad)} }`)\r\n\t}\r\n}\r\n\r\nvar injector = {\r\n\tinject: function(alias, css) {\r\n\t\tvar id = `injector:${alias}`\r\n\t\tvar existing = document.getElementById(id)\r\n\t\tif (existing) {\r\n\t\t\texisting.innerHTML = css\r\n\t\t\treturn\r\n\t\t}\r\n\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t, style = document.createElement('style');\r\n\t\tstyle.type = 'text/css'\r\n\t\tstyle.id = id\r\n\t\tif (style.styleSheet) {\r\n\t\t\tstyle.styleSheet.cssText = css\r\n\t\t} else {\r\n\t\t\tstyle.appendChild(document.createTextNode(css))\r\n\t\t}\r\n\t\thead.appendChild(style)\r\n\t},\r\n\tremove: function(alias) {\r\n\t\tvar id = `injector:${alias}`\r\n\t\tvar style = document.getElementById(id)\r\n\t\tif (style) {\r\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t\tif (head)\r\n\t\t\t\thead.removeChild(document.getElementById(id))\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar ball = {\r\n\thandleFile: function(ev) {\r\n\t\tev.stopPropagation()\r\n\t\tev.preventDefault()\r\n\t\tev = ev.originalEvent\r\n\r\n\t\t$('body').removeClass('dropping')\r\n\r\n\t\tlet files = (ev.type == \"drop\") ? ev.dataTransfer.files : ev.target.files\r\n\t\t, f = files[0]\r\n\r\n\t\tif (f && f.type == 'image/png') {\r\n\t\t\tvar reader = new FileReader()\r\n\t\t\t\r\n\t\t\treader.onload = (function(theFile) {\r\n\t\t\t\treturn (function(e) {\r\n\t\t\t\t\tthis.setBall(e.target.result)\r\n\t\t\t\t}).bind(this)\r\n\t\t\t}).bind(this)(f)\r\n\r\n\t\t\treader.readAsDataURL(f)\r\n\t\t}\r\n\t\telse if(f)\r\n\t\t\tthis.showErrors('image-not-png')\r\n\t},\r\n\tsetBall: function(chan) {\r\n\t\tlet src\r\n\t\tif (typeof chan === 'string') {\r\n\t\t\tsrc = chan\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (! chan.ball) {\r\n\t\t\t\tif(chan.section !== 'drafts') {\r\n\t\t\t\t\tsrc = `/chans/balls/${chan.section}/${chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.clear()\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsrc = chan.ball\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet $ball = $('#chanball').attr('src', src)\r\n\t\t$ball.one('load', () => {\r\n\t\t\tif ($ball.width() > 200 || $ball.height > 200) \r\n\t\t\t\tthis.showErrors('image-too-large')\r\n\t\t\telse {\r\n\t\t\t\tthis.file = src\r\n\t\t\t\tthis.fType = src.indexOf('data:') === 0 ? 'dataURL' : 'file'\r\n\t\t\t\tthis.showErrors([])\r\n\t\t\t\t$('#chanball-sect').addClass('chanball-present')\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tgradient.update()\r\n\t},\r\n\tclear: function() {\r\n\t\t$('#chanball-sect').removeClass('chanball-present')\r\n\t\tthis.file = null\r\n\t},\r\n\tgetData: function(isDraft) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet errors = []\r\n\t\t\tif (!this.file)\r\n\t\t\t\terrors.push('no-file')\r\n\t\t\t\r\n\t\t\tlet offset = ['left', 'top'].map(pos => {\r\n\t\t\t\tlet $input = $(jq`#position-tweak-${pos}`)\r\n\t\t\t\t, val = +$input.val()\r\n\t\t\t\tif (isNaN(val))\r\n\t\t\t\t\tval = 0\r\n\t\t\t\tif (Math.abs(val) > 100)\r\n\t\t\t\t\tval = 100 * Math.sign(val)\r\n\t\t\t\t$input.val(val)\r\n\t\t\t\treturn val\r\n\t\t\t})\r\n\r\n\t\t\t, catbg = ['from', 'to'].map(stop => {\r\n\t\t\t\tlet $input = $(jq`#bgc-${stop}`)\r\n\t\t\t\t, val = $input.val()\r\n\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\r\n\t\t\t\t\tval = 'ffffff'\r\n\t\t\t\t\t$input[0].jscolor.fromString(val)\r\n\t\t\t\t}\r\n\t\t\t\treturn val\r\n\t\t\t})\r\n\r\n\t\t\tthis.offset()\r\n\t\t\tgradient.update()\r\n\r\n\t\t\tthis.showErrors(errors)\r\n\r\n\t\t\tif (errors.length && !isDraft) \r\n\t\t\t\treject(errors)\r\n\t\t\telse resolve({\r\n\t\t\t\tball: this.fType === 'file' ? 'default' : this.file,\r\n\t\t\t\toffset: offset,\r\n\t\t\t\tcatbg: catbg\r\n\t\t\t})\r\n\t\t})\r\n\t\t\r\n\t},\r\n\ttoDataURL: function() {\r\n\t\tif (this.fType == 'data' || !this.file)\r\n\t\t\treturn\r\n\t\tgetDataUri(this.file, data => {\r\n\t\t\tthis.file = data,\r\n\t\t\tthis.fType = 'data'\r\n\t\t})\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'no-file': ' ',\r\n\t\t'image-not-png': '   (  PNG)',\r\n\t\t'image-too-large': '     200 ',\r\n\t\t'upload-error': '   '\r\n\t},\r\n\tfile: null, fType: null,\r\n\toffset: function() {\r\n\t\tlet top = +$('#position-tweak-top').val(),\r\n\t\tleft = +$('#position-tweak-left').val()\r\n\t\t$('#chanball').css({\r\n\t\t\t'transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-webkit-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-ms-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-moz-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-o-transform': `translate(${left}px, ${top}px)`\r\n\t\t})\r\n\t\treturn [top, left]\r\n\t},\r\n\tshowErrors: mkErrorShower('ball')\r\n}\r\n\r\nvar tree = {\r\n\tbuild: function(cats) {\r\n\t\tvar htm= ''\r\n\t\tif (cats) {\r\n\t\t\tif(typeof cats === 'string') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcats = JSON.parse(cats)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tthis.toggleView('JSON', true)\r\n\t\t\t\t\t$('#tree-json').val(cats)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (cats.length && this.isFlat(cats)) \r\n\t\t\t\tcats = [{name: '', boards: cats}]\r\n\t\t\tcats.forEach(cat => {\r\n\t\t\t\thtm += this.buildCat(cat)\r\n\t\t\t})\r\n\t\t}\r\n\t\t$('#categories').html(htm)\r\n\t\t\r\n\t\tdocument.querySelectorAll('.tree-cat ul').forEach(this.makeBoardsSortable.bind(this));\r\n\r\n\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\r\n\r\n\t\treturn this.validateUI()\r\n\t},\r\n\tisFlat: cats => cats[0].hasOwnProperty('dir'),\r\n\tboardHeight: 24,\r\n\taddBoardButtonHeight: 27,\r\n\tbuildCat: function(cat) {\r\n\t\tcat.boards = cat.boards || []\r\n\t\tvar boards = this.buildBoards(cat.boards)\r\n\t\t, empty = (cat.boards.length === 0)\r\n\t\t, maxHeight = (cat.boards.length+1) * this.boardHeight + this.addBoardButtonHeight\r\n\t\treturn `<div class=\"tree-cat ${empty ? 'empty': ''}\">\r\n\t\t<div class=\"tree-cathead\">\r\n\t\t\t<svg class=\"icon f-plus\" title=\"\"><use xlink:href=\"#i-folder-plus-fill\"></use></svg>\r\n\t\t\t<svg class=\"icon f-minus\" title=\"\"><use xlink:href=\"#i-folder-minus-fill\"></use></svg>\r\n\t\t\t<svg class=\"icon f-empty\"><use xlink:href=\"#i-folder-empty\"></use></svg>\r\n\t\t\t<input type=\"text\" class=\"cat-title\" value=\"${_.escape(cat.name) || ''}\"></input>\r\n\t\t\t<button class=\"b-option cat-undelete\" title=\" \">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-undo\"></use></svg>\r\n\t\t\t</button>\r\n\t\t\t<div class=\"cat-dragger\" title=\" \">\r\n\t\t\t\t<svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg>\r\n\t\t\t</div>\r\n\t\t\t<button class=\"b-option delb delcat\" title=\" \">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg>\r\n\t\t\t</button>\r\n\t\t</div>\r\n\t\t<div class=\"tree-catboards\" style=\"max-height: ${maxHeight}px\">${boards}</div></div>`\r\n\t},\r\n\tbuildBoards: function(boards) {\r\n\t\tvar htm ='<ul>'\r\n\t\tboards.forEach(brd => {\r\n\t\t\thtm += this.buildBoard(brd)\r\n\t\t})\r\n\t\thtm += `</ul><button class=\"tree-add add-board\" title=\" \">\r\n\t\t\t<div class=\"inner-border\">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-slash-plus-slash\"></use></svg>\r\n\t\t\t</div>\r\n\t\t</button>`\r\n\t\treturn htm\r\n\t},\r\n\tbuildBoard: brd => escHTML\r\n\t`<li class=\"cat-brd ${brd.external ? 'external' : ''}\">\r\n\t\t<input type=\"text\" class=\"board-dir\" value=\"${brd.dir || brd.url || ''}\">\r\n\t\t<input type=\"text\" class=\"board-desc\" value=\"${brd.desc || ''}\">\r\n\t\t<div class=\"dragger\" title=\" \"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\r\n\t\t<button class=\"b-option delb delboard\" title=\" \"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button>\r\n\t</li>`,\r\n\trecalcHeight: function($brds) {\r\n\t\tif (!($brds instanceof jQuery)) \r\n\t\t\t$brds = $($brds).parent()\r\n\t\tlet n = $brds.find('.cat-brd').length\r\n\t\t, px = (n+1) * this.boardHeight + this.addBoardButtonHeight\r\n\t\t$brds.css({'max-height': `${px}px`})\r\n\t\t$brds.parent().toggleClass('empty', n == 0)\r\n\t},\r\n\taddBoard: function($btn, board) {\r\n\t\tboard = board || {}\r\n\t\t$btn.parent().find('ul').append(this.buildBoard)\r\n\t\tthis.recalcHeight($btn.parent())\r\n\t\t$btn.parent().find('.cat-brd:last input:first').focus()\r\n\t},\r\n\tremoveBoard: function($btn) {\r\n\t\tlet $parent = $btn.parents('.tree-catboards')\r\n\t\t$btn.parents('.cat-brd').remove()\r\n\t\tthis.recalcHeight($parent)\r\n\t\tthis.validateUI()\r\n\t},\r\n\taddCategory: function(cat) {\r\n\t\tif (!cat.hasOwnProperty('boards'))\r\n\t\t\tcat = {name: '', boards: []}\r\n\t\tlet $cat = $(this.buildCat(cat))\r\n\t\tthis.makeBoardsSortable($cat.find('ul')[0])\r\n\t\t$('#categories').append($cat)\r\n\t\t$cat.find('.cat-title').focus()\r\n\t},\r\n\tremoveCategory: function($btn) {\r\n\t\t$btn.parents('.tree-cat').remove()\r\n\t\tthis.validateUI()\r\n\t},\r\n\tmakeBoardsSortable: function(el) {\r\n\t\tSortable.create(el, {\r\n\t\t\thandle: '.dragger',\r\n\t\t\tanimation: 150, \r\n\t\t\tgroup: 'boards',\r\n\t\t\tonAdd: ev => {\r\n\t\t\t\t[ev.from, ev.to].forEach(this.recalcHeight.bind(this))\r\n\t\t\t\tthis.validateUI()\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tvalidateJSON: function() {\r\n\t\ttry {\r\n\t\t\tlet cats = JSON.parse($('#tree-json').val())\r\n\t\t\tthis.build(cats)\r\n\t\t\treturn 1\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tthis.showErrors(e)\r\n\t\t\t$('#view-toggle').shake()\r\n\t\t\treturn 0\r\n\t\t}\r\n\t},\r\n\tvalidateUI: function(isDraft) {\r\n\t\tlet errors = []\r\n\t\t, obj = this.deconstruct()\r\n\r\n\t\tif ($('#tree .invalid').length)\r\n\t\t\t_.keys(this.errorDescriptors).forEach(r => {\r\n\t\t\t\tif ($(jq`#tree .invalid.inv_${r}`).length) \r\n\t\t\t\t\terrors.push(r)\r\n\t\t\t})\r\n\r\n\t\tlet allDirs = []\r\n\t\t, walkCat = brd => allDirs.push(brd.external ? brd.url : brd.dir)\r\n\r\n\t\tlet catNames = []\r\n\t\tobj.forEach(cat => {\r\n\t\t\tcatNames.push(cat.name)\r\n\t\t\tcat.boards.forEach(walkCat)\r\n\t\t})\r\n\t\tlet dupCats = findDuplicates(catNames)\r\n\t\tif (dupCats.length) {\r\n\t\t\terrors.push('mul-cat')\r\n\t\t\tlet $cats = $('.cat-title')\r\n\t\t\tdupCats.forEach(i => $($cats[i]).addClass('invalid'))\r\n\t\t}\r\n\r\n\t\tlet dupDirs = findDuplicates(allDirs)\r\n\t\tif (dupDirs.length) {\r\n\t\t\terrors.push('mul-dir')\r\n\t\t\tlet $dirs = $('.board-dir')\r\n\t\t\tdupDirs.forEach(i => $($dirs[i]).addClass('invalid'))\r\n\t\t}\r\n\r\n\t\tthis.showErrors(errors)\r\n\t\treturn (errors.length && !isDraft) ? false : obj\r\n\t},\r\n\tdeconstruct: function() {\r\n\t\t$('#tree .invalid').removeClass('invalid ' + \r\n\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\r\n\t\tlet cats = []\r\n\t\t, $cats = $('.tree-cat')\r\n\t\t, flat = false\r\n\t\tif ($cats.length == 1)\r\n\t\t\tflat = true\r\n\t\t$('.tree-cat').each(function() {\r\n\t\t\tvar $cat = $(this)\r\n\t\t\t, boards = []\r\n\t\t\t, $boards = $cat.find('.cat-brd')\r\n\t\t\tif (! $boards.length)\r\n\t\t\t\t$cat.addClass('invalid inv_empty-dir')\r\n\t\t\telse $boards.each(function() {\r\n\t\t\t\tlet $desc = $(this).find('.board-desc')\r\n\t\t\t\t, desc = $desc.val().trim()\r\n\t\t\t\tif (!desc) \r\n\t\t\t\t\t$desc.addClass('invalid inv_no-desc')\r\n\t\t\t\tlet board = {desc: desc}\r\n\r\n\t\t\t\tlet $dir = $(this).find('.board-dir')\r\n\t\t\t\t, dir = $dir.val().trim()\r\n\t\t\t\tif (!dir)\r\n\t\t\t\t\t$dir.addClass('invalid inv_no-dir')\r\n\r\n\t\t\t\tlet external = !! dir.match(/^https?:\\/\\//)\r\n\t\t\t\t$(this).toggleClass('external', external)\r\n\t\t\t\tboard[external ? 'url' : 'dir'] = dir\r\n\t\t\t\tif (external) \r\n\t\t\t\t\tboard.external = true\r\n\r\n\t\t\t\tboards.push(board)\r\n\t\t\t})\r\n\r\n\t\t\tlet $name = $cat.find('.cat-title')\r\n\t\t\t, name = $name.val().trim()\r\n\t\t\tif (!flat && ! name) {\r\n\t\t\t\t$name.addClass('invalid inv_no-name')\r\n\t\t\t}\r\n\t\t\tcats.push({\r\n\t\t\t\tname: name,\r\n\t\t\t\tboards: boards\r\n\t\t\t})\r\n\t\t})\r\n\t\treturn cats\r\n\t},\r\n\ttoggleView: function(to, isDraft) {\r\n\t\tlet current = $('#chan-structure').hasClass('sw_UI') ? 'UI' : 'JSON'\r\n\r\n\t\tif (typeof to === 'undefined') \r\n\t\t\tto = current=='UI' ? 'JSON' : 'UI'\r\n\r\n\t\tif (current == to)\r\n\t\t\treturn null\r\n\r\n\t\tif (to === 'JSON') {\r\n\t\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\tlet JSON_valid = this.validateJSON()\r\n\t\t\tif (isDraft)\r\n\t\t\t\treturn $('#tree-json').val()/*.replace(/\\t|\\n/g, '')*/\r\n\t\t\telse if (! JSON_valid) \r\n\t\t\t\treturn false\r\n\t\t}\r\n\r\n\t\t$('#chan-structure')\r\n\t\t.removeClass('sw_UI sw_JSON')\r\n\t\t.addClass(`sw_${to}`)\r\n\r\n\t\treturn 1\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'no-name': '  ',\r\n\t\t'no-dir': '  ',\r\n\t\t'no-desc': '  ',\r\n\t\t'mul-dir': '  ',\r\n\t\t'mul-cat': '  ',\r\n\t\t'empty-dir': ' ',\r\n\t\t'bad-json': 'JSON  '\r\n\t},\r\n\tshowErrors: mkErrorShower('struct')\r\n}\r\n\r\nfunction mkErrorShower(id) {\r\n\treturn function(errs) {\r\n\t\tif (! (errs instanceof Array))\r\n\t\t\terrs = [errs]\r\n\t\tlet $tipper = id instanceof jQuery ? id : $(jq`#${id}-tipper`)\r\n\t\t, $msgbox = $tipper.find('.error-msg .tooltip')\r\n\t\t, any = errs.length > 0\r\n\t\t, mul = errs.length > 1\r\n\t\tlet htm = (mul ? ` : <ul>` : '')\r\n\t\t+ errs.reduce((htm, er) => htm + escHTML`${mul ? '<li>' : ''}${this.errorDescriptors && this.errorDescriptors[er] || er}${mul ? '</li>' : ''}`, '')\r\n\t\t+ (mul ? '</ul>' : '')\r\n\t\t$msgbox.html(htm)\r\n\t\t$tipper.setTipperState(any ? 'error-tip' : 'question')\r\n\t\tif (any) \r\n\t\t\t$tipper.shake()\r\n\t\tif(this instanceof HTMLElement) {\r\n\t\t\t$(this).toggleClass('invalid', any)\r\n\t\t}\r\n\t}\r\n}\r\n\r\n$.fn.shake = function() {\r\n\tthis.addClass('shake')\r\n\tsetTimeout(() => this.removeClass('shake'), 900)\r\n}\r\n$.fn.setTipperState = function(state) {\r\n\tthis.removeClass(_.without(['question', 'error-tip', 'spinner', 'valid'], state).join(' '))\r\n\t.addClass(state)\r\n}\r\n\r\n/*function hasDuplicates(a) {\r\n\treturn _.uniq(a).length !== a.length; \r\n}*/\r\n\r\nfunction findDuplicates(arr) {\r\n\tlet dubs = []\r\n\tarr.forEach((el, i) => {\r\n\t\tif (arr.length - _.without(arr, el).length > 1)\r\n\t\t\tdubs.push(i)\r\n\t})\r\n\treturn dubs\r\n}\r\n\r\nvar styles = {\r\n\tpreamble: function(role) {\r\n\t\tlet vars = []\r\n\t\t;['chan-id', 'bgColor', 'linkColor'].forEach(v =>\r\n\t\t\tvars[v] = (role == 'html')\r\n\t\t\t\t? `<span class=\"binded\" data-bind=\"${v}\"></span>`\r\n\t\t\t\t: $(jq`#${v}`).val()\r\n\t\t)\r\n\t\tif (role == 'less')\r\n\t\t\tvars['chan-id'] = 'css-preview'\r\n\t\treturn `.chan-${vars['chan-id']} {`+\r\n\t\t\t`\\n  @bgcolor: #${vars.bgColor};`+\r\n\t\t\t`\\n  @linkcolor: #${vars.linkColor};`;\r\n\t},\r\n\tupdate: function(callback) {\r\n\t\tcallback = (typeof callback === 'function') ? callback : null\r\n\t\tlet userCode = this.parseInput()\r\n\t\tif (!userCode) {\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(false)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet lessCode = this.preamble('less') + userCode + '}';\r\n\t\tless.render(lessCode).then(r => {\r\n\t\t\tinjector.inject('chanclass-preview', r.css)\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(true)\r\n\t\t},\r\n\t\terr => {\r\n\t\t\tthis.showErrors(err.message)\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(false)\r\n\t\t})\r\n\t},\r\n\tgetData: function(isDraft) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet res = {\r\n\t\t\t\tcolors: ['bg', 'link'].map(c => {\r\n\t\t\t\t\tlet $input = $(jq`#${c}Color`)\r\n\t\t\t\t\t, val = $input.val()\r\n\t\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\r\n\t\t\t\t\t\tval = $input.attr('value')\r\n\t\t\t\t\t\t$input[0].jscolor.fromString(val)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn val\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif ($('#advance-less').prop('checked')) {\r\n\t\t\t\tres.advanced_less = lessFormatter.minify($('#less-enter').val())\r\n\t\t\t\tthis.update(succ => {\r\n\t\t\t\t\tif (isDraft || succ) \r\n\t\t\t\t\t\tresolve(res) \r\n\t\t\t\t\telse \r\n\t\t\t\t\t\treject()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse resolve(res)\r\n\t\t})\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'bracket-imbalance': '  ',\r\n\t\t// 'parent-selector': '   (&)  (    )'\r\n\t},\r\n\tparseInput: function() {\r\n\t\tlet errors_found = []\r\n\t\t, val = $('#less-enter').val()\r\n\t\t// check for bracket balance | http://codereview.stackexchange.com/a/15339\r\n\t\tlet brackets = val.replace(/\\/\\*.+?\\*\\/|\".+?\"|'.+?'/, '').replace(/[^()\\[\\]{}]/g, '')\r\n\t\t, isBalanced = (function(str) {\r\n\t\t\tvar bracket = {\r\n\t\t\t\t\"]\": \"[\",\r\n\t\t\t\t\"}\": \"{\",\r\n\t\t\t\t\")\": \"(\"\r\n\t\t\t},\r\n\t\t\topenBrackets = [], \r\n\t\t\tisClean = true,\r\n\t\t\ti = 0,\r\n\t\t\tlen = str.length;\r\n\r\n\t\t\tfor(; isClean && i<len; i++ ){\r\n\t\t\t\tif ( bracket[ str[ i ] ] ){\r\n\t\t\t\t\tisClean = ( openBrackets.pop() === bracket[ str[ i ] ] );\r\n\t\t\t\t}else{\r\n\t\t\t\t\topenBrackets.push( str[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn isClean && !openBrackets.length;\r\n\t\t})(brackets)\r\n\t\t\r\n\t\tif (!isBalanced)\r\n\t\t\terrors_found.push('bracket-imbalance')\r\n\r\n\t\t// check for parent selectors\r\n\t\t/*if (val.match(/&(?![:\\.])/))\r\n\t\t\terrors_found.push('parent-selector')*/\r\n\r\n\t\tthis.showErrors(errors_found)\r\n\r\n\t\treturn errors_found.length ? false : val\r\n\t},\r\n\tshowErrors: mkErrorShower('style'),\r\n\treset: function() {\r\n\t\t;['bg', 'link'].forEach(field => {\r\n\t\t\tlet $input = $(jq`#${field}Color`)\r\n\t\t\t$input[0].jscolor.fromString($input.data('default'))\r\n\t\t})\r\n\t\t$('#advance-less').prop('checked', 0).trigger('change')\r\n\t\tthis.update()\r\n\t\t$('#custom-css').prop('checked', 0).trigger('change')\r\n\t}\r\n}\r\n\r\nstyles.base = `background: @bgcolor;\r\na, .chan-overlay .icon {\r\n\tcolor: @linkcolor;\r\n}\r\n&:hover {\r\n\tbackground: darken(@bgcolor, 8%);\r\n}\r\n&.onchan {\r\n\tbox-shadow: inset -2px 0 fadeout(@linkcolor, 25%);\r\n}\r\n& when (lightness(@bgcolor) < 70%) {\r\n\tcolor: #C3C3C3;\r\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\r\n\t\tcolor: white;\r\n\t}\r\n\t.board:hover {\r\n\t\tbackground: rgba(255, 255, 255, .08);\r\n\t}\r\n}\r\n& when (lightness(@bgcolor) > 70%) {\r\n\tcolor: #404040;\r\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\r\n\t\tcolor: black;\r\n\t}\r\n\t.board:hover {\r\n\t\tbackground: rgba(0, 0, 0, .08);\r\n\t}\r\n}\r\n`;\r\n\r\n\r\nvar radio = {\r\n\tbuildStream: strm => escHTML\r\n\t`<li class=\"stream${strm.n ? ' templated' : ''}\">\r\n\t\t<input type=\"text\" class=\"stream-name\" placeholder=\" \" title=\" \" maxlength=\"20\" value=\"${strm.name || ''}\">\r\n\t\t<input type=\"text\" class=\"stream-range\" placeholder=\"\" title=\"\" maxlength=\"20\" value=\"${strm.n || ''}\">\r\n\t\t<div class=\"stream-options\">\r\n\t\t\t<button class=\"b-option templatize\" title=\"  \"><svg class=\"icon\">\r\n\t\t\t\t<use class=\"for-templated-hide\" xlink:href=\"#i-template\"></use>\r\n\t\t\t\t<use class=\"for-templated-show\" xlink:href=\"#i-untemplate\"></use>\r\n\t\t\t</svg></button>\r\n\t\t\t<div class=\"dragger\" title=\" \"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\r\n\t\t\t<button class=\"b-option delstream\" title=\" \"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button><br>\r\n\t\t</div>\r\n\t\t<br>\r\n\t\t<input type=\"text\" class=\"stream-path\" placeholder=\"/path \" title=\"/path \" maxlength=\"50\" value=\"${strm.path || ''}\">\r\n\t\t<input type=\"text\" class=\"stream-mime\" placeholder=\"MIME \" title=\"MIME \" maxlength=\"20\" value=\"${strm.mime || ''}\">\r\n\t</li>`,\r\n\taddStream: function(strm) {\r\n\t\tstrm = strm || {}\r\n\t\tlet $strm = $(this.buildStream(strm))\r\n\t\t$('#streams').append($strm)\r\n\t},\r\n\tbuild: function(r) {\r\n\t\t$('#chan-radiourl').val(r.url)\r\n\t\t$('#streams').html(r.streams.reduce((htm, strm) => htm + this.buildStream(strm), ''))\r\n\t},\r\n\tremoveStream: $btn => $btn.parents('.stream').remove(),\r\n\treset: function() {\r\n\t\tthis.build({url: '', streams: []})\r\n\t\t$('#radio-editor').hide()\r\n\t\t$('#radio').prop('checked', false)\r\n\t},\r\n\tgetData: function(isDraft) { //aka validate\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet proceed = (url, errors) => {\r\n\t\t\t\terrors = errors ? errors.map(v => `URL: ${v}`) : []\r\n\t\t\t\t$('#chan-radiourl').toggleClass('invalid', !!errors.length)\r\n\r\n\t\t\t\t$('#streams input').removeClass('invalid ' + \r\n\t\t\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\r\n\t\t\t\tlet streams = []\r\n\t\t\t\t, $streams = $('.stream')\r\n\t\t\t\tif (! $streams.length)\r\n\t\t\t\t\terrors.push('no-streams')\r\n\t\t\t\telse {\r\n\t\t\t\t\t$streams.each(function() {\r\n\t\t\t\t\t\tlet $strm = $(this)\r\n\t\t\t\t\t\t, stream = {}\r\n\t\t\t\t\t\t;['name', 'path', 'mime'].forEach(prop => {\r\n\t\t\t\t\t\t\tlet $input = $strm.find(`.stream-${prop}`)\r\n\t\t\t\t\t\t\t, val = $input.val()\r\n\t\t\t\t\t\t\tif(!val)\r\n\t\t\t\t\t\t\t\t$input.addClass(`invalid inv_no-${prop}`)\r\n\t\t\t\t\t\t\tstream[prop] = val\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tstreams.push(stream)\r\n\r\n\t\t\t\t\t\tif ($strm.hasClass('templated')) {\r\n\t\t\t\t\t\t\tlet $range = $strm.find(`.stream-range`)\r\n\t\t\t\t\t\t\t, n = $range.val()\r\n\t\t\t\t\t\t\tif (! n)\r\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_no-range')\r\n\t\t\t\t\t\t\telse if(! mixedRange(n).length)\r\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_bad-range')\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tstream.n = n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tif ($('#streams .invalid').length)\r\n\t\t\t\t\t\t_.keys(this.errorDescriptors).forEach(r => {\r\n\t\t\t\t\t\t\tif ($(jq`#streams .invalid.inv_${r}`).length) \r\n\t\t\t\t\t\t\t\terrors.push(r)\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t;['name', 'path'].forEach(prop => {\r\n\t\t\t\t\t\tlet dupProps = findDuplicates(_.pluck(streams, prop))\r\n\t\t\t\t\t\tif (dupProps.length) {\r\n\t\t\t\t\t\t\terrors.push(`mul-${prop}`)\r\n\t\t\t\t\t\t\tlet $inputs = $(jq`.stream-${prop}`)\r\n\t\t\t\t\t\t\tdupProps.forEach(i => $($inputs[i]).addClass('invalid'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.showErrors(errors)\r\n\r\n\t\t\t\tif (!isDraft && errors.length)\r\n\t\t\t\t\treject(errors)\r\n\t\t\t\telse\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\turl: url,\r\n\t\t\t\t\t\tstreams: streams\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t$('#chan-radiourl')[0].validate(true).then(val => {\r\n\t\t\t\tproceed(val, null)\r\n\t\t\t},\r\n\t\t\terrors => {\r\n\t\t\t\tproceed(null, errors)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tshowErrors: mkErrorShower('radio'),\r\n\terrorDescriptors: {\r\n\t\t'no-streams': '    ',\r\n\t\t'no-name': '  ',\r\n\t\t'no-path': '   ',\r\n\t\t'no-mime': ' MIME',\r\n\t\t'mul-name': '  ',\r\n\t\t'mul-path': '   ',\r\n\t\t'no-range': '   ',\r\n\t\t'bad-range': '   '\r\n\t}\r\n}\r\n\r\nvar library = {\r\n\tbuild: function(chans, section) {\r\n\t\tchans.forEach(chan => this.addChan(chan, section || (chan.default ? 'default' : 'custom')))\r\n\t},\r\n\tbuildChan: function(chan, section) {\r\n\t\tsection = section || chan.section\r\n\t\tif (! section)\r\n\t\t\treturn console.error('No section specified for buildChan()')\r\n\t\tlet ballSrc = chan.ball || `/chans/balls/${section}/${section == 'drafts' ? 'no-ball' : chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\r\n\t\t, search = `${chan.id} ${chan.name} ${chan.url.replace(/^https?:\\/\\//, '')} ${(chan.wiki || '').replace(/^https?:\\/\\//, '')}`\r\n\t\t.toLowerCase().trim().replace(/[<>\"\"]/g, '')\r\n\t\t, dlbtn = section === 'drafts' ? `\r\n\t\t<button class=\"btn export-draft\">\r\n\t\t\t<svg class=\"icon\" title=\" \"><use xlink:href=\"#i-download\"></use></svg>\r\n\t\t</button>` : ''\r\n\t\t, htm = escHTML`<li class=\"lib-chan sect-${section}${!chan.name ? ' no-name' : ''}\" id=\"chan_${chan.id}\" data-search=\"${search}\">\r\n\t\t\t<img src=\"${ballSrc}\" class=\"lib-chanball\">\r\n\t\t\t<div class=\"chan-title\">${chan.name || ' '}</div>`+dlbtn+`\r\n\t\t</li>`\r\n\t\t, $chan = $(htm)\r\n\t\tchan.section = section\r\n\t\t$chan[0]._libdata = chan\r\n\t\treturn $chan\r\n\t},\r\n\taddChan: function(chan, section, fresh) {\r\n\t\tif (typeof fresh === 'undefined') fresh = false\r\n\t\tsection = section || chan.section\r\n\t\tif (! section)\r\n\t\t\treturn console.error('No section specified for addChan()')\r\n\t\tlet $chan = this.buildChan(chan, section)\r\n\t\t$chan.appendTo('#chans')\r\n\t\tfresh && this.highlight($chan)\r\n\t\tlet libdata = $chan[0]._libdata\r\n\t\treturn libdata\r\n\t},\r\n\teditChan: function(chan) {\r\n\t\tlet $chan = $(jq`#chan_${chan.id}`)\r\n\t\t, libdata = $chan[0]._libdata\r\n\t\t_.assign(libdata, chan)\r\n\t\t$chan.replaceWith(this.buildChan(libdata, libdata.section))\r\n\t\tthis.highlight($(jq`#chan_${chan.id}`))\r\n\t\treturn libdata\r\n\t},\r\n\tdeleteChan: function(id) {\r\n\t\t$(jq`#chan_${id}`).remove()\r\n\t},\r\n\thighlight: function($chan) {\r\n\t\tlet sect = $chan[0]._libdata.section\r\n\t\t$(jq`.tab[data-tab=${sect}]`).click()\r\n\t\t$chan.addClass('fresh')\r\n\t\ttoggleLib(true)\r\n\t}\r\n}\r\n\r\nvar libchan = {\r\n\tload: function(chan) {\r\n\t\tupForm.toggle()\r\n\r\n\t\tthis.current = chan\r\n\r\n\t\tthis.current.default = +(chan.section == 'default')\r\n\t\tthis.current.included = +chan.included\r\n\r\n\t\tthis.setMode('edit', chan.section)\r\n\r\n\t\t$('#chan-id').val(chan.id)\r\n\t\t$('#chan-name').val(chan.name).trigger('input')\r\n\t\t$('#chan-url').val(chan.url)\r\n\t\t$('#chan-wiki').val(chan.wiki || '')\r\n\t\t$('#chan-userboards').val(chan.userboards || '')\r\n\t\t$('#chan-userboards_catname').val(chan.userboards_catname || '2.0')\r\n\t\t$('#chan-userboards_system').val(chan.userboards_system || 'instant')\r\n\t\t\r\n\t\tball.setBall(chan)\r\n\r\n\t\tlet offset = chan.offset || [0, 0]\r\n\t\t$('#position-tweak-left').val(offset[0])\r\n\t\t$('#position-tweak-top').val(offset[1])\r\n\t\tball.offset()\r\n\r\n\t\t$('#bgc-from')[0].jscolor.fromString(chan.catbg[0])\r\n\t\t$('#bgc-to')[0].jscolor.fromString(chan.catbg[1])\r\n\t\tgradient.update()\r\n\r\n\t\t$('#chan-prefix').val(chan.prefix || '')\r\n\t\t$('#chan-postfix').val(chan.postfix || '')\r\n\r\n\t\ttree.build(chan.boards)\r\n\r\n\t\t$('#custom-css').prop('checked', !!chan.colors)\r\n\t\tif (chan.colors) {\r\n\t\t\t$('#color-theme').show()\r\n\t\t\t$('#bgColor')[0].jscolor.fromString(chan.colors[0])\r\n\t\t\t$('#linkColor')[0].jscolor.fromString(chan.colors[1])\r\n\t\t\tif (chan.advanced_less) {\r\n\t\t\t\t$('#advance-less').prop('checked', 1).trigger('change')\r\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(chan.advanced_less))\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(styles.base))\r\n\t\t\t\t$('#advance-less').prop('checked', 0).trigger('change')\r\n\t\t\t}\r\n\t\t\tstyles.update()\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstyles.reset()\r\n\t\t}\r\n\t\t\r\n\t\tif (chan.radio) {\r\n\t\t\t$('#radio-editor').show()\r\n\t\t\tradio.build(chan.radio)\r\n\t\t\t$('#radio').prop('checked', true)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tradio.reset()\r\n\t\t}\r\n\r\n\t\t$('#default').prop('checked', chan.section === 'default')\r\n\t\t$('#included').prop('checked', !!chan.included)\r\n\r\n\t\tthis.rinse()\r\n\t},\r\n\t_schema: {\r\n\t\tintegrity: {\r\n\t\t\trequired: ['id', 'name', 'url', 'boards', 'ball', 'offset', 'catbg'],\r\n\t\t\toptional: ['userboards', 'prefix', 'postfix', 'wiki', 'radio', 'colors', 'advanced_less', 'userboards_catname', 'userboards_system'],\r\n\t\t\tadminOnly: ['default', 'included']\r\n\t\t},\r\n\t\tspecialComps: {\r\n\t\t\tpairs: ['catbg', 'offset', 'colors'],\r\n\t\t\tobjects: ['boards', 'radio'],\r\n\t\t\tisNewBall: ['ball']\r\n\t\t},\r\n\t\tconversions: {\r\n\t\t\ttoFile: ['ball']\r\n\t\t},\r\n\t\tdefaults: {\r\n\t\t\t'': ['userboards', 'prefix', 'postfix', 'wiki'],\r\n\t\t\t'FFFFFF|FFFFFF': ['catbg'],\r\n\t\t\t'0|0': ['offset'],\r\n\t\t\t'2C333D|37C999': ['colors'],\r\n\t\t\t'2.0': ['userboards_catname'],\r\n\t\t\t'instant': ['userboards_system']\r\n\t\t},\r\n\t\tfns: {\r\n\t\t\tobjects: _.eq.bind(_),\r\n\t\t\tpairs: (first, second) => {\r\n\t\t\t\tlet vals = [first, second].map(val => (val instanceof Array) ? val.join('|').toLowerCase() : val)\r\n\t\t\t\treturn vals[0] === vals[1]\r\n\t\t\t},\r\n\t\t\tisNewBall: (cur, nu) => cur ? (nu===cur) : (nu==='default'),\r\n\t\t\ttoFile: v => v.indexOf('data:') === 0 ? v.toBlob() : v\r\n\t\t}\r\n\t},\r\n\tinit: function() {\r\n\t\tlet allProps = []\r\n\t\t, schema = {}\r\n\r\n\t\t_.each(this._schema.integrity, (props, intCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop] = {}\r\n\t\t\t\tschema[prop][intCls] = true\r\n\t\t\t\tif (intCls === 'optional')\r\n\t\t\t\t\tschema[prop].default = null\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.specialComps, (props, cmpCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].eqFn = this._schema.fns[cmpCls]\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.conversions, (props, convCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].conv = this._schema.fns[convCls]\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.defaults, (props, defCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].default = defCls\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t/*schema.offset.default = '0|0'\r\n\t\tschema.catbg.default = 'ffffff|ffffff'\r\n*/\r\n\t\tthis.schema = schema\r\n\t},\r\n\tmode: 'new',\r\n\tsetMode: function(mode, section) {\r\n\t\tthis.mode = mode\r\n\t\t$('body').toggleClass('edit-draft', mode === 'edit' && section === 'drafts')\r\n\t\t$('#chan-id, #save-draft').prop('disabled', mode === 'edit' && section !== 'drafts')\r\n\t\t$('#clone-this, #delete-this').prop('disabled', mode === 'new')\r\n\t},\r\n\trinse: () => {\r\n\t\t$('.tipper').setTipperState('question')\r\n\t\t$('input').removeClass('invalid')\r\n\t},\r\n\tcollectData: function(role) {\r\n\t\tlet isDraft = (role === 'draft')\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet chan = {}\r\n\t\t\t, dataPromises = []\r\n\t\t\t// basic data\r\n\t\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'userboards_catname', 'prefix', 'postfix'].forEach(prop => {\r\n\t\t\t\tlet pr = $(jq`#chan-${prop}`)[0].validate(0, isDraft).then(val => {\r\n\t\t\t\t\tchan[prop] = val\r\n\t\t\t\t})\r\n\t\t\t\tdataPromises.push(pr)\r\n\t\t\t})\r\n\t\t\t// ball data\r\n\t\t\tdataPromises.push(ball.getData(isDraft).then(data => {\r\n\t\t\t\t_.assign(chan, data)\r\n\t\t\t}))\r\n\t\t\t// tree data\r\n\t\t\tdataPromises.push(new Promise((resolve, reject) => {\r\n\t\t\t\tlet treeToUI = tree.toggleView('UI', isDraft)\r\n\t\t\t\tif (treeToUI)\r\n\t\t\t\t\tresolve(treeToUI)\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (treeToUI === false)\r\n\t\t\t\t\t\treject()\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet validUI = tree.validateUI(isDraft)\r\n\t\t\t\t\t\tif (validUI)\r\n\t\t\t\t\t\t\tresolve(validUI)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tchan.boards = (tree.toggleView('UI') === false) ? false : tree.validateUI()\r\n\t\t\t}).then(data => {\r\n\t\t\t\tchan.boards = data\r\n\t\t\t}))\r\n\t\t\tchan.userboards_system = $('#chan-userboards_system').val()\r\n\t\t\t// options: radio\r\n\t\t\tif ($('#radio').prop('checked')) {\r\n\t\t\t\tdataPromises.push(radio.getData(isDraft).then(data => {\r\n\t\t\t\t\tchan.radio = data\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\t// options: styles\r\n\t\t\tif ($('#custom-css').prop('checked')) {\r\n\t\t\t\tdataPromises.push(styles.getData(isDraft).then(data => {\r\n\t\t\t\t\t_.assign(chan, data)\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\t// options: admy\r\n\t\t\tif (IS_ADMIN) {\r\n\t\t\t\tlet admy = {}\r\n\t\t\t\t;['default', 'included'].forEach(prop => {\r\n\t\t\t\t\tadmy[prop] = +$(jq`#${prop}`).prop('checked')\r\n\t\t\t\t})\r\n\t\t\t\t_.assign(chan, admy)\r\n\t\t\t}\r\n\r\n\t\t\tPromise.all(dataPromises).then(() => resolve(chan), () => reject('fix-errors'))\r\n\t\t})\r\n\t},\r\n\tproceedWithData: function(role, isUpload) {\r\n\t\tlet mode = (isUpload && this.current && this.current.section === 'drafts') ? 'new' : this.mode\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet fd = new FormData(), chan = {}\r\n\t\t\t, errors = []\r\n\t\t\tthis.collectData(role).then(data => {\r\n\t\t\t\tif (mode === 'edit' && libchan.current.id !== data.id) {\r\n\t\t\t\t\terrors.push('id-changed')\r\n\t\t\t\t}\r\n\t\t\t\t_.each(this.schema, (propSchema, prop) => {\r\n\t\t\t\t\tlet val\r\n\r\n\t\t\t\t\tif (propSchema.adminOnly && !IS_ADMIN)\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tif (! data.hasOwnProperty(prop)) {\r\n\t\t\t\t\t\tif (propSchema.required)\r\n\t\t\t\t\t\t\terrors.push('fill-required-fields')\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tval = null\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tval = data[prop]\r\n\r\n\t\t\t\t\tif (mode === 'edit' && prop !== 'id') {\r\n\t\t\t\t\t\tlet cur = libchan.current.hasOwnProperty(prop) ? libchan.current[prop] : propSchema.default\r\n\t\t\t\t\t\tif (propSchema.eqFn ? propSchema.eqFn(cur, val) : (cur===val))\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (val === null)\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tchan[prop] = val\r\n\t\t\t\t\tif (role === 'upload') {\r\n\t\t\t\t\t\tif (propSchema.conv)\r\n\t\t\t\t\t\t\tval = propSchema.conv(val)\r\n\t\t\t\t\t\tfd.apnd(prop, val)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tif (errors.length) {\r\n\t\t\t\t\treject(_.uniq(errors))\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (DO_DEBUG)\r\n\t\t\t\t\t\tconsole.log(chan)\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\tobj: chan,\r\n\t\t\t\t\t\tfd: fd\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}, \r\n\t\t\terrors => {\r\n\t\t\t\treject(errors)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tclone: function() {\r\n\t\tthis.setMode('new')\r\n\t\tball.toDataURL()\r\n\t\t$('#chan-id').val('')\r\n\t\t$('#chan-name')[0].value += ' ()'\r\n\t\t$('#chan-name').trigger('input')\r\n\t},\r\n\tclear: function() {\r\n\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'prefix', 'postfix']\r\n\t\t.forEach(field => $(jq`#chan-${field}`).val(''))\r\n\t\t$('#chan-userboards_catname').val('2.0')\r\n\t\tball.clear()\r\n\t\t;['from', 'to'].forEach(field => $(jq`#bgc-${field}`)[0].jscolor.fromString('ffffff'))\r\n\t\tgradient.update()\r\n\t\t;[radio, styles].forEach(w => w.reset())\r\n\t\ttree.build('[]')\r\n\t\ttree.toggleView('UI')\r\n\t\tthis.rinse()\r\n\t\tthis.current = null\r\n\t\tthis.setMode('new')\r\n\t\tupForm.toggle()\r\n\t}\r\n}\r\n\r\nvar drafts = {\r\n\tmodel: [],\r\n\tload: function() {\r\n\t\tlet lsDrafts = localStorage['mydrafts']\r\n\t\tif (lsDrafts) \r\n\t\t\ttry {\r\n\t\t\t\tlet parsed = JSON.parse(lsDrafts)\r\n\t\t\t\tif (typeof parsed !== 'object' || !parsed.hasOwnProperty('chans'))\r\n\t\t\t\t\tthrow new Error()\r\n\t\t\t\tthis.model = parsed.chans\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tconsole.error('Drafts in localStorage are corrupted and will be purged')\r\n\t\t\t\tlocalStorage.removeItem('mydrafts')\r\n\t\t\t}\r\n\t\tlibrary.build(this.model, 'drafts')\r\n\t},\r\n\tremove: function(id) {\r\n\t\tthis.model.splice(_.findIndex(this.model, {id: id}), 1)\r\n\t\tlibrary.deleteChan(id)\r\n\t\tlibchan.setMode('new')\r\n\t\tthis.sync()\r\n\t},\r\n\tadd: function(chan, over) {\r\n\t\tlet libdata = library.addChan(chan, 'drafts', 1)\r\n\t\tthis.model.push(chan)\r\n\t\tlibchan.current = libdata\r\n\t\tlibchan.setMode('edit', 'drafts')\r\n\t},\r\n\tedit: function(chan) {\r\n\t\tlet edited = library.editChan(chan)\r\n\t\tthis.model[_.findIndex(this.model, {id: chan.id})] = edited\r\n\t},\r\n\tsync: function() {\r\n\t\tlocalStorage['mydrafts'] = JSON.stringify({\r\n\t\t\tchans: this.model,\r\n\t\t\tversion: new Date().getTime()\r\n\t\t})\r\n\t},\r\n\tsubmit: function(over) {\r\n\t\tlet newid = $('#chan-id').val()\r\n\t\tif (libchan.mode === 'edit' && libchan.current.id !== newid) {\r\n\t\t\t$(\"#id-to-change\").text(libchan.current.id)\r\n\t\t\tupForm.toggle('prompt pr-idchanged')\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse if (libchan.mode === 'new' && _.find(this.model, {id: newid})) {\r\n\t\t\t$(\"#id-to-overwrite\").text(newid)\r\n\t\t\tlet guro = /(.+?)(\\d+)$/.exec(newid)\r\n\t\t\t$(\"#proposed-id\").text(guro ? `${guro[1]}${(+guro[2])+1}` : `${newid}2`)\r\n\t\t\tupForm.toggle('prompt pr-idexists')\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse {\r\n\t\t\tupForm.toggle()\r\n\t\t}\r\n\t\tlibchan.proceedWithData('draft')\r\n\t\t.then(res => {\r\n\t\t\tlet draft = res.obj\r\n\t\t\tif (libchan.mode === 'edit') {\r\n\t\t\t\tthis.edit(draft)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.add(draft)\r\n\t\t\t}\r\n\t\t\tthis.sync()\r\n\t\t}, errors => {\r\n\t\t\tupForm.showErrors(errors)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nlibchan.init()\r\n\r\nvar lessFormatter = {\r\n\tminify: less => less.replace(/\\n/g, ' ').replace(/\\s{2,}/g, ' ').trim(),\r\n\tprettify: function(less) {\r\n\t\treturn css_beautify(this.minify(less).replace(/([;{}])/g, '$1\\n').replace(/^\\s+/gm, '').trim(), {\r\n\t\t\t'indent_char': '\\t', \r\n\t\t\t'indent_size': 1, \r\n\t\t\t'newline_between_rules': false\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar validations = {\r\n\turlencode: val => encodeURI(val),\r\n\tcheckuniq: (val, prop) => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif(libchan.mode === 'edit' && libchan.current[prop]===val) {\r\n\t\t\t\tresolve()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t$.get(`api.php?checkuniq&prop=${prop}&val=${encodeURIComponent(val)}`)\r\n\t\t\t.then(data => {\r\n\t\t\t\tif (data.error)\r\n\t\t\t\t\treject('occupied')\r\n\t\t\t\telse \r\n\t\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t\t.fail(er => {\r\n\t\t\t\tconsole.error('XHR error during post-validation', er)\r\n\t\t\t\treject('XHR error')\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// eeeee prototypes\r\nNodeList.prototype.forEach = Array.prototype.forEach;\r\nNodeList.prototype.map = Array.prototype.map;\r\nFormData.prototype.apnd = function(k, v) {\r\n\tif (typeof v === 'object' && !( v instanceof Blob ))\r\n\t\tthis.append(k, JSON.stringify(v))\r\n\telse\r\n\t\tthis.append(k, v)\r\n}\r\nFormData.prototype.inspect = function() {\r\n\tfor (var pair of this.entries()) {\r\n\t\tconsole.log(pair[0]+ ' = ' + pair[1]); \r\n\t}\r\n}\r\n// Functions ooriginally from here:\r\n// http://stackoverflow.com/a/30407959/1561204\r\nBlob.prototype.readAsDataURL = function(callback) {\r\n\tlet fr = new FileReader();\r\n\tfr.onload = ev => callback(ev.target.result)\r\n\tfr.readAsDataURL(this);\r\n}\r\nString.prototype.toBlob = function() {\r\n\ttry {\r\n\t\tlet arr = this.split(','), mime = arr[0].match(/:(.*?);/)[1],\r\n\t\t\tbstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\r\n\t\twhile(n--){\r\n\t\t\tu8arr[n] = bstr.charCodeAt(n);\r\n\t\t}\r\n\t\treturn new Blob([u8arr], {type:mime});\r\n\t}\r\n\tcatch (e) {\r\n\t\tconsole.error(e)\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\n// https://davidwalsh.name/convert-image-data-uri-javascript\r\nfunction getDataUri(url, callback) {\r\n\tvar image = new Image();\r\n\r\n\timage.onload = function () {\r\n\t\tvar canvas = document.createElement('canvas');\r\n\t\tcanvas.width = this.naturalWidth;\r\n\t\tcanvas.height = this.naturalHeight;\r\n\t\tcanvas.getContext('2d').drawImage(this, 0, 0);\r\n\t\tcallback(canvas.toDataURL('image/png'));\r\n\t};\r\n\r\n\timage.src = url;\r\n}\r\n\r\nfunction mixedRange(input) {\r\n\tvar m\r\n\t, output = []\r\n\t, re = /(?:([0-9]+)(?:\\-([0-9]+))?(?:, ?)?)/g;\r\n\t\r\n\twhile ((m = re.exec(input)) !== null) {\r\n\t\tif (m.index === re.lastIndex) {\r\n\t\t\tre.lastIndex++;\r\n\t\t}\r\n\t\tif(m[2]) {\r\n\t\t\toutput = output.concat(_.range(m[1], +m[2]+1))\r\n\t\t}\r\n\t\telse\r\n\t\t\toutput.push(+m[1])\r\n\t}\r\n\r\n\treturn output\r\n}\r\n\r\nvar upForm = {\r\n\t$form: null,\r\n\tinit: function() {\r\n\t\tthis.$form = $('#upload-form').on('submit', this.submit.bind(this))\r\n\t\t_.each(this.actorFieldMap, (fields, actor) => {\r\n\t\t\tfields.forEach(field => this.fieldActorMap[field] = actor)\r\n\t\t})\r\n\t},\r\n\ttoggle: function(type) {\r\n\t\tif (! type)\r\n\t\t\tthis.$form.removeClass('expanded')\r\n\t\telse {\r\n\t\t\tthis.$form.removeClass('f-upload f-delete f-prompt pr-idchanged pr-idexists').addClass(`f-${type} expanded`)\r\n\t\t\tlet draftDelete = libchan.current && libchan.current.section === 'drafts' && type === 'delete'\r\n\t\t\t$('#upload-form input').prop('required', !draftDelete)\r\n\t\t\tif (!draftDelete && $('.captcha').hasClass('not-loaded'))\r\n\t\t\t\trefreshCaptcha()\r\n\t\t}\r\n\t},\r\n\tcheckFields: function() {\r\n\t\treturn $('#pswd').val() && $('#captcha').val()\r\n\t},\r\n\tsubmit: function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tlet action = this.$form.hasClass('f-delete') ? 'delete' : 'upload'\r\n\t\tif (libchan.current && libchan.current.section === 'drafts') {\r\n\t\t\tif (action === 'delete') {\r\n\t\t\t\tdrafts.remove(libchan.current.id)\r\n\t\t\t\tthis.toggle()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (! this.checkFields()) \r\n\t\t\treturn this.showErrors('fill-required-fields')\r\n\t\tthis.$form.addClass('busy')\r\n\t\tif (action == 'upload') {\r\n\t\t\tlibchan.proceedWithData(action, true)\r\n\t\t\t.then(res => {\r\n\t\t\t\tthis.candidate = res.obj\r\n\t\t\t\tthis.send(libchan.mode, res.fd)\r\n\t\t\t}, errors => {\r\n\t\t\t\tthis.showErrors(errors)\r\n\t\t\t\tthis.$form.removeClass('busy')\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet fd = new FormData()\r\n\t\t\t$('#chan-id')[0].validate(1).then(id => {\r\n\t\t\t\tfd.apnd('id', id)\r\n\t\t\t\tthis.candidate = {id: id}\r\n\t\t\t\tthis.send('delete', fd)\r\n\t\t\t}, \r\n\t\t\te => console.error(e))\r\n\t\t}\r\n\t},\r\n\tsend: function(action, fd) {\r\n\t\tif (libchan.current && libchan.current.section === 'drafts')\r\n\t\t\taction = 'new'\r\n\t\tfd.apnd('action', action)\r\n\t\tfd.apnd('captcha', $('#captcha').val())\r\n\t\tfd.apnd('password', $('#pswd').val())\r\n\t\tif (DO_DEBUG)\r\n\t\t\tfd.inspect()\r\n\r\n\t\tvar request = new XMLHttpRequest()\r\n\t\trequest.open(\"POST\", \"api.php\")\r\n\t\trequest.send(fd);\r\n\t\tlet _this = this\r\n\t\trequest.onload = function(e) {\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\tlet res = 0\r\n\t\t\t\ttry {\r\n\t\t\t\t\tres = JSON.parse(this.response)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\tconsole.warn(this.response)\r\n\t\t\t\t\t_this.unbusy()\r\n\t\t\t\t\t_this.showErrors('invalid-response')\r\n\t\t\t\t}\r\n\t\t\t\tif (res)\r\n\t\t\t\t\t_this.handleResponse(res)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t_this.unbusy()\r\n\t\t\t\t_this.showErrors('xhr-error')\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tshowErrors: mkErrorShower('submit'),\r\n\terrorDescriptors: {\r\n\t\t'fill-required-fields': '  ',\r\n\t\t'xhr-error': ' XHR.   .',\r\n\t\t'invalid-response': ' XHR (  ).   .',\r\n\t\t'id-changed': 'ID   .',\r\n\t\t'nothing-to-edit': ' ',\r\n\t\t'missing': '  ',\r\n\t\t'wrong-captcha': '  ',\r\n\t\t'wrong-password': ' ',\r\n\t\t'fix-errors': ' !',\r\n\t\t'db-error': '    ',\r\n\t\t'not-admin': ',   ',\r\n\t\t'wrong-value': ' ',\r\n\t\t'chan-does-not-exist': '   '\r\n\t},\r\n\tactorFieldMap: {\r\n\t\tball: ['ball', 'catbg', 'offset'],\r\n\t\tstyles: ['colors', 'advanced_less'],\r\n\t\ttree: ['boards'],\r\n\t\tradio: ['radio'],\r\n\t\tadmin: ['admin']\r\n\t},\r\n\tfieldActorMap: {},\r\n\tunbusy: function() {\r\n\t\tthis.$form.removeClass('busy')\r\n\t\trefreshCaptcha()\r\n\t},\r\n\thandleResponse: function(res) {\r\n\t\tthis.unbusy()\r\n\t\tif (res.error) {\r\n\t\t\tlet errors = res.error\r\n\t\t\tif (! (errors instanceof Array)) \r\n\t\t\t\terrors = [errors]\r\n\t\t\terrors = errors.map(err => {\r\n\t\t\t\tif (! err.field) {\r\n\t\t\t\t\terr = {\r\n\t\t\t\t\t\tfield: this,\r\n\t\t\t\t\t\tmsg: err\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet $input = $(jq`#chan-${err.field}`)\r\n\t\t\t\t\tif ($input.length && $input[0].showErrors) {\r\n\t\t\t\t\t\terr.field = $input[0]\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (this.fieldActorMap.hasOwnProperty(err.field)) {\r\n\t\t\t\t\t\t\terr.field = window[this.fieldActorMap[err.field]]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\terr.field = this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\treturn err\r\n\t\t\t})\r\n\t\t\tlet fields = _.uniq(_.pluck(errors, 'field'))\r\n\t\t\tif (! _.includes(fields, this)) {\r\n\t\t\t\terrors.push({\r\n\t\t\t\t\tfield: this,\r\n\t\t\t\t\tmsg: 'fix-errors'\r\n\t\t\t\t})\r\n\t\t\t\tfields.push(this)\r\n\t\t\t}\r\n\t\t\tfields.forEach(field => {\r\n\t\t\t\tlet messages = _.pluck(_.filter(errors, {field: field}), 'msg')\r\n\t\t\t\t.map(msg => this.errorDescriptors[msg] || msg)\r\n\t\t\t\tfield.showErrors(_.uniq(messages))\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.showErrors([])\r\n\t\t\tif (res.action === 'new-success') {\r\n\t\t\t\t// library.deleteChan(upForm.candidate.id)\r\n\t\t\t\tdrafts.remove(upForm.candidate.id)\r\n\t\t\t\tdelete this.candidate.ball\r\n\t\t\t\tlet sect = (this.candidate.section && this.candidate.section === 'default') ? 'default' : 'custom'\r\n\t\t\t\tlet added = library.addChan(this.candidate, sect, true)\r\n\t\t\t\tlibchan.load(added)\r\n\t\t\t\tconsole.log(upForm.candidate.id, this.candidate, sect);\r\n\t\t\t\t// libchan.setMode('edit', sect)\r\n\t\t\t}\r\n\t\t\tif (res.action === 'edit-success') {\r\n\t\t\t\tif (res.moveto) {\r\n\t\t\t\t\t// console.log(`Gotta move it to ${res.moveto}`);\r\n\t\t\t\t\tthis.candidate.section = res.moveto\r\n\t\t\t\t}\r\n\t\t\t\tlet edited = library.editChan(this.candidate)\r\n\t\t\t\tlibchan.load(edited)\r\n\t\t\t}\r\n\t\t\tif (res.action === 'delete-success') {\r\n\t\t\t\tlibrary.deleteChan(this.candidate.id)\r\n\t\t\t\tlibchan.setMode('new', 'draft')\r\n\t\t\t}\r\n\t\t\tthis.toggle()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst DO_DEBUG = false;\r\n\r\nfunction makeEscapeTagLiteralFn(fn = v => v) {\r\n  return function(strings, ...values) {\r\n    let result = \"\"\r\n    for (let i = 0; i < strings.length; i++) {\r\n      result += strings[i]\r\n      if (i < values.length) {\r\n        result += fn(''+values[i])\r\n      }\r\n    }\r\n    return result\r\n  }\r\n}\r\n// Escape tag literal functions for jQuery queries and regular expressions\r\nvar jq = makeEscapeTagLiteralFn(v => v.replace(/([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^`{|}~ ])/g, \"\\\\$1\"))\r\n, escHTML = makeEscapeTagLiteralFn(_.escape)\r\n\r\nfunction LSfetchJSON(key) {\r\n  let val = null, data = localStorage[key]\r\n  if (typeof data !== 'undefined') {\r\n    try {\r\n      val = JSON.parse(data)\r\n    }\r\n    catch(e) {\r\n      console.error(e)\r\n      localStorage.removeItem(key)\r\n    }\r\n  }\r\n  return val\r\n}\r\n\r\nfunction downloadJSON(obj, name) {\r\n\tvar dlAnchorElem = document.getElementById('dl-victim')\r\n\tdlAnchorElem.setAttribute(\"href\", \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(obj)))\r\n\tdlAnchorElem.setAttribute(\"download\", `${name}.json`)\r\n\tdlAnchorElem.click()\r\n}"]}