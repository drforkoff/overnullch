{"version":3,"sources":["../../babel/src/editor.js"],"names":["IS_ADMIN","main","saveAsNewDraft","libchan","setMode","drafts","submit","LSfetchJSON","$","addClass","toggleClass","setTimeout","injector","inject","ajaxSetup","dataType","each","prepend","append","$tipper","parents","find","showErrors","mkErrorShower","errorDescriptors","attr","patternRX","RegExp","validate","silent","isDraft","Promise","resolve","reject","$this","val","errors","trim","maxlength","minlength","length","push","match","vconv","data","validations","hasOwnProperty","prop","finalize","setTipperState","afterValid","then","err","on","$sect","_","noop","change","gradient","update","bind","click","$use","minus","indexOf","_from","_to","_ref","id","tree","addBoard","removeBoard","$cat","hasClass","removeCategory","removeClass","addCategory","isMouseDown","radio","removeStream","focus","validateUI","load","_libdata","ev","preventDefault","stopPropagation","clearTimeout","offTimeout","currentTarget","target","$ch","parent","downloadJSON","ball","handleFile","getData","toggleView","text","removeAttribute","setAttribute","inc","override","clearInterval","incrementor","$input","offset","setInterval","validateJSON","styles","html","preamble","base","bindID","$b","jq","trigger","window","updateBindings","$area","slideDown","preValue","refreshCaptcha","toggle","addStream","Sortable","create","document","querySelector","handle","animation","toggleLib","lastTab","tabID","$lib","f","replace","toLowerCase","remove","upForm","init","getJSON","Date","getTime","done","library","build","chans","clear","clone","current","Math","random","localStorage","make","direction","stop1","stop2","prefixify","input","res","exec","rest","without","gradientDirection","ret","gradientType","isNaN","parseFloat","gradientStops","prefix","getValue","grad","alias","css","existing","getElementById","innerHTML","head","getElementsByTagName","style","createElement","type","styleSheet","cssText","appendChild","createTextNode","removeChild","originalEvent","files","dataTransfer","reader","FileReader","onload","e","setBall","result","readAsDataURL","chan","src","section","_id","ballv","$ball","one","width","height","file","fType","map","pos","abs","sign","catbg","stop","jscolor","fromString","toDataURL","getDataUri","top","left","cats","htm","JSON","parse","isFlat","name","boards","forEach","buildCat","cat","querySelectorAll","makeBoardsSortable","stringify","deconstruct","boardHeight","addBoardButtonHeight","buildBoards","empty","maxHeight","escape","buildBoard","brd","escHTML","external","dir","url","desc","recalcHeight","$brds","jQuery","n","px","$btn","board","$parent","el","group","onAdd","from","to","shake","obj","keys","r","allDirs","walkCat","catNames","dupCats","findDuplicates","$cats","i","dupDirs","$dirs","k","join","flat","$boards","$desc","$dir","$name","JSON_valid","errs","Array","$msgbox","any","mul","reduce","er","HTMLElement","fn","state","arr","dubs","role","vars","v","bgColor","linkColor","callback","userCode","parseInput","lessCode","less","render","message","colors","c","advanced_less","lessFormatter","minify","succ","errors_found","brackets","isBalanced","str","bracket","openBrackets","isClean","len","pop","reset","field","buildStream","strm","path","mime","$strm","streams","hide","proceed","$streams","stream","$range","mixedRange","dupProps","pluck","$inputs","addChan","default","buildChan","console","error","ballSrc","search","wiki","dlbtn","$chan","fresh","appendTo","highlight","libdata","editChan","assign","replaceWith","deleteChan","sect","included","userboards","userboards_catname","userboards_system","postfix","show","prettify","rinse","_schema","integrity","required","optional","adminOnly","specialComps","pairs","objects","isNewBall","conversions","toFile","defaults","fns","eq","first","second","vals","cur","nu","toBlob","schema","props","intCls","cmpCls","eqFn","convCls","conv","defCls","mode","collectData","dataPromises","pr","treeToUI","validUI","admy","all","proceedWithData","isUpload","fd","FormData","propSchema","apnd","uniq","DO_DEBUG","log","value","w","model","lsDrafts","parsed","Error","removeItem","splice","findIndex","sync","add","edit","edited","version","newid","guro","draft","css_beautify","urlencode","encodeURI","checkuniq","get","encodeURIComponent","fail","NodeList","prototype","Blob","inspect","pair","entries","fr","String","split","bstr","atob","u8arr","Uint8Array","charCodeAt","image","Image","canvas","naturalWidth","naturalHeight","getContext","drawImage","m","output","re","index","lastIndex","concat","range","$form","actorFieldMap","fields","actor","fieldActorMap","draftDelete","checkFields","action","candidate","send","request","XMLHttpRequest","open","_this","status","response","warn","unbusy","handleResponse","admin","msg","includes","messages","filter","added","moveto","makeEscapeTagLiteralFn","strings","key","dlAnchorElem"],"mappings":"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","file":"editor.js","sourcesContent":["\"use strict\";\r\n\r\nvar IS_ADMIN = false;\r\n\r\nconst main = () => {\r\n\tif(LSfetchJSON('IS_ADMIN')) {\r\n\t\tIS_ADMIN = true\r\n\t\t$('body').addClass('is-admin')\r\n\t}\r\n\r\n\t$('#chan-library').toggleClass('expanded', localStorage['chanlib-expanded'] == 1)\r\n\tsetTimeout(() => injector.inject('lib-collapse', `.collapsible-content {  transition: width 0.3s; }`), 100)\r\n\r\n\t$.ajaxSetup({\r\n\t\tdataType: 'json'\r\n\t})\r\n\r\n\t$('.tipper').each(function() {\r\n\t\t$(this).prepend(`\r\n\t\t\t<svg class=\"icon t-i-q\"><use xlink:href=\"#i-question\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-e\"><use xlink:href=\"#i-warning\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-s spinning\"><use xlink:href=\"#i-spinner\"></use></svg>\r\n\t\t\t<svg class=\"icon t-i-ok\"><use xlink:href=\"#i-check\"></use></svg>`)\r\n\t})\r\n\t.append(`<div class=\"tooltip-wrap error-msg\"><div class=\"tooltip\"></div></div>`)\r\n\t\r\n\t$('.validable')\r\n\t.each(function() {\r\n\t\tlet $tipper = $(this).parents('.tip-container').find('.tipper')\r\n\t\tthis.showErrors = mkErrorShower($tipper)\r\n\t\tthis.errorDescriptors = {\r\n\t\t\t'too-long': '   ',\r\n\t\t\t'too-short': '   ',\r\n\t\t\t'invalid': '  ',\r\n\t\t\t'missing': '   ',\r\n\t\t\t'occupied': ' '\r\n\t\t}\r\n\t\tif ($(this).attr('pattern'))\r\n\t\t\tthis.patternRX = new RegExp($(this).attr('pattern'))\r\n\t\tthis.validate = (silent, isDraft) => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet $this = $(this)\r\n\t\t\t\t, val = $this.val()\r\n\t\t\t\t, errors = []\r\n\r\n\t\t\t\tval = val.trim()\r\n\t\t\t\t$this.val(val)\r\n\r\n\t\t\t\tif (val) {\r\n\t\t\t\t\tlet maxlength = $this.attr('maxlength')\r\n\t\t\t\t\t, minlength = $this.attr('minlength')\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (minlength && val.length < minlength)\r\n\t\t\t\t\t\terrors.push(`    (  ${minlength} .)`)\r\n\r\n\t\t\t\t\tif (this.patternRX && !val.match(this.patternRX)) \r\n\t\t\t\t\t\terrors.push('invalid')\r\n\r\n\t\t\t\t\tlet vconv = $this.data('valconvert')\r\n\t\t\t\t\tif (vconv && validations.hasOwnProperty(vconv)) {\r\n\t\t\t\t\t\tval = validations[vconv](val)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (maxlength && val.length > maxlength)\r\n\t\t\t\t\t\terrors.push(` .   (${maxlength} )`)\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif ($(this).prop('required')) {\r\n\t\t\t\t\t\terrors.push('missing')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet finalize = () => {\r\n\t\t\t\t\tif (! silent)\r\n\t\t\t\t\t\tthis.showErrors(errors)\r\n\t\t\t\t\tif (! errors.length) {\r\n\t\t\t\t\t\t$tipper.setTipperState('valid')\r\n\t\t\t\t\t\tresolve(val)\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (isDraft)\r\n\t\t\t\t\t\t\tresolve(val)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject(errors)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet afterValid = $this.data('aftervalid')\r\n\t\t\t\tif (! errors.length) {\r\n\t\t\t\t\t$tipper.setTipperState('spinner')\r\n\t\t\t\t\tif (afterValid && validations[afterValid]) {\r\n\t\t\t\t\t\tvalidations[afterValid](val, $this.data('uniq'))\r\n\t\t\t\t\t\t.then(() => finalize(), err => {\r\n\t\t\t\t\t\t\terrors.push(err)\r\n\t\t\t\t\t\t\tfinalize()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse finalize()\r\n\t\t\t\t}\r\n\t\t\t\telse finalize()\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n\t.on('focus', function() {\r\n\t\tlet $this = $(this)\r\n\t\t, $sect = $this.parents('.tip-container')\r\n\t\t, $tipper = $sect.find('.tipper')\r\n\t})\r\n\r\n\t$('.validable:not(.no-val-onblur)').on('blur', function() { \r\n\t\tthis.validate().then(_.noop, _.noop)\r\n\t})\r\n\t\r\n\t$('#color-selector .colorbox').change(gradient.update.bind(gradient))\r\n\r\n\t$('#change-direction').click(function() {\r\n\t\tlet $use = $(this).find('use')\r\n\t\t, minus = $use.attr('transform').indexOf('-90') < 0\r\n\t\t$use.attr('transform', `rotate(${minus ? '-' : ''}90 8 8)`)\r\n\t\tvar _from = $('#bgc-from')[0], _to = $('#bgc-to')[0];\r\n\t\tvar _ref = [_to.id, _from.id];\r\n\t\t_from.id = _ref[0];\r\n\t\t_to.id = _ref[1];\r\n\t\tgradient.update()\r\n\t})\r\n\r\n\t$('body')\r\n\t.on('click', '.add-board', function() {\r\n\t\ttree.addBoard($(this))\r\n\t})\r\n\t.on('click', '.delboard', function() {\r\n\t\ttree.removeBoard($(this))\r\n\t})\r\n\t.on('click', '.delcat', function() {\r\n\t\tlet $cat = $(this).parents('.tree-cat')\r\n\t\tif ($cat.hasClass('predelete') || $cat.hasClass('empty'))\r\n\t\t\ttree.removeCategory($(this))\r\n\t\telse\r\n\t\t\t$cat.addClass('predelete')\r\n\t})\r\n\t.on('click', '.cat-undelete', function() {\r\n\t\t$(this).parents('.tree-cat').removeClass('predelete')\r\n\t})\r\n\t.on('click', '.f-minus, .f-plus', function() {\r\n\t\t$(this).parents('.tree-cat').toggleClass('hidden')\r\n\t})\r\n\t.on('click', '.add-cat', tree.addCategory.bind(tree))\r\n\t.on('input', '.board-dir', function() {\r\n\t\t$(this).parents('.cat-brd').toggleClass('external', !! $(this).val().match(/^https?:\\/\\//))\r\n\t})\r\n\t.on('mouseup mouseleave blur touchend touchcancel', function(ev) {\r\n\t\tisMouseDown = false\r\n\t})\r\n\t.on('click', '.delstream', function() { radio.removeStream($(this)) })\r\n\t.on('click', '.templatize', function() {\r\n\t\t$(this).parents('.stream').toggleClass('templated').find('.stream-range').focus()\r\n\t})\r\n\t.on('blur', '#tree input', tree.validateUI.bind(tree))\r\n\t.on('click', '.lib-chan', function() {\r\n\t\tlibchan.load(this._libdata)\r\n\t})\r\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tev.stopPropagation()\r\n\t})\r\n\t.on('dragenter', function(ev) {\r\n\t\t$(this).addClass('dropping')\r\n\t\tclearTimeout(this.offTimeout)\r\n\t})\r\n\t.on('dragend drop dragleave', function(ev) {\r\n\t\tif (ev.currentTarget === ev.target) {\r\n\t\t\tthis.offTimeout = setTimeout(() => {\r\n\t\t\t\t$(this).removeClass('dropping')\r\n\t\t\t}, 100)\r\n\t\t}\r\n\t})\r\n\t.on('click', '.export-draft', function(ev) {\r\n\t\tev.stopPropagation()\r\n\t\tlet $ch = $(this).parent('.lib-chan')\r\n\t\t, data = $ch[0]._libdata\r\n\t\tdownloadJSON(data, data.id)\r\n\t})\r\n\r\n\t$('.chanball-wrap')\r\n\t.on('dragenter dragend dragover drop dragleave', function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tev.stopPropagation()\r\n\t})\r\n\t.on('dragenter dragover', function(ev) {\r\n\t\t$(this).addClass('file-over')\r\n\t\tclearTimeout(this.offTimeout)\r\n\t})\r\n\t.on('dragend drop dragleave', function(ev) {\r\n\t\tthis.offTimeout = setTimeout(() => {\r\n\t\t\t$(this).removeClass('file-over')\r\n\t\t}, 100)\r\n\t})\r\n\t.on('drop', ball.handleFile.bind(ball))\r\n\r\n\t$('#radio-editor').on('blur', 'input', () => {\r\n\t\tradio.getData().then(_.noop, _.noop)\r\n\t})\r\n\r\n\tvar isMouseDown = false\r\n\r\n\t$('.chanball-dropzone').click(() => $('#chanballFileInput').click())\r\n\t$('#chanballFileInput').on('change', ball.handleFile.bind(ball))\r\n\r\n\t$('#view-toggle .switch-body').click(() => tree.toggleView())\r\n\t$('#view-toggle label').click(function(ev) {\r\n\t\ttree.toggleView($(this).text())\r\n\t})\r\n\r\n\t$('#reup-chanball').click(() => {\r\n\t\t$('#chanballFileInput').click()\r\n\t})\r\n\r\n\t$('.password-reveal').on('mousedown', function() {\r\n\t\t$(this).parent().find('input').attr('type', 'text')\r\n\t})\r\n\t.on('mouseleave mouseup', function() {\r\n\t\t$(this).parent().find('input').attr('type', 'password')\r\n\t});\r\n\r\n\t$('#pswd').on('focus', function() {\r\n\t\tthis.removeAttribute('readonly')\r\n\t})\r\n\t.on('blur', function() {\r\n\t\tthis.setAttribute('readonly', true)\r\n\t})\r\n\r\n\t$('.cb-position-tweaker button')\r\n\t.on('mousedown touchstart', function() {\r\n\t\tisMouseDown = true\r\n\t\tlet inc = override => {\r\n\t\t\tif (!override && !isMouseDown)\r\n\t\t\t\treturn clearInterval(this.incrementor)\r\n\t\t\tlet $input = $(this).parent().find('input')\r\n\t\t\t, inc = +$(this).data('inc')\r\n\t\t\t$input.val(+$input.val() + inc)\r\n\t\t\tball.offset()\r\n\t\t}\r\n\t\tinc(true)\r\n\t\tthis.incrementor = setInterval(inc, 150)\r\n\t})\r\n\t.parent().find('input').on('input paste change', ball.offset)\r\n\r\n\t$('#tree-json').on('blur', function() {\r\n\t\ttree.validateJSON()\r\n\t})\r\n\r\n\t$('#chan-name').on('input paste change', function() {\r\n\t\t$('.channame-overlay').text($(this).val())\r\n\t})\r\n\r\n\t$('#color-theme input.color').change(styles.update.bind(styles))\r\n\t$('#less-enter').on('input', styles.update.bind(styles))\r\n\r\n\t$('#less-preamble').html(styles.preamble('html'))\r\n\t$('#less-enter').val(styles.base)\r\n\r\n\t$('.binded').each(function() {\r\n\t\tlet $this =  $(this)\r\n\t\t, bindID = $this.data('bind')\r\n\t\t, $b = $(jq`#${bindID}`)\r\n\t\tif (! $b.length) return;\r\n\t\t$b.on('input change paste', function() {\r\n\t\t\t$this.text($(this).val() || `{${bindID}}`)\r\n\t\t}).trigger('change')\r\n\t})\r\n\twindow.updateBindings = () => {\r\n\t\t$('.binded').each(function() {\r\n\t\t\t$(jq`#${$(this).data('bind')}`).trigger('change')\r\n\t\t})\r\n\t}\r\n\r\n\t$('#advance-less').change(function() {\r\n\t\tlet $area = $('#less-enter');\r\n\t\tif ($(this).prop('checked')) {\r\n\t\t\t$('.advanced-less').slideDown(() => {\r\n\t\t\t\t$area.prop('disabled', 0)\r\n\t\t\t\tif ($area[0].preValue)\r\n\t\t\t\t\t$area.val($area[0].preValue)\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$area[0].preValue = $area.val()\r\n\t\t\t$area.val(styles.base).prop('disabled', 1)\r\n\t\t}\r\n\t\tstyles.update()\r\n\t})\r\n\r\n\t$('.captcha').click(refreshCaptcha).addClass('not-loaded')\r\n\r\n\t$('.widget-list input').on('change', function() {\r\n\t\t$(jq`#${$(this).attr('name')}`).toggle($(this).prop('checked'))\r\n\t})\r\n\r\n\t$('.expander').click(function() {\r\n\t\t$(this).parents('.expandee').toggleClass('expanded')\r\n\t})\r\n\r\n\t$('#onchan').on('change', function() {\r\n\t\t$('.chan').toggleClass('onchan', $(this).prop('checked'))\r\n\t})\r\n\r\n\tstyles.update()\r\n\r\n\t$('#add-stream').click(radio.addStream.bind(radio))\r\n\r\n\tSortable.create(document.querySelector('#categories'), {\r\n\t\thandle: '.cat-dragger',\r\n\t\tanimation: 150\r\n\t})\r\n\r\n\tSortable.create(document.querySelector('#streams'), {\r\n\t\thandle: '.dragger',\r\n\t\tanimation: 150\r\n\t})\r\n\r\n\t$('.sidebar').click(toggleLib)\r\n\r\n\tlet lastTab = 'default'\r\n\t$('.tab').click(function() {\r\n\t\tlet tabID = $(this).data('tab')\r\n\t\t, $lib = $('#chan-library')\r\n\t\t, f = false\r\n\t\tif (tabID === 'search') {\r\n\t\t\tif ($lib.hasClass('show-search'))\r\n\t\t\t\ttabID = lastTab\r\n\t\t\telse\r\n\t\t\t\tf = true\r\n\t\t}\r\n\t\telse lastTab = tabID\r\n\t\t$lib.find('.tab').removeClass('selected')\r\n\t\t$lib.find(`.tab[data-tab=${tabID}]`).addClass('selected')\r\n\t\t$lib.removeClass('show-custom show-default show-drafts show-search').addClass(`show-${tabID}`)\r\n\t\tf && $('#searchbox').focus()\r\n\t})\r\n\r\n\t$('#searchbox').on('input paste', function() {\r\n\t\tlet val = $(this).val().trim().replace(/\\\"/g, '\\\\\"').toLowerCase()\r\n\t\tif (val.length)\r\n\t\t\tinjector.inject('lib-search', `.show-search .lib-chan[data-search *= \"${val}\"] {height: 40px}`)\r\n\t\telse\r\n\t\t\tinjector.remove('lib-search')\r\n\t})\r\n\r\n\tupForm.init()\r\n\r\n\t$.getJSON(`/chans/chans.json?v=${new Date().getTime()}`)\r\n\t.done(data => library.build(data.chans)) \r\n\r\n\t$('#new-chan').click(() => libchan.clear())\r\n\t$('#clone-this').click(() => libchan.clone())\r\n\t$('#publish').click(() => upForm.toggle('upload'))\r\n\t$('#delete-this').click(() => upForm.toggle('delete'))\r\n\t$('#save-draft').click(() => drafts.submit())\r\n\r\n\tfunction saveAsNewDraft() {\r\n\t\tlibchan.setMode('new', 'drafts')\r\n\t\tdrafts.submit(1)\r\n\t\treturn false\r\n\t}\r\n\t$('#draft-saveasnew').click(saveAsNewDraft)\r\n\t$('#draft-changeid').click(() => {\r\n\t\tdrafts.remove(libchan.current.id)\r\n\t\tsaveAsNewDraft()\r\n\t})\r\n\t$('#draft-savemodifiedid').click(() => {\r\n\t\t$('#chan-id').val($('#proposed-id').text())\r\n\t\tdrafts.submit()\r\n\t\treturn false\r\n\t})\r\n\t$('#draft-overwrite').click(() => {\r\n\t\tdrafts.remove($('#id-to-overwrite').text())\r\n\t\tdrafts.submit()\r\n\t\treturn false\r\n\t})\r\n\r\n\tdrafts.load()\r\n}\r\n\r\nfunction refreshCaptcha() {\r\n\t$('.captcha').attr('src', `/captcha.php?color=255,255,255&v=${Math.random()}`).removeClass('not-loaded')\r\n\t$('#captcha').val('')\r\n}\r\n\r\nfunction toggleLib(on) {\r\n\t$('#chan-library').toggleClass('expanded', on)\r\n\tlocalStorage['chanlib-expanded'] = +$('#chan-library').hasClass('expanded')\r\n}\r\n\r\nvar gradient = {\r\n\tmake: (direction, stop1, stop2) =>\r\n\t\t(direction !== 'radial') \r\n\t\t\t? `linear-gradient(to ${direction}, ${stop1} 0%, ${stop2} 100%)`\r\n\t\t\t: `radial-gradient(ellipse at center, ${stop1} 0%, ${stop2} 100%)`,\r\n\tprefixify: function(input) {\r\n\t\tvar res = /(((?:radial|linear)-gradient)\\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\\));?/i.exec(input);\r\n\t\tif (res === null) return 'background:' + input;\r\n\t\tres = _.rest(_.without(res, undefined));\r\n\t\tvar ret = res[0]+'; ';\r\n\t\tvar gradientType = res[1];\r\n\t\tvar gradientDirection;\r\n\t\tif (!isNaN(res[2])) gradientDirection = (90 - parseFloat(res[2])) + 'deg, ';\r\n\t\telse if (res[2] == 'bottom') gradientDirection = 'top, ';\r\n\t\telse if (res[2] == 'right') gradientDirection = 'left, ';\r\n\t\telse gradientDirection = 'center, ellipse cover, ';\r\n\t\tvar gradientStops = res[3];\r\n\t\t_.each(['-o-', '-webkit-', '-moz-'], function(prefix) {\r\n\t\t\tret += 'background:' + prefix + gradientType + '(' + gradientDirection + gradientStops + '); ';\r\n\t\t});\r\n\t\treturn 'background:' + ret;\r\n\t},\r\n\tgetValue: function() {\r\n\t\tlet stop1 = '#' + $('#bgc-from').val()\r\n\t\t, stop2 = '#' + $('#bgc-to').val()\r\n\t\treturn this.make('bottom', stop1, stop2)\r\n\t},\r\n\tupdate: function() {\r\n\t\tlet grad = this.getValue()\r\n\t\tinjector.inject('chanball-background', `.chanball-wrap { ${this.prefixify(grad)} }`)\r\n\t}\r\n}\r\n\r\nvar injector = {\r\n\tinject: function(alias, css) {\r\n\t\tvar id = `injector:${alias}`\r\n\t\tvar existing = document.getElementById(id)\r\n\t\tif (existing) {\r\n\t\t\texisting.innerHTML = css\r\n\t\t\treturn\r\n\t\t}\r\n\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t, style = document.createElement('style');\r\n\t\tstyle.type = 'text/css'\r\n\t\tstyle.id = id\r\n\t\tif (style.styleSheet) {\r\n\t\t\tstyle.styleSheet.cssText = css\r\n\t\t} else {\r\n\t\t\tstyle.appendChild(document.createTextNode(css))\r\n\t\t}\r\n\t\thead.appendChild(style)\r\n\t},\r\n\tremove: function(alias) {\r\n\t\tvar id = `injector:${alias}`\r\n\t\tvar style = document.getElementById(id)\r\n\t\tif (style) {\r\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0]\r\n\t\t\tif (head)\r\n\t\t\t\thead.removeChild(document.getElementById(id))\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar ball = {\r\n\thandleFile: function(ev) {\r\n\t\tev.stopPropagation()\r\n\t\tev.preventDefault()\r\n\t\tev = ev.originalEvent\r\n\r\n\t\t$('body').removeClass('dropping')\r\n\r\n\t\tlet files = (ev.type == \"drop\") ? ev.dataTransfer.files : ev.target.files\r\n\t\t, f = files[0]\r\n\r\n\t\tif (f && f.type == 'image/png') {\r\n\t\t\tvar reader = new FileReader()\r\n\t\t\t\r\n\t\t\treader.onload = (function(theFile) {\r\n\t\t\t\treturn (function(e) {\r\n\t\t\t\t\tthis.setBall(e.target.result)\r\n\t\t\t\t}).bind(this)\r\n\t\t\t}).bind(this)(f)\r\n\r\n\t\t\treader.readAsDataURL(f)\r\n\t\t}\r\n\t\telse if(f)\r\n\t\t\tthis.showErrors('image-not-png')\r\n\t},\r\n\tsetBall: function(chan) {\r\n\t\tlet src\r\n\t\tif (typeof chan === 'string') {\r\n\t\t\tsrc = chan\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (! chan.ball) {\r\n\t\t\t\tif(chan.section !== 'drafts') {\r\n\t\t\t\t\tsrc = `/chans/balls/${chan.section}/${chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.clear()\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsrc = chan.ball\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet $ball = $('#chanball').attr('src', src)\r\n\t\t$ball.one('load', () => {\r\n\t\t\tif ($ball.width() > 200 || $ball.height > 200) \r\n\t\t\t\tthis.showErrors('image-too-large')\r\n\t\t\telse {\r\n\t\t\t\tthis.file = src\r\n\t\t\t\tthis.fType = src.indexOf('data:') === 0 ? 'dataURL' : 'file'\r\n\t\t\t\tthis.showErrors([])\r\n\t\t\t\t$('#chanball-sect').addClass('chanball-present')\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tgradient.update()\r\n\t},\r\n\tclear: function() {\r\n\t\t$('#chanball-sect').removeClass('chanball-present')\r\n\t\tthis.file = null\r\n\t},\r\n\tgetData: function(isDraft) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet errors = []\r\n\t\t\tif (!this.file)\r\n\t\t\t\terrors.push('no-file')\r\n\t\t\t\r\n\t\t\tlet offset = ['left', 'top'].map(pos => {\r\n\t\t\t\tlet $input = $(jq`#position-tweak-${pos}`)\r\n\t\t\t\t, val = +$input.val()\r\n\t\t\t\tif (isNaN(val))\r\n\t\t\t\t\tval = 0\r\n\t\t\t\tif (Math.abs(val) > 100)\r\n\t\t\t\t\tval = 100 * Math.sign(val)\r\n\t\t\t\t$input.val(val)\r\n\t\t\t\treturn val\r\n\t\t\t})\r\n\r\n\t\t\t, catbg = ['from', 'to'].map(stop => {\r\n\t\t\t\tlet $input = $(jq`#bgc-${stop}`)\r\n\t\t\t\t, val = $input.val()\r\n\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\r\n\t\t\t\t\tval = 'ffffff'\r\n\t\t\t\t\t$input[0].jscolor.fromString(val)\r\n\t\t\t\t}\r\n\t\t\t\treturn val\r\n\t\t\t})\r\n\r\n\t\t\tthis.offset()\r\n\t\t\tgradient.update()\r\n\r\n\t\t\tthis.showErrors(errors)\r\n\r\n\t\t\tif (errors.length && !isDraft) \r\n\t\t\t\treject(errors)\r\n\t\t\telse resolve({\r\n\t\t\t\tball: this.fType === 'file' ? 'default' : this.file,\r\n\t\t\t\toffset: offset,\r\n\t\t\t\tcatbg: catbg\r\n\t\t\t})\r\n\t\t})\r\n\t\t\r\n\t},\r\n\ttoDataURL: function() {\r\n\t\tif (this.fType == 'data' || !this.file)\r\n\t\t\treturn\r\n\t\tgetDataUri(this.file, data => {\r\n\t\t\tthis.file = data,\r\n\t\t\tthis.fType = 'data'\r\n\t\t})\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'no-file': ' ',\r\n\t\t'image-not-png': '   (  PNG)',\r\n\t\t'image-too-large': '     200 ',\r\n\t\t'upload-error': '   '\r\n\t},\r\n\tfile: null, fType: null,\r\n\toffset: function() {\r\n\t\tlet top = +$('#position-tweak-top').val(),\r\n\t\tleft = +$('#position-tweak-left').val()\r\n\t\t$('#chanball').css({\r\n\t\t\t'transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-webkit-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-ms-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-moz-transform': `translate(${left}px, ${top}px)`,\r\n\t\t\t'-o-transform': `translate(${left}px, ${top}px)`\r\n\t\t})\r\n\t\treturn [top, left]\r\n\t},\r\n\tshowErrors: mkErrorShower('ball')\r\n}\r\n\r\nvar tree = {\r\n\tbuild: function(cats) {\r\n\t\tvar htm= ''\r\n\t\tif (cats) {\r\n\t\t\tif(typeof cats === 'string') {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcats = JSON.parse(cats)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tthis.toggleView('JSON', true)\r\n\t\t\t\t\t$('#tree-json').val(cats)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (cats.length && this.isFlat(cats)) \r\n\t\t\t\tcats = [{name: '', boards: cats}]\r\n\t\t\tcats.forEach(cat => {\r\n\t\t\t\thtm += this.buildCat(cat)\r\n\t\t\t})\r\n\t\t}\r\n\t\t$('#categories').html(htm)\r\n\t\t\r\n\t\tdocument.querySelectorAll('.tree-cat ul').forEach(this.makeBoardsSortable.bind(this));\r\n\r\n\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\r\n\r\n\t\treturn this.validateUI()\r\n\t},\r\n\tisFlat: cats => cats[0].hasOwnProperty('dir'),\r\n\tboardHeight: 24,\r\n\taddBoardButtonHeight: 27,\r\n\tbuildCat: function(cat) {\r\n\t\tcat.boards = cat.boards || []\r\n\t\tvar boards = this.buildBoards(cat.boards)\r\n\t\t, empty = (cat.boards.length === 0)\r\n\t\t, maxHeight = (cat.boards.length+1) * this.boardHeight + this.addBoardButtonHeight\r\n\t\treturn `<div class=\"tree-cat ${empty ? 'empty': ''}\">\r\n\t\t<div class=\"tree-cathead\">\r\n\t\t\t<svg class=\"icon f-plus\" title=\"\"><use xlink:href=\"#i-folder-plus-fill\"></use></svg>\r\n\t\t\t<svg class=\"icon f-minus\" title=\"\"><use xlink:href=\"#i-folder-minus-fill\"></use></svg>\r\n\t\t\t<svg class=\"icon f-empty\"><use xlink:href=\"#i-folder-empty\"></use></svg>\r\n\t\t\t<input type=\"text\" class=\"cat-title\" value=\"${_.escape(cat.name) || ''}\"></input>\r\n\t\t\t<button class=\"b-option cat-undelete\" title=\" \">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-undo\"></use></svg>\r\n\t\t\t</button>\r\n\t\t\t<div class=\"cat-dragger\" title=\" \">\r\n\t\t\t\t<svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg>\r\n\t\t\t</div>\r\n\t\t\t<button class=\"b-option delb delcat\" title=\" \">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg>\r\n\t\t\t</button>\r\n\t\t</div>\r\n\t\t<div class=\"tree-catboards\" style=\"max-height: ${maxHeight}px\">${boards}</div></div>`\r\n\t},\r\n\tbuildBoards: function(boards) {\r\n\t\tvar htm ='<ul>'\r\n\t\tboards.forEach(brd => {\r\n\t\t\thtm += this.buildBoard(brd)\r\n\t\t})\r\n\t\thtm += `</ul><button class=\"tree-add add-board\" title=\" \">\r\n\t\t\t<div class=\"inner-border\">\r\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-slash-plus-slash\"></use></svg>\r\n\t\t\t</div>\r\n\t\t</button>`\r\n\t\treturn htm\r\n\t},\r\n\tbuildBoard: brd => escHTML\r\n\t`<li class=\"cat-brd ${brd.external ? 'external' : ''}\">\r\n\t\t<input type=\"text\" class=\"board-dir\" value=\"${brd.dir || brd.url || ''}\">\r\n\t\t<input type=\"text\" class=\"board-desc\" value=\"${brd.desc || ''}\">\r\n\t\t<div class=\"dragger\" title=\" \"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\r\n\t\t<button class=\"b-option delb delboard\" title=\" \"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button>\r\n\t</li>`,\r\n\trecalcHeight: function($brds) {\r\n\t\tif (!($brds instanceof jQuery)) \r\n\t\t\t$brds = $($brds).parent()\r\n\t\tlet n = $brds.find('.cat-brd').length\r\n\t\t, px = (n+1) * this.boardHeight + this.addBoardButtonHeight\r\n\t\t$brds.css({'max-height': `${px}px`})\r\n\t\t$brds.parent().toggleClass('empty', n == 0)\r\n\t},\r\n\taddBoard: function($btn, board) {\r\n\t\tboard = board || {}\r\n\t\t$btn.parent().find('ul').append(this.buildBoard)\r\n\t\tthis.recalcHeight($btn.parent())\r\n\t\t$btn.parent().find('.cat-brd:last input:first').focus()\r\n\t},\r\n\tremoveBoard: function($btn) {\r\n\t\tlet $parent = $btn.parents('.tree-catboards')\r\n\t\t$btn.parents('.cat-brd').remove()\r\n\t\tthis.recalcHeight($parent)\r\n\t\tthis.validateUI()\r\n\t},\r\n\taddCategory: function(cat) {\r\n\t\tif (!cat.hasOwnProperty('boards'))\r\n\t\t\tcat = {name: '', boards: []}\r\n\t\tlet $cat = $(this.buildCat(cat))\r\n\t\tthis.makeBoardsSortable($cat.find('ul')[0])\r\n\t\t$('#categories').append($cat)\r\n\t\t$cat.find('.cat-title').focus()\r\n\t},\r\n\tremoveCategory: function($btn) {\r\n\t\t$btn.parents('.tree-cat').remove()\r\n\t\tthis.validateUI()\r\n\t},\r\n\tmakeBoardsSortable: function(el) {\r\n\t\tSortable.create(el, {\r\n\t\t\thandle: '.dragger',\r\n\t\t\tanimation: 150, \r\n\t\t\tgroup: 'boards',\r\n\t\t\tonAdd: ev => {\r\n\t\t\t\t[ev.from, ev.to].forEach(this.recalcHeight.bind(this))\r\n\t\t\t\tthis.validateUI()\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tvalidateJSON: function() {\r\n\t\ttry {\r\n\t\t\tlet cats = JSON.parse($('#tree-json').val())\r\n\t\t\tthis.build(cats)\r\n\t\t\treturn 1\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tthis.showErrors(e)\r\n\t\t\t$('#view-toggle').shake()\r\n\t\t\treturn 0\r\n\t\t}\r\n\t},\r\n\tvalidateUI: function(isDraft) {\r\n\t\tlet errors = []\r\n\t\t, obj = this.deconstruct()\r\n\r\n\t\tif ($('#tree .invalid').length)\r\n\t\t\t_.keys(this.errorDescriptors).forEach(r => {\r\n\t\t\t\tif ($(jq`#tree .invalid.inv_${r}`).length) \r\n\t\t\t\t\terrors.push(r)\r\n\t\t\t})\r\n\r\n\t\tlet allDirs = []\r\n\t\t, walkCat = brd => allDirs.push(brd.external ? brd.url : brd.dir)\r\n\r\n\t\tlet catNames = []\r\n\t\tobj.forEach(cat => {\r\n\t\t\tcatNames.push(cat.name)\r\n\t\t\tcat.boards.forEach(walkCat)\r\n\t\t})\r\n\t\tlet dupCats = findDuplicates(catNames)\r\n\t\tif (dupCats.length) {\r\n\t\t\terrors.push('mul-cat')\r\n\t\t\tlet $cats = $('.cat-title')\r\n\t\t\tdupCats.forEach(i => $($cats[i]).addClass('invalid'))\r\n\t\t}\r\n\r\n\t\tlet dupDirs = findDuplicates(allDirs)\r\n\t\tif (dupDirs.length) {\r\n\t\t\terrors.push('mul-dir')\r\n\t\t\tlet $dirs = $('.board-dir')\r\n\t\t\tdupDirs.forEach(i => $($dirs[i]).addClass('invalid'))\r\n\t\t}\r\n\r\n\t\tthis.showErrors(errors)\r\n\t\treturn (errors.length && !isDraft) ? false : obj\r\n\t},\r\n\tdeconstruct: function() {\r\n\t\t$('#tree .invalid').removeClass('invalid ' + \r\n\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\r\n\t\tlet cats = []\r\n\t\t, $cats = $('.tree-cat')\r\n\t\t, flat = false\r\n\t\tif ($cats.length == 1)\r\n\t\t\tflat = true\r\n\t\t$('.tree-cat').each(function() {\r\n\t\t\tvar $cat = $(this)\r\n\t\t\t, boards = []\r\n\t\t\t, $boards = $cat.find('.cat-brd')\r\n\t\t\tif (! $boards.length)\r\n\t\t\t\t$cat.addClass('invalid inv_empty-dir')\r\n\t\t\telse $boards.each(function() {\r\n\t\t\t\tlet $desc = $(this).find('.board-desc')\r\n\t\t\t\t, desc = $desc.val().trim()\r\n\t\t\t\tif (!desc) \r\n\t\t\t\t\t$desc.addClass('invalid inv_no-desc')\r\n\t\t\t\tlet board = {desc: desc}\r\n\r\n\t\t\t\tlet $dir = $(this).find('.board-dir')\r\n\t\t\t\t, dir = $dir.val().trim()\r\n\t\t\t\tif (!dir)\r\n\t\t\t\t\t$dir.addClass('invalid inv_no-dir')\r\n\r\n\t\t\t\tlet external = !! dir.match(/^https?:\\/\\//)\r\n\t\t\t\t$(this).toggleClass('external', external)\r\n\t\t\t\tboard[external ? 'url' : 'dir'] = dir\r\n\t\t\t\tif (external) \r\n\t\t\t\t\tboard.external = true\r\n\r\n\t\t\t\tboards.push(board)\r\n\t\t\t})\r\n\r\n\t\t\tlet $name = $cat.find('.cat-title')\r\n\t\t\t, name = $name.val().trim()\r\n\t\t\tif (!flat && ! name) {\r\n\t\t\t\t$name.addClass('invalid inv_no-name')\r\n\t\t\t}\r\n\t\t\tcats.push({\r\n\t\t\t\tname: name,\r\n\t\t\t\tboards: boards\r\n\t\t\t})\r\n\t\t})\r\n\t\treturn cats\r\n\t},\r\n\ttoggleView: function(to, isDraft) {\r\n\t\tlet current = $('#chan-structure').hasClass('sw_UI') ? 'UI' : 'JSON'\r\n\r\n\t\tif (typeof to === 'undefined') \r\n\t\t\tto = current=='UI' ? 'JSON' : 'UI'\r\n\r\n\t\tif (current == to)\r\n\t\t\treturn null\r\n\r\n\t\tif (to === 'JSON') {\r\n\t\t\t$('#tree-json').val(JSON.stringify(this.deconstruct(), null, '\\t'))\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\tlet JSON_valid = this.validateJSON()\r\n\t\t\tif (isDraft)\r\n\t\t\t\treturn $('#tree-json').val()/*.replace(/\\t|\\n/g, '')*/\r\n\t\t\telse if (! JSON_valid) \r\n\t\t\t\treturn false\r\n\t\t}\r\n\r\n\t\t$('#chan-structure')\r\n\t\t.removeClass('sw_UI sw_JSON')\r\n\t\t.addClass(`sw_${to}`)\r\n\r\n\t\treturn 1\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'no-name': '  ',\r\n\t\t'no-dir': '  ',\r\n\t\t'no-desc': '  ',\r\n\t\t'mul-dir': '  ',\r\n\t\t'mul-cat': '  ',\r\n\t\t'empty-dir': ' ',\r\n\t\t'bad-json': 'JSON  '\r\n\t},\r\n\tshowErrors: mkErrorShower('struct')\r\n}\r\n\r\nfunction mkErrorShower(id) {\r\n\treturn function(errs) {\r\n\t\tif (! (errs instanceof Array))\r\n\t\t\terrs = [errs]\r\n\t\tlet $tipper = id instanceof jQuery ? id : $(jq`#${id}-tipper`)\r\n\t\t, $msgbox = $tipper.find('.error-msg .tooltip')\r\n\t\t, any = errs.length > 0\r\n\t\t, mul = errs.length > 1\r\n\t\tlet htm = (mul ? ` : <ul>` : '')\r\n\t\t+ errs.reduce((htm, er) => htm + escHTML`${mul ? '<li>' : ''}${this.errorDescriptors && this.errorDescriptors[er] || er}${mul ? '</li>' : ''}`, '')\r\n\t\t+ (mul ? '</ul>' : '')\r\n\t\t$msgbox.html(htm)\r\n\t\t$tipper.setTipperState(any ? 'error-tip' : 'question')\r\n\t\tif (any) \r\n\t\t\t$tipper.shake()\r\n\t\tif(this instanceof HTMLElement) {\r\n\t\t\t$(this).toggleClass('invalid', any)\r\n\t\t}\r\n\t}\r\n}\r\n\r\n$.fn.shake = function() {\r\n\tthis.addClass('shake')\r\n\tsetTimeout(() => this.removeClass('shake'), 900)\r\n}\r\n$.fn.setTipperState = function(state) {\r\n\tthis.removeClass(_.without(['question', 'error-tip', 'spinner', 'valid'], state).join(' '))\r\n\t.addClass(state)\r\n}\r\n\r\n/*function hasDuplicates(a) {\r\n\treturn _.uniq(a).length !== a.length; \r\n}*/\r\n\r\nfunction findDuplicates(arr) {\r\n\tlet dubs = []\r\n\tarr.forEach((el, i) => {\r\n\t\tif (arr.length - _.without(arr, el).length > 1)\r\n\t\t\tdubs.push(i)\r\n\t})\r\n\treturn dubs\r\n}\r\n\r\nvar styles = {\r\n\tpreamble: function(role) {\r\n\t\tlet vars = []\r\n\t\t;['chan-id', 'bgColor', 'linkColor'].forEach(v =>\r\n\t\t\tvars[v] = (role == 'html')\r\n\t\t\t\t? `<span class=\"binded\" data-bind=\"${v}\"></span>`\r\n\t\t\t\t: $(jq`#${v}`).val()\r\n\t\t)\r\n\t\tif (role == 'less')\r\n\t\t\tvars['chan-id'] = 'css-preview'\r\n\t\treturn `.chan-${vars['chan-id']} {`+\r\n\t\t\t`\\n  @bgcolor: #${vars.bgColor};`+\r\n\t\t\t`\\n  @linkcolor: #${vars.linkColor};`;\r\n\t},\r\n\tupdate: function(callback) {\r\n\t\tcallback = (typeof callback === 'function') ? callback : null\r\n\t\tlet userCode = this.parseInput()\r\n\t\tif (!userCode) {\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(false)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet lessCode = this.preamble('less') + userCode + '}';\r\n\t\tless.render(lessCode).then(r => {\r\n\t\t\tinjector.inject('chanclass-preview', r.css)\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(true)\r\n\t\t},\r\n\t\terr => {\r\n\t\t\tthis.showErrors(err.message)\r\n\t\t\tif (callback)\r\n\t\t\t\tcallback(false)\r\n\t\t})\r\n\t},\r\n\tgetData: function(isDraft) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet res = {\r\n\t\t\t\tcolors: ['bg', 'link'].map(c => {\r\n\t\t\t\t\tlet $input = $(jq`#${c}Color`)\r\n\t\t\t\t\t, val = $input.val()\r\n\t\t\t\t\tif (! val.match(/[0-9a-f]{6}/i)) {\r\n\t\t\t\t\t\tval = $input.attr('value')\r\n\t\t\t\t\t\t$input[0].jscolor.fromString(val)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn val\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif ($('#advance-less').prop('checked')) {\r\n\t\t\t\tres.advanced_less = lessFormatter.minify($('#less-enter').val())\r\n\t\t\t\tthis.update(succ => {\r\n\t\t\t\t\tif (isDraft || succ) \r\n\t\t\t\t\t\tresolve(res) \r\n\t\t\t\t\telse \r\n\t\t\t\t\t\treject()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse resolve(res)\r\n\t\t})\r\n\t},\r\n\terrorDescriptors: {\r\n\t\t'bracket-imbalance': '  ',\r\n\t\t// 'parent-selector': '   (&)  (    )'\r\n\t},\r\n\tparseInput: function() {\r\n\t\tlet errors_found = []\r\n\t\t, val = $('#less-enter').val()\r\n\t\t// check for bracket balance | http://codereview.stackexchange.com/a/15339\r\n\t\tlet brackets = val.replace(/\\/\\*.+?\\*\\/|\".+?\"|'.+?'/, '').replace(/[^()\\[\\]{}]/g, '')\r\n\t\t, isBalanced = (function(str) {\r\n\t\t\tvar bracket = {\r\n\t\t\t\t\"]\": \"[\",\r\n\t\t\t\t\"}\": \"{\",\r\n\t\t\t\t\")\": \"(\"\r\n\t\t\t},\r\n\t\t\topenBrackets = [], \r\n\t\t\tisClean = true,\r\n\t\t\ti = 0,\r\n\t\t\tlen = str.length;\r\n\r\n\t\t\tfor(; isClean && i<len; i++ ){\r\n\t\t\t\tif ( bracket[ str[ i ] ] ){\r\n\t\t\t\t\tisClean = ( openBrackets.pop() === bracket[ str[ i ] ] );\r\n\t\t\t\t}else{\r\n\t\t\t\t\topenBrackets.push( str[i] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn isClean && !openBrackets.length;\r\n\t\t})(brackets)\r\n\t\t\r\n\t\tif (!isBalanced)\r\n\t\t\terrors_found.push('bracket-imbalance')\r\n\r\n\t\t// check for parent selectors\r\n\t\t/*if (val.match(/&(?![:\\.])/))\r\n\t\t\terrors_found.push('parent-selector')*/\r\n\r\n\t\tthis.showErrors(errors_found)\r\n\r\n\t\treturn errors_found.length ? false : val\r\n\t},\r\n\tshowErrors: mkErrorShower('style'),\r\n\treset: function() {\r\n\t\t;['bg', 'link'].forEach(field => {\r\n\t\t\tlet $input = $(jq`#${field}Color`)\r\n\t\t\t$input[0].jscolor.fromString($input.data('default'))\r\n\t\t})\r\n\t\t$('#advance-less').prop('checked', 0).trigger('change')\r\n\t\tthis.update()\r\n\t\t$('#custom-css').prop('checked', 0).trigger('change')\r\n\t}\r\n}\r\n\r\nstyles.base = `background: @bgcolor;\r\na, .chan-overlay .icon {\r\n\tcolor: @linkcolor;\r\n}\r\n&:hover {\r\n\tbackground: darken(@bgcolor, 8%);\r\n}\r\n&.onchan {\r\n\tbox-shadow: inset -2px 0 fadeout(@linkcolor, 25%);\r\n}\r\n& when (lightness(@bgcolor) < 70%) {\r\n\tcolor: #C3C3C3;\r\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\r\n\t\tcolor: white;\r\n\t}\r\n\t.board:hover {\r\n\t\tbackground: rgba(255, 255, 255, .08);\r\n\t}\r\n}\r\n& when (lightness(@bgcolor) > 70%) {\r\n\tcolor: #404040;\r\n\ta:hover, .ch-name:hover, .icon:hover, .rw-playpause:hover, .volumeter:hover {\r\n\t\tcolor: black;\r\n\t}\r\n\t.board:hover {\r\n\t\tbackground: rgba(0, 0, 0, .08);\r\n\t}\r\n}\r\n`;\r\n\r\n\r\nvar radio = {\r\n\tbuildStream: strm => escHTML\r\n\t`<li class=\"stream${strm.n ? ' templated' : ''}\">\r\n\t\t<input type=\"text\" class=\"stream-name\" placeholder=\" \" title=\" \" maxlength=\"20\" value=\"${strm.name || ''}\">\r\n\t\t<input type=\"text\" class=\"stream-range\" placeholder=\"\" title=\"\" maxlength=\"20\" value=\"${strm.n || ''}\">\r\n\t\t<div class=\"stream-options\">\r\n\t\t\t<button class=\"b-option templatize\" title=\"  \"><svg class=\"icon\">\r\n\t\t\t\t<use class=\"for-templated-hide\" xlink:href=\"#i-template\"></use>\r\n\t\t\t\t<use class=\"for-templated-show\" xlink:href=\"#i-untemplate\"></use>\r\n\t\t\t</svg></button>\r\n\t\t\t<div class=\"dragger\" title=\" \"><svg class=\"b-option icon\"><use xlink:href=\"#i-drag\"></use></svg></div>\r\n\t\t\t<button class=\"b-option delstream\" title=\" \"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></svg></button><br>\r\n\t\t</div>\r\n\t\t<br>\r\n\t\t<input type=\"text\" class=\"stream-path\" placeholder=\"/path \" title=\"/path \" maxlength=\"50\" value=\"${strm.path || ''}\">\r\n\t\t<input type=\"text\" class=\"stream-mime\" placeholder=\"MIME \" title=\"MIME \" maxlength=\"20\" value=\"${strm.mime || ''}\">\r\n\t</li>`,\r\n\taddStream: function(strm) {\r\n\t\tstrm = strm || {}\r\n\t\tlet $strm = $(this.buildStream(strm))\r\n\t\t$('#streams').append($strm)\r\n\t},\r\n\tbuild: function(r) {\r\n\t\t$('#chan-radiourl').val(r.url)\r\n\t\t$('#streams').html(r.streams.reduce((htm, strm) => htm + this.buildStream(strm), ''))\r\n\t},\r\n\tremoveStream: $btn => $btn.parents('.stream').remove(),\r\n\treset: function() {\r\n\t\tthis.build({url: '', streams: []})\r\n\t\t$('#radio-editor').hide()\r\n\t\t$('#radio').prop('checked', false)\r\n\t},\r\n\tgetData: function(isDraft) { //aka validate\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet proceed = (url, errors) => {\r\n\t\t\t\terrors = errors ? errors.map(v => `URL: ${v}`) : []\r\n\t\t\t\t$('#chan-radiourl').toggleClass('invalid', !!errors.length)\r\n\r\n\t\t\t\t$('#streams input').removeClass('invalid ' + \r\n\t\t\t\t\t_.map(_.keys(this.errorDescriptors), k => `inv_${k}`).join(' '))\r\n\t\t\t\tlet streams = []\r\n\t\t\t\t, $streams = $('.stream')\r\n\t\t\t\tif (! $streams.length)\r\n\t\t\t\t\terrors.push('no-streams')\r\n\t\t\t\telse {\r\n\t\t\t\t\t$streams.each(function() {\r\n\t\t\t\t\t\tlet $strm = $(this)\r\n\t\t\t\t\t\t, stream = {}\r\n\t\t\t\t\t\t;['name', 'path', 'mime'].forEach(prop => {\r\n\t\t\t\t\t\t\tlet $input = $strm.find(`.stream-${prop}`)\r\n\t\t\t\t\t\t\t, val = $input.val()\r\n\t\t\t\t\t\t\tif(!val)\r\n\t\t\t\t\t\t\t\t$input.addClass(`invalid inv_no-${prop}`)\r\n\t\t\t\t\t\t\tstream[prop] = val\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tstreams.push(stream)\r\n\r\n\t\t\t\t\t\tif ($strm.hasClass('templated')) {\r\n\t\t\t\t\t\t\tlet $range = $strm.find(`.stream-range`)\r\n\t\t\t\t\t\t\t, n = $range.val()\r\n\t\t\t\t\t\t\tif (! n)\r\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_no-range')\r\n\t\t\t\t\t\t\telse if(! mixedRange(n).length)\r\n\t\t\t\t\t\t\t\t$range.addClass('invalid inv_bad-range')\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tstream.n = n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tif ($('#streams .invalid').length)\r\n\t\t\t\t\t\t_.keys(this.errorDescriptors).forEach(r => {\r\n\t\t\t\t\t\t\tif ($(jq`#streams .invalid.inv_${r}`).length) \r\n\t\t\t\t\t\t\t\terrors.push(r)\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t;['name', 'path'].forEach(prop => {\r\n\t\t\t\t\t\tlet dupProps = findDuplicates(_.pluck(streams, prop))\r\n\t\t\t\t\t\tif (dupProps.length) {\r\n\t\t\t\t\t\t\terrors.push(`mul-${prop}`)\r\n\t\t\t\t\t\t\tlet $inputs = $(jq`.stream-${prop}`)\r\n\t\t\t\t\t\t\tdupProps.forEach(i => $($inputs[i]).addClass('invalid'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.showErrors(errors)\r\n\r\n\t\t\t\tif (!isDraft && errors.length)\r\n\t\t\t\t\treject(errors)\r\n\t\t\t\telse\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\turl: url,\r\n\t\t\t\t\t\tstreams: streams\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t$('#chan-radiourl')[0].validate(true).then(val => {\r\n\t\t\t\tproceed(val, null)\r\n\t\t\t},\r\n\t\t\terrors => {\r\n\t\t\t\tproceed(null, errors)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tshowErrors: mkErrorShower('radio'),\r\n\terrorDescriptors: {\r\n\t\t'no-streams': '    ',\r\n\t\t'no-name': '  ',\r\n\t\t'no-path': '   ',\r\n\t\t'no-mime': ' MIME',\r\n\t\t'mul-name': '  ',\r\n\t\t'mul-path': '   ',\r\n\t\t'no-range': '   ',\r\n\t\t'bad-range': '   '\r\n\t}\r\n}\r\n\r\nvar library = {\r\n\tbuild: function(chans, section) {\r\n\t\tchans.forEach(chan => this.addChan(chan, section || (chan.default ? 'default' : 'custom')))\r\n\t},\r\n\tbuildChan: function(chan, section) {\r\n\t\tsection = section || chan.section\r\n\t\tif (! section)\r\n\t\t\treturn console.error('No section specified for buildChan()')\r\n\t\tlet ballSrc = chan.ball || `/chans/balls/${section}/${section == 'drafts' ? 'no-ball' : chan.id}.png?uid=${chan._id}${chan.ballv ? `&v=${chan.ballv}` : ''}`\r\n\t\t, search = `${chan.id} ${chan.name} ${chan.url.replace(/^https?:\\/\\//, '')} ${(chan.wiki || '').replace(/^https?:\\/\\//, '')}`\r\n\t\t.toLowerCase().trim().replace(/[<>\"\"]/g, '')\r\n\t\t, dlbtn = section === 'drafts' ? `\r\n\t\t<button class=\"btn export-draft\">\r\n\t\t\t<svg class=\"icon\" title=\" \"><use xlink:href=\"#i-download\"></use></svg>\r\n\t\t</button>` : ''\r\n\t\t, htm = escHTML`<li class=\"lib-chan sect-${section}${!chan.name ? ' no-name' : ''}\" id=\"chan_${chan.id}\" data-search=\"${search}\">\r\n\t\t\t<img src=\"${ballSrc}\" class=\"lib-chanball\">\r\n\t\t\t<div class=\"chan-title\">${chan.name || ' '}</div>`+dlbtn+`\r\n\t\t</li>`\r\n\t\t, $chan = $(htm)\r\n\t\tchan.section = section\r\n\t\t$chan[0]._libdata = chan\r\n\t\treturn $chan\r\n\t},\r\n\taddChan: function(chan, section, fresh) {\r\n\t\tif (typeof fresh === 'undefined') fresh = false\r\n\t\tsection = section || chan.section\r\n\t\tif (! section)\r\n\t\t\treturn console.error('No section specified for addChan()')\r\n\t\tlet $chan = this.buildChan(chan, section)\r\n\t\t$chan.appendTo('#chans')\r\n\t\tfresh && this.highlight($chan)\r\n\t\tlet libdata = $chan[0]._libdata\r\n\t\treturn libdata\r\n\t},\r\n\teditChan: function(chan) {\r\n\t\tlet $chan = $(jq`#chan_${chan.id}`)\r\n\t\t, libdata = $chan[0]._libdata\r\n\t\t_.assign(libdata, chan)\r\n\t\t$chan.replaceWith(this.buildChan(libdata, libdata.section))\r\n\t\tthis.highlight($(jq`#chan_${chan.id}`))\r\n\t\treturn libdata\r\n\t},\r\n\tdeleteChan: function(id) {\r\n\t\t$(jq`#chan_${id}`).remove()\r\n\t},\r\n\thighlight: function($chan) {\r\n\t\tlet sect = $chan[0]._libdata.section\r\n\t\t$(jq`.tab[data-tab=${sect}]`).click()\r\n\t\t$chan.addClass('fresh')\r\n\t\ttoggleLib(true)\r\n\t}\r\n}\r\n\r\nvar libchan = {\r\n\tload: function(chan) {\r\n\t\tupForm.toggle()\r\n\r\n\t\tthis.current = chan\r\n\r\n\t\tthis.current.default = +(chan.section == 'default')\r\n\t\tthis.current.included = +chan.included\r\n\r\n\t\tthis.setMode('edit', chan.section)\r\n\r\n\t\t$('#chan-id').val(chan.id)\r\n\t\t$('#chan-name').val(chan.name).trigger('input')\r\n\t\t$('#chan-url').val(chan.url)\r\n\t\t$('#chan-wiki').val(chan.wiki || '')\r\n\t\t$('#chan-userboards').val(chan.userboards || '')\r\n\t\t$('#chan-userboards_catname').val(chan.userboards_catname || '2.0')\r\n\t\t$('#chan-userboards_system').val(chan.userboards_system || 'instant')\r\n\t\t\r\n\t\tball.setBall(chan)\r\n\r\n\t\tlet offset = chan.offset || [0, 0]\r\n\t\t$('#position-tweak-left').val(offset[0])\r\n\t\t$('#position-tweak-top').val(offset[1])\r\n\t\tball.offset()\r\n\r\n\t\t$('#bgc-from')[0].jscolor.fromString(chan.catbg[0])\r\n\t\t$('#bgc-to')[0].jscolor.fromString(chan.catbg[1])\r\n\t\tgradient.update()\r\n\r\n\t\t$('#chan-prefix').val(chan.prefix || '')\r\n\t\t$('#chan-postfix').val(chan.postfix || '')\r\n\r\n\t\ttree.build(chan.boards)\r\n\r\n\t\t$('#custom-css').prop('checked', !!chan.colors)\r\n\t\tif (chan.colors) {\r\n\t\t\t$('#color-theme').show()\r\n\t\t\t$('#bgColor')[0].jscolor.fromString(chan.colors[0])\r\n\t\t\t$('#linkColor')[0].jscolor.fromString(chan.colors[1])\r\n\t\t\tif (chan.advanced_less) {\r\n\t\t\t\t$('#advance-less').prop('checked', 1).trigger('change')\r\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(chan.advanced_less))\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$('#less-enter').val(lessFormatter.prettify(styles.base))\r\n\t\t\t\t$('#advance-less').prop('checked', 0).trigger('change')\r\n\t\t\t}\r\n\t\t\tstyles.update()\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstyles.reset()\r\n\t\t}\r\n\t\t\r\n\t\tif (chan.radio) {\r\n\t\t\t$('#radio-editor').show()\r\n\t\t\tradio.build(chan.radio)\r\n\t\t\t$('#radio').prop('checked', true)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tradio.reset()\r\n\t\t}\r\n\r\n\t\t$('#default').prop('checked', chan.section === 'default')\r\n\t\t$('#included').prop('checked', !!chan.included)\r\n\r\n\t\tthis.rinse()\r\n\t},\r\n\t_schema: {\r\n\t\tintegrity: {\r\n\t\t\trequired: ['id', 'name', 'url', 'boards', 'ball', 'offset', 'catbg'],\r\n\t\t\toptional: ['userboards', 'prefix', 'postfix', 'wiki', 'radio', 'colors', 'advanced_less', 'userboards_catname', 'userboards_system'],\r\n\t\t\tadminOnly: ['default', 'included']\r\n\t\t},\r\n\t\tspecialComps: {\r\n\t\t\tpairs: ['catbg', 'offset', 'colors'],\r\n\t\t\tobjects: ['boards', 'radio'],\r\n\t\t\tisNewBall: ['ball']\r\n\t\t},\r\n\t\tconversions: {\r\n\t\t\ttoFile: ['ball']\r\n\t\t},\r\n\t\tdefaults: {\r\n\t\t\t'': ['userboards', 'prefix', 'postfix', 'wiki'],\r\n\t\t\t'FFFFFF|FFFFFF': ['catbg'],\r\n\t\t\t'0|0': ['offset'],\r\n\t\t\t'2C333D|37C999': ['colors'],\r\n\t\t\t'2.0': ['userboards_catname'],\r\n\t\t\t'instant': ['userboards_system']\r\n\t\t},\r\n\t\tfns: {\r\n\t\t\tobjects: _.eq.bind(_),\r\n\t\t\tpairs: (first, second) => {\r\n\t\t\t\tlet vals = [first, second].map(val => (val instanceof Array) ? val.join('|').toLowerCase() : val)\r\n\t\t\t\treturn vals[0] === vals[1]\r\n\t\t\t},\r\n\t\t\tisNewBall: (cur, nu) => cur ? (nu===cur) : (nu==='default'),\r\n\t\t\ttoFile: v => v.indexOf('data:') === 0 ? v.toBlob() : v\r\n\t\t}\r\n\t},\r\n\tinit: function() {\r\n\t\tlet allProps = []\r\n\t\t, schema = {}\r\n\r\n\t\t_.each(this._schema.integrity, (props, intCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop] = {}\r\n\t\t\t\tschema[prop][intCls] = true\r\n\t\t\t\tif (intCls === 'optional')\r\n\t\t\t\t\tschema[prop].default = null\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.specialComps, (props, cmpCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].eqFn = this._schema.fns[cmpCls]\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.conversions, (props, convCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].conv = this._schema.fns[convCls]\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t_.each(this._schema.defaults, (props, defCls) => {\r\n\t\t\tprops.forEach(prop => {\r\n\t\t\t\tschema[prop].default = defCls\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t/*schema.offset.default = '0|0'\r\n\t\tschema.catbg.default = 'ffffff|ffffff'\r\n*/\r\n\t\tthis.schema = schema\r\n\t},\r\n\tmode: 'new',\r\n\tsetMode: function(mode, section) {\r\n\t\tthis.mode = mode\r\n\t\t$('body').toggleClass('edit-draft', mode === 'edit' && section === 'drafts')\r\n\t\t$('#chan-id, #save-draft').prop('disabled', mode === 'edit' && section !== 'drafts')\r\n\t\t$('#clone-this, #delete-this').prop('disabled', mode === 'new')\r\n\t},\r\n\trinse: () => {\r\n\t\t$('.tipper').setTipperState('question')\r\n\t\t$('input').removeClass('invalid')\r\n\t},\r\n\tcollectData: function(role) {\r\n\t\tlet isDraft = (role === 'draft')\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet chan = {}\r\n\t\t\t, dataPromises = []\r\n\t\t\t// basic data\r\n\t\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'userboards_catname', 'prefix', 'postfix'].forEach(prop => {\r\n\t\t\t\tlet pr = $(jq`#chan-${prop}`)[0].validate(0, isDraft).then(val => {\r\n\t\t\t\t\tchan[prop] = val\r\n\t\t\t\t})\r\n\t\t\t\tdataPromises.push(pr)\r\n\t\t\t})\r\n\t\t\t// ball data\r\n\t\t\tdataPromises.push(ball.getData(isDraft).then(data => {\r\n\t\t\t\t_.assign(chan, data)\r\n\t\t\t}))\r\n\t\t\t// tree data\r\n\t\t\tdataPromises.push(new Promise((resolve, reject) => {\r\n\t\t\t\tlet treeToUI = tree.toggleView('UI', isDraft)\r\n\t\t\t\tif (treeToUI)\r\n\t\t\t\t\tresolve(treeToUI)\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (treeToUI === false)\r\n\t\t\t\t\t\treject()\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet validUI = tree.validateUI(isDraft)\r\n\t\t\t\t\t\tif (validUI)\r\n\t\t\t\t\t\t\tresolve(validUI)\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tchan.boards = (tree.toggleView('UI') === false) ? false : tree.validateUI()\r\n\t\t\t}).then(data => {\r\n\t\t\t\tchan.boards = data\r\n\t\t\t}))\r\n\t\t\tchan.userboards_system = $('#chan-userboards_system').val()\r\n\t\t\t// options: radio\r\n\t\t\tif ($('#radio').prop('checked')) {\r\n\t\t\t\tdataPromises.push(radio.getData(isDraft).then(data => {\r\n\t\t\t\t\tchan.radio = data\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\t// options: styles\r\n\t\t\tif ($('#custom-css').prop('checked')) {\r\n\t\t\t\tdataPromises.push(styles.getData(isDraft).then(data => {\r\n\t\t\t\t\t_.assign(chan, data)\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\t// options: admy\r\n\t\t\tif (IS_ADMIN) {\r\n\t\t\t\tlet admy = {}\r\n\t\t\t\t;['default', 'included'].forEach(prop => {\r\n\t\t\t\t\tadmy[prop] = +$(jq`#${prop}`).prop('checked')\r\n\t\t\t\t})\r\n\t\t\t\t_.assign(chan, admy)\r\n\t\t\t}\r\n\r\n\t\t\tPromise.all(dataPromises).then(() => resolve(chan), () => reject('fix-errors'))\r\n\t\t})\r\n\t},\r\n\tproceedWithData: function(role, isUpload) {\r\n\t\tlet mode = (isUpload && this.current && this.current.section === 'drafts') ? 'new' : this.mode\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet fd = new FormData(), chan = {}\r\n\t\t\t, errors = []\r\n\t\t\tthis.collectData(role).then(data => {\r\n\t\t\t\tif (mode === 'edit' && libchan.current.id !== data.id) {\r\n\t\t\t\t\terrors.push('id-changed')\r\n\t\t\t\t}\r\n\t\t\t\t_.each(this.schema, (propSchema, prop) => {\r\n\t\t\t\t\tlet val\r\n\r\n\t\t\t\t\tif (propSchema.adminOnly && !IS_ADMIN)\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tif (! data.hasOwnProperty(prop)) {\r\n\t\t\t\t\t\tif (propSchema.required)\r\n\t\t\t\t\t\t\terrors.push('fill-required-fields')\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tval = null\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tval = data[prop]\r\n\r\n\t\t\t\t\tif (mode === 'edit' && prop !== 'id') {\r\n\t\t\t\t\t\tlet cur = libchan.current.hasOwnProperty(prop) ? libchan.current[prop] : propSchema.default\r\n\t\t\t\t\t\tif (propSchema.eqFn ? propSchema.eqFn(cur, val) : (cur===val))\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (val === null)\r\n\t\t\t\t\t\treturn\r\n\r\n\t\t\t\t\tchan[prop] = val\r\n\t\t\t\t\tif (role === 'upload') {\r\n\t\t\t\t\t\tif (propSchema.conv)\r\n\t\t\t\t\t\t\tval = propSchema.conv(val)\r\n\t\t\t\t\t\tfd.apnd(prop, val)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tif (errors.length) {\r\n\t\t\t\t\treject(_.uniq(errors))\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (DO_DEBUG)\r\n\t\t\t\t\t\tconsole.log(chan)\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\tobj: chan,\r\n\t\t\t\t\t\tfd: fd\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}, \r\n\t\t\terrors => {\r\n\t\t\t\treject(errors)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tclone: function() {\r\n\t\tthis.setMode('new')\r\n\t\tball.toDataURL()\r\n\t\t$('#chan-id').val('')\r\n\t\t$('#chan-name')[0].value += ' ()'\r\n\t\t$('#chan-name').trigger('input')\r\n\t},\r\n\tclear: function() {\r\n\t\t;['url', 'name', 'id', 'wiki', 'userboards', 'prefix', 'postfix']\r\n\t\t.forEach(field => $(jq`#chan-${field}`).val(''))\r\n\t\t$('#chan-userboards_catname').val('2.0')\r\n\t\tball.clear()\r\n\t\t;['from', 'to'].forEach(field => $(jq`#bgc-${field}`)[0].jscolor.fromString('ffffff'))\r\n\t\tgradient.update()\r\n\t\t;[radio, styles].forEach(w => w.reset())\r\n\t\ttree.build('[]')\r\n\t\ttree.toggleView('UI')\r\n\t\tthis.rinse()\r\n\t\tthis.current = null\r\n\t\tthis.setMode('new')\r\n\t\tupForm.toggle()\r\n\t}\r\n}\r\n\r\nvar drafts = {\r\n\tmodel: [],\r\n\tload: function() {\r\n\t\tlet lsDrafts = localStorage['mydrafts']\r\n\t\tif (lsDrafts) \r\n\t\t\ttry {\r\n\t\t\t\tlet parsed = JSON.parse(lsDrafts)\r\n\t\t\t\tif (typeof parsed !== 'object' || !parsed.hasOwnProperty('chans'))\r\n\t\t\t\t\tthrow new Error()\r\n\t\t\t\tthis.model = parsed.chans\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tconsole.error('Drafts in localStorage are corrupted and will be purged')\r\n\t\t\t\tlocalStorage.removeItem('mydrafts')\r\n\t\t\t}\r\n\t\tlibrary.build(this.model, 'drafts')\r\n\t},\r\n\tremove: function(id) {\r\n\t\tthis.model.splice(_.findIndex(this.model, {id: id}), 1)\r\n\t\tlibrary.deleteChan(id)\r\n\t\tlibchan.setMode('new')\r\n\t\tthis.sync()\r\n\t},\r\n\tadd: function(chan, over) {\r\n\t\tlet libdata = library.addChan(chan, 'drafts', 1)\r\n\t\tthis.model.push(chan)\r\n\t\tlibchan.current = libdata\r\n\t\tlibchan.setMode('edit', 'drafts')\r\n\t},\r\n\tedit: function(chan) {\r\n\t\tlet edited = library.editChan(chan)\r\n\t\tthis.model[_.findIndex(this.model, {id: chan.id})] = edited\r\n\t},\r\n\tsync: function() {\r\n\t\tlocalStorage['mydrafts'] = JSON.stringify({\r\n\t\t\tchans: this.model,\r\n\t\t\tversion: new Date().getTime()\r\n\t\t})\r\n\t},\r\n\tsubmit: function(over) {\r\n\t\tlet newid = $('#chan-id').val()\r\n\t\tif (libchan.mode === 'edit' && libchan.current.id !== newid) {\r\n\t\t\t$(\"#id-to-change\").text(libchan.current.id)\r\n\t\t\tupForm.toggle('prompt pr-idchanged')\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse if (libchan.mode === 'new' && _.find(this.model, {id: newid})) {\r\n\t\t\t$(\"#id-to-overwrite\").text(newid)\r\n\t\t\tlet guro = /(.+?)(\\d+)$/.exec(newid)\r\n\t\t\t$(\"#proposed-id\").text(guro ? `${guro[1]}${(+guro[2])+1}` : `${newid}2`)\r\n\t\t\tupForm.toggle('prompt pr-idexists')\r\n\t\t\treturn\r\n\t\t}\r\n\t\telse {\r\n\t\t\tupForm.toggle()\r\n\t\t}\r\n\t\tlibchan.proceedWithData('draft')\r\n\t\t.then(res => {\r\n\t\t\tlet draft = res.obj\r\n\t\t\tif (libchan.mode === 'edit') {\r\n\t\t\t\tthis.edit(draft)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.add(draft)\r\n\t\t\t}\r\n\t\t\tthis.sync()\r\n\t\t}, errors => {\r\n\t\t\tupForm.showErrors(errors)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nlibchan.init()\r\n\r\nvar lessFormatter = {\r\n\tminify: less => less.replace(/\\n/g, ' ').replace(/\\s{2,}/g, ' ').trim(),\r\n\tprettify: function(less) {\r\n\t\treturn css_beautify(this.minify(less).replace(/([;{}])/g, '$1\\n').replace(/^\\s+/gm, '').trim(), {\r\n\t\t\t'indent_char': '\\t', \r\n\t\t\t'indent_size': 1, \r\n\t\t\t'newline_between_rules': false\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar validations = {\r\n\turlencode: val => encodeURI(val),\r\n\tcheckuniq: (val, prop) => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif(libchan.mode === 'edit' && libchan.current[prop]===val) {\r\n\t\t\t\tresolve()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t$.get(`api.php?checkuniq&prop=${prop}&val=${encodeURIComponent(val)}`)\r\n\t\t\t.then(data => {\r\n\t\t\t\tif (data.error)\r\n\t\t\t\t\treject('occupied')\r\n\t\t\t\telse \r\n\t\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t\t.fail(er => {\r\n\t\t\t\tconsole.error('XHR error during post-validation', er)\r\n\t\t\t\treject('XHR error')\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// eeeee prototypes\r\nNodeList.prototype.forEach = Array.prototype.forEach;\r\nNodeList.prototype.map = Array.prototype.map;\r\nFormData.prototype.apnd = function(k, v) {\r\n\tif (typeof v === 'object' && !( v instanceof Blob ))\r\n\t\tthis.append(k, JSON.stringify(v))\r\n\telse\r\n\t\tthis.append(k, v)\r\n}\r\nFormData.prototype.inspect = function() {\r\n\tfor (var pair of this.entries()) {\r\n\t\tconsole.log(pair[0]+ ' = ' + pair[1]); \r\n\t}\r\n}\r\n// Functions ooriginally from here:\r\n// http://stackoverflow.com/a/30407959/1561204\r\nBlob.prototype.readAsDataURL = function(callback) {\r\n\tlet fr = new FileReader();\r\n\tfr.onload = ev => callback(ev.target.result)\r\n\tfr.readAsDataURL(this);\r\n}\r\nString.prototype.toBlob = function() {\r\n\ttry {\r\n\t\tlet arr = this.split(','), mime = arr[0].match(/:(.*?);/)[1],\r\n\t\t\tbstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\r\n\t\twhile(n--){\r\n\t\t\tu8arr[n] = bstr.charCodeAt(n);\r\n\t\t}\r\n\t\treturn new Blob([u8arr], {type:mime});\r\n\t}\r\n\tcatch (e) {\r\n\t\tconsole.error(e)\r\n\t\treturn false\r\n\t}\r\n}\r\n\r\n// https://davidwalsh.name/convert-image-data-uri-javascript\r\nfunction getDataUri(url, callback) {\r\n\tvar image = new Image();\r\n\r\n\timage.onload = function () {\r\n\t\tvar canvas = document.createElement('canvas');\r\n\t\tcanvas.width = this.naturalWidth;\r\n\t\tcanvas.height = this.naturalHeight;\r\n\t\tcanvas.getContext('2d').drawImage(this, 0, 0);\r\n\t\tcallback(canvas.toDataURL('image/png'));\r\n\t};\r\n\r\n\timage.src = url;\r\n}\r\n\r\nfunction mixedRange(input) {\r\n\tvar m\r\n\t, output = []\r\n\t, re = /(?:([0-9]+)(?:\\-([0-9]+))?(?:, ?)?)/g;\r\n\t\r\n\twhile ((m = re.exec(input)) !== null) {\r\n\t\tif (m.index === re.lastIndex) {\r\n\t\t\tre.lastIndex++;\r\n\t\t}\r\n\t\tif(m[2]) {\r\n\t\t\toutput = output.concat(_.range(m[1], +m[2]+1))\r\n\t\t}\r\n\t\telse\r\n\t\t\toutput.push(+m[1])\r\n\t}\r\n\r\n\treturn output\r\n}\r\n\r\nvar upForm = {\r\n\t$form: null,\r\n\tinit: function() {\r\n\t\tthis.$form = $('#upload-form').on('submit', this.submit.bind(this))\r\n\t\t_.each(this.actorFieldMap, (fields, actor) => {\r\n\t\t\tfields.forEach(field => this.fieldActorMap[field] = actor)\r\n\t\t})\r\n\t},\r\n\ttoggle: function(type) {\r\n\t\tif (! type)\r\n\t\t\tthis.$form.removeClass('expanded')\r\n\t\telse {\r\n\t\t\tthis.$form.removeClass('f-upload f-delete f-prompt pr-idchanged pr-idexists').addClass(`f-${type} expanded`)\r\n\t\t\tlet draftDelete = libchan.current && libchan.current.section === 'drafts' && type === 'delete'\r\n\t\t\t$('#upload-form input').prop('required', !draftDelete)\r\n\t\t\tif (!draftDelete && $('.captcha').hasClass('not-loaded'))\r\n\t\t\t\trefreshCaptcha()\r\n\t\t}\r\n\t},\r\n\tcheckFields: function() {\r\n\t\treturn $('#pswd').val() && $('#captcha').val()\r\n\t},\r\n\tsubmit: function(ev) {\r\n\t\tev.preventDefault()\r\n\t\tlet action = this.$form.hasClass('f-delete') ? 'delete' : 'upload'\r\n\t\tif (libchan.current && libchan.current.section === 'drafts') {\r\n\t\t\tif (action === 'delete') {\r\n\t\t\t\tdrafts.remove(libchan.current.id)\r\n\t\t\t\tthis.toggle()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (! this.checkFields()) \r\n\t\t\treturn this.showErrors('fill-required-fields')\r\n\t\tthis.$form.addClass('busy')\r\n\t\tif (action == 'upload') {\r\n\t\t\tlibchan.proceedWithData(action, true)\r\n\t\t\t.then(res => {\r\n\t\t\t\tthis.candidate = res.obj\r\n\t\t\t\tthis.send(libchan.mode, res.fd)\r\n\t\t\t}, errors => {\r\n\t\t\t\tthis.showErrors(errors)\r\n\t\t\t\tthis.$form.removeClass('busy')\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet fd = new FormData()\r\n\t\t\t$('#chan-id')[0].validate(1).then(id => {\r\n\t\t\t\tfd.apnd('id', id)\r\n\t\t\t\tthis.candidate = {id: id}\r\n\t\t\t\tthis.send('delete', fd)\r\n\t\t\t}, \r\n\t\t\te => console.error(e))\r\n\t\t}\r\n\t},\r\n\tsend: function(action, fd) {\r\n\t\tif (libchan.current && libchan.current.section === 'drafts')\r\n\t\t\taction = 'new'\r\n\t\tfd.apnd('action', action)\r\n\t\tfd.apnd('captcha', $('#captcha').val())\r\n\t\tfd.apnd('password', $('#pswd').val())\r\n\t\tif (DO_DEBUG)\r\n\t\t\tfd.inspect()\r\n\r\n\t\tvar request = new XMLHttpRequest()\r\n\t\trequest.open(\"POST\", \"api.php\")\r\n\t\trequest.send(fd);\r\n\t\tlet _this = this\r\n\t\trequest.onload = function(e) {\r\n\t\t\tif(this.status == 200) {\r\n\t\t\t\tlet res = 0\r\n\t\t\t\ttry {\r\n\t\t\t\t\tres = JSON.parse(this.response)\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\tconsole.warn(this.response)\r\n\t\t\t\t\t_this.unbusy()\r\n\t\t\t\t\t_this.showErrors('invalid-response')\r\n\t\t\t\t}\r\n\t\t\t\tif (res)\r\n\t\t\t\t\t_this.handleResponse(res)\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t_this.unbusy()\r\n\t\t\t\t_this.showErrors('xhr-error')\r\n\t\t\t\tconsole.error(e)\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tshowErrors: mkErrorShower('submit'),\r\n\terrorDescriptors: {\r\n\t\t'fill-required-fields': '  ',\r\n\t\t'xhr-error': ' XHR.   .',\r\n\t\t'invalid-response': ' XHR (  ).   .',\r\n\t\t'id-changed': 'ID   .',\r\n\t\t'nothing-to-edit': ' ',\r\n\t\t'missing': '  ',\r\n\t\t'wrong-captcha': '  ',\r\n\t\t'wrong-password': ' ',\r\n\t\t'fix-errors': ' !',\r\n\t\t'db-error': '    ',\r\n\t\t'not-admin': ',   ',\r\n\t\t'wrong-value': ' ',\r\n\t\t'chan-does-not-exist': '   '\r\n\t},\r\n\tactorFieldMap: {\r\n\t\tball: ['ball', 'catbg', 'offset'],\r\n\t\tstyles: ['colors', 'advanced_less'],\r\n\t\ttree: ['boards'],\r\n\t\tradio: ['radio'],\r\n\t\tadmin: ['admin']\r\n\t},\r\n\tfieldActorMap: {},\r\n\tunbusy: function() {\r\n\t\tthis.$form.removeClass('busy')\r\n\t\trefreshCaptcha()\r\n\t},\r\n\thandleResponse: function(res) {\r\n\t\tthis.unbusy()\r\n\t\tif (res.error) {\r\n\t\t\tlet errors = res.error\r\n\t\t\tif (! (errors instanceof Array)) \r\n\t\t\t\terrors = [errors]\r\n\t\t\terrors = errors.map(err => {\r\n\t\t\t\tif (! err.field) {\r\n\t\t\t\t\terr = {\r\n\t\t\t\t\t\tfield: this,\r\n\t\t\t\t\t\tmsg: err\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet $input = $(jq`#chan-${err.field}`)\r\n\t\t\t\t\tif ($input.length && $input[0].showErrors) {\r\n\t\t\t\t\t\terr.field = $input[0]\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (this.fieldActorMap.hasOwnProperty(err.field)) {\r\n\t\t\t\t\t\t\terr.field = window[this.fieldActorMap[err.field]]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\terr.field = this\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\treturn err\r\n\t\t\t})\r\n\t\t\tlet fields = _.uniq(_.pluck(errors, 'field'))\r\n\t\t\tif (! _.includes(fields, this)) {\r\n\t\t\t\terrors.push({\r\n\t\t\t\t\tfield: this,\r\n\t\t\t\t\tmsg: 'fix-errors'\r\n\t\t\t\t})\r\n\t\t\t\tfields.push(this)\r\n\t\t\t}\r\n\t\t\tfields.forEach(field => {\r\n\t\t\t\tlet messages = _.pluck(_.filter(errors, {field: field}), 'msg')\r\n\t\t\t\t.map(msg => this.errorDescriptors[msg] || msg)\r\n\t\t\t\tfield.showErrors(_.uniq(messages))\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.showErrors([])\r\n\t\t\tif (res.action === 'new-success') {\r\n\t\t\t\t// library.deleteChan(upForm.candidate.id)\r\n\t\t\t\tdrafts.remove(upForm.candidate.id)\r\n\t\t\t\tdelete this.candidate.ball\r\n\t\t\t\tlet sect = (this.candidate.section && this.candidate.section === 'default') ? 'default' : 'custom'\r\n\t\t\t\tlet added = library.addChan(this.candidate, sect, true)\r\n\t\t\t\tlibchan.load(added)\r\n\t\t\t\tconsole.log(upForm.candidate.id, this.candidate, sect);\r\n\t\t\t\t// libchan.setMode('edit', sect)\r\n\t\t\t}\r\n\t\t\tif (res.action === 'edit-success') {\r\n\t\t\t\tif (res.moveto) {\r\n\t\t\t\t\t// console.log(`Gotta move it to ${res.moveto}`);\r\n\t\t\t\t\tthis.candidate.section = res.moveto\r\n\t\t\t\t}\r\n\t\t\t\tlet edited = library.editChan(this.candidate)\r\n\t\t\t\tlibchan.load(edited)\r\n\t\t\t}\r\n\t\t\tif (res.action === 'delete-success') {\r\n\t\t\t\tlibrary.deleteChan(this.candidate.id)\r\n\t\t\t\tlibchan.setMode('new', 'draft')\r\n\t\t\t}\r\n\t\t\tthis.toggle()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst DO_DEBUG = false;\r\n\r\nfunction makeEscapeTagLiteralFn(fn = v => v) {\r\n  return function(strings, ...values) {\r\n    let result = \"\"\r\n    for (let i = 0; i < strings.length; i++) {\r\n      result += strings[i]\r\n      if (i < values.length) {\r\n        result += fn(''+values[i])\r\n      }\r\n    }\r\n    return result\r\n  }\r\n}\r\n// Escape tag literal functions for jQuery queries and regular expressions\r\nvar jq = makeEscapeTagLiteralFn(v => v.replace(/([!\"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^`{|}~ ])/g, \"\\\\$1\"))\r\n, escHTML = makeEscapeTagLiteralFn(_.escape)\r\n\r\nfunction LSfetchJSON(key) {\r\n  let val = null, data = localStorage[key]\r\n  if (typeof data !== 'undefined') {\r\n    try {\r\n      val = JSON.parse(data)\r\n    }\r\n    catch(e) {\r\n      console.error(e)\r\n      localStorage.removeItem(key)\r\n    }\r\n  }\r\n  return val\r\n}\r\n\r\nfunction downloadJSON(obj, name) {\r\n\tvar dlAnchorElem = document.getElementById('dl-victim')\r\n\tdlAnchorElem.setAttribute(\"href\", \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(obj)))\r\n\tdlAnchorElem.setAttribute(\"download\", `${name}.json`)\r\n\tdlAnchorElem.click()\r\n}"]}