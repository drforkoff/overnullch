"use strict";var _templateObject=_taggedTemplateLiteral(["#tab-",""],["#tab-",""]),_templateObject2=_taggedTemplateLiteral(["<div class=\"errmsgbox\" onclick=\"this.remove()\">\n\t\t\t<svg id=\"close-errmsg\" class=\"icon\"><use xlink:href=\"#i-x\"></use></svg>\n\t\t\t<p class=\"error-message\">","</p>\n\t\t</div>"],["<div class=\"errmsgbox\" onclick=\"this.remove()\">\n\t\t\t<svg id=\"close-errmsg\" class=\"icon\"><use xlink:href=\"#i-x\"></use></svg>\n\t\t\t<p class=\"error-message\">","</p>\n\t\t</div>"]),_templateObject3=_taggedTemplateLiteral(["#cat_",""],["#cat_",""]),_templateObject4=_taggedTemplateLiteral(["/chans/balls/","/",".png?uid=","",""],["/chans/balls/","/",".png?uid=","",""]),_templateObject5=_taggedTemplateLiteral(["<li class=\"list-chan\" id=\"installed_","\" data-id=\"","\">\n\t\t\t<img src=\"","\" class=\"list-chanball\">\n\t\t\t<div class=\"dragger\"><svg class=\"icon\"><use xlink:href=\"#i-drag\"></use></div>\n\t\t\t<div class=\"list-chan-title\">","</div>\n\t\t\t<div class=\"delete-chan\" onclick=\"javascript:list.remove('","')\"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></div>\n\t\t</li>"],["<li class=\"list-chan\" id=\"installed_","\" data-id=\"","\">\n\t\t\t<img src=\"","\" class=\"list-chanball\">\n\t\t\t<div class=\"dragger\"><svg class=\"icon\"><use xlink:href=\"#i-drag\"></use></div>\n\t\t\t<div class=\"list-chan-title\">","</div>\n\t\t\t<div class=\"delete-chan\" onclick=\"javascript:list.remove('","')\"><svg class=\"icon\"><use xlink:href=\"#i-x\"></use></div>\n\t\t</li>"]),_templateObject6=_taggedTemplateLiteral(["#installed_",""],["#installed_",""]),_templateObject7=_taggedTemplateLiteral(["<div class=\"cat-chan sect-"," ","\" data-search=\"","\" id=\"cat_","\">\n\t\t\t<div class=\"cc-ball-wrap\" style=\"","\">\n\t\t\t\t<img src=\"","\" class=\"cc-ball\" ","></img>\n\t\t\t\t<div class=\"channame-overlay\">\n\t\t\t\t\t<a href=\"","\">","</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"cc-toolbar\">\n\t\t\t\t<button class=\"cc-install\">\n\t\t\t\t\t<span class=\"cci-i\">\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C</span>\n\t\t\t\t\t<span class=\"cci-u\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"chan-options make-embed\" title=\"\u041A\u043E\u0434 \u0434\u043B\u044F \u043A\u043D\u043E\u043F\u043A\u0438\">\n\t\t\t\t<svg class=\"icon\">\n\t\t\t\t\t<use class=\"co-code\" xlink:href=\"#i-code\"></use>\n\t\t\t\t\t<use class=\"co-close\" xlink:href=\"#i-x\"></use>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t\t<a class=\"chan-options info-link\" target=\"_blank\" href=\"","\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\">\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg>\n\t\t\t</a>\n\t\t\t<textarea onclick=\"this.select()\">","</textarea>\n\t\t</div>"],["<div class=\"cat-chan sect-"," ","\" data-search=\"","\" id=\"cat_","\">\n\t\t\t<div class=\"cc-ball-wrap\" style=\"","\">\n\t\t\t\t<img src=\"","\" class=\"cc-ball\" ","></img>\n\t\t\t\t<div class=\"channame-overlay\">\n\t\t\t\t\t<a href=\"","\">","</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"cc-toolbar\">\n\t\t\t\t<button class=\"cc-install\">\n\t\t\t\t\t<span class=\"cci-i\">\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C</span>\n\t\t\t\t\t<span class=\"cci-u\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"chan-options make-embed\" title=\"\u041A\u043E\u0434 \u0434\u043B\u044F \u043A\u043D\u043E\u043F\u043A\u0438\">\n\t\t\t\t<svg class=\"icon\">\n\t\t\t\t\t<use class=\"co-code\" xlink:href=\"#i-code\"></use>\n\t\t\t\t\t<use class=\"co-close\" xlink:href=\"#i-x\"></use>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t\t<a class=\"chan-options info-link\" target=\"_blank\" href=\"","\" title=\"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F\">\n\t\t\t\t<svg class=\"icon\"><use xlink:href=\"#i-info\"></use></svg>\n\t\t\t</a>\n\t\t\t<textarea onclick=\"this.select()\">","</textarea>\n\t\t</div>"]);function _taggedTemplateLiteral(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}var main=function(){$.ajaxSetup({dataType:"json"}),$("#drawer, #hijab").click(function(){return $("body").toggleClass("list-collapsed")});var a=[new Promise(function(a,b){$.getJSON("/chans/chans.json?v=".concat(new Date().getTime())).done(function(b){catalog.add(b.chans),a({origin:"server",version:b.version})}).fail(function(a){return b(a)})})];if(localStorage.mydrafts){var c=null;try{c=JSON.parse(localStorage.mydrafts),catalog.myDraftsRaw=_.cloneDeep(c.chans)}catch(a){localStorage.removeItem("mydrafts"),console.error(a)}c.chans&&a.push(new Promise(function(a){var b=[];c.chans.forEach(function(a){a.name&&a.url&&a.id&&a.id.match(/^[a-z\-_0-9]+$/)?(a.originalID=a.id,a.id+="!draft",b.push(a)):errorBoy.pushError("\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A #".concat(a.id," \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u0430\u0442\u0430\u043B\u043E\u0433: \u043D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u043B\u0438 \u043D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 ID."))}),catalog.add(b,"drafts"),a({origin:"drafts",version:c.version})}))}Promise.all(a).then(list.init.bind(list),function(a){return console.error(a)}),$(".tab").click(function(a){var b=$(this).parent().find(".icon");if("block"===b.css("display")&&1==b.css("opacity"))a.stopPropagation(),$("#catalog header").addClass("tab-selecting");else{var c=$(this).text().toLowerCase();switchTab(c)}});var b=localStorage["cat-tab"];b&&switchTab(b),$("#toggle-search").click(function(){$("#catalog").addClass("searching"),$("#search").focus()}),$("#search").on("input",function(){var a=$(this).val().trim().toLowerCase();$("#catalog").toggleClass("search-filter",!!a.length),injector.inject("cat-search",".search-filter .cat-chan[data-search *= \"".concat(a,"\"] {display: inline-block}"))}),$("#cancel-search").click(function(){$("#catalog").removeClass("searching search-filter"),$("#search").val("")}),$("body").click(function(){return $("#catalog header").removeClass("tab-selecting")}).on("click",".cc-install",function(){var a=$(this).parents(".cat-chan");list.toggle(a[0]._libdata)}).on("click",".make-embed",function(){$(this).parents(".cat-chan").toggleClass("code-on")}).on("dragenter dragend dragover drop dragleave",function(a){a.preventDefault(),a.stopPropagation()}).on("drop",function(a){return handleFile(a.originalEvent)}),$("#up-victim").on("change",function(a){return handleFile(a.originalEvent)}),$("#import-draft").click(function(){return $("#up-victim").click()})};function switchTab(a){$(".tab").removeClass("tab-selected"),$(jq(_templateObject,a)).addClass("tab-selected"),$("#catalog").removeClass("tab-default tab-custom tab-drafts").addClass("tab-".concat(a)),localStorage["cat-tab"]=a}var errorBoy={pushError:function b(a){$("#error-wrapper").append(html(_templateObject2,_.escape(a)))}},list={init:function e(a){var b={};a.forEach(function(a){return b[a.origin]=a.origin}),this.versions=b,localStorage.catalogVersions=JSON.stringify(b),this.sortable=Sortable.create(document.querySelector("#boardlist"),{handle:".dragger",animation:150,onSort:this.sync.bind(this)});var c=localStorage.myChans_new,d=[];if(c){try{c=JSON.parse(c)}catch(a){console.error(a),localStorage.removeItem("myChans_new"),c=null}c&&c.length&&c.forEach(function(a){var b=catalog.chanByID(a.id);b&&d.push(b)})}c||$(".included-chan").each(function(){d.push(this._libdata)}),this.add(d)},add:function c(a){var b=this;arrayify(a).forEach(function(a){["catbg","offset"].forEach(function(b){return delete a[b]});var c=$(b.buildChan(a));c[0]._libdata=a,$("#boardlist").append(c),$(jq(_templateObject3,a.id)).addClass("installed")}),this.sync()},buildChan:function d(a){var b=_.escape(a.name),c=a.ball||html(_templateObject4,a.section,"drafts"==a.section?"no-ball":a.id,a._id,a.ballv?"&v=".concat(a.ballv):"");return html(_templateObject5,a.id,a.id,c,b||"\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438",a.id)},toggle:function b(a){_.includes(this.sortable.toArray(),a.id)?this.remove(a.id):this.add(a)},remove:function b(a){$(jq(_templateObject6,a)).remove(),$(jq(_templateObject3,a)).removeClass("installed"),this.sync()},sync:function b(){var a=[];document.querySelectorAll(".list-chan").forEach(function(b){a.push(b._libdata)}),localStorage.removeItem("compiledCSS"),localStorage.myChans_new=JSON.stringify(a)}},catalog={add:function d(a,b){var c=this;arrayify(a).forEach(function(a){a.section||(a.section=b||(a.default?"default":"custom")),a.url=_.escape(a.url);var d=$(c.buildChan(a));d[0]._libdata=a,$("#catalog-contents").append(d)}),$("#import-draft").insertAfter(".cat-chan:last")},buildChan:function f(a){var b=_.escape(a.name),c=a.wiki&&a.wiki.match(/https?:\/\//)?a.wiki:conf.wiki+(a.wiki||b),d="".concat(a.originalID||a.id," ").concat(b," ").concat(a.url.replace(/^https?:\/\//,"")," ").concat((a.wiki||"").replace(/^https?:\/\//,"")),e=a.ball||"/chans/balls/".concat(a.section,"/").concat("drafts"==a.section?"no-ball":a.id,".png?uid=").concat(a._id).concat(a.ballv?"&v=".concat(a.ballv):"");return html(_templateObject7,a.section,a.included?"included-chan":"",d.toLowerCase(),a.id,makeGradient(a.catbg),e,a.offset?makeOffset(a.offset):"",a.url,b,c,_.escape("<script src=\"".concat(document.location.origin||document.location.protocol+"//"+document.location.host,"/embed/add.js\" chan=\"").concat(a.id,"\"></script>")))},chanByID:function c(a){var b=document.querySelector(jq(_templateObject3,a));return b&&b._libdata?b._libdata:null},myDraftsRaw:[],syncRawDrafts:function a(){localStorage.mydrafts=JSON.stringify({version:new Date().getTime(),chans:this.myDraftsRaw})}};function arrayify(a){return a instanceof Array?a:[a]}var injector={inject:function g(a,b){var c="injector:".concat(a),d=document.getElementById(c);if(d)return void(d.innerHTML=b);var e=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css",f.id=c,f.styleSheet?f.styleSheet.cssText=b:f.appendChild(document.createTextNode(b)),e.appendChild(f)},remove:function e(a){var b="injector:".concat(a),c=document.getElementById(b);if(c){var d=document.head||document.getElementsByTagName("head")[0];d&&d.removeChild(document.getElementById(b))}}};function makeGradient(a){var b="linear-gradient(to bottom, #".concat(a[0]," 0%, #").concat(a[1]," 100%)"),c=/(((?:radial|linear)-gradient)\((?:(ellipse) at center|(-?[0-9]+)deg|to (right|bottom)), ?(.+)\));?/i.exec(b);if(null===c)return"background:"+b;c=_.rest(_.without(c,void 0));var d,e=c[0]+"; ",f=c[1];d=isNaN(c[2])?"bottom"==c[2]?"top, ":"right"==c[2]?"left, ":"center, ellipse cover, ":90-parseFloat(c[2])+"deg, ";var g=c[3];return _.each(["-o-","-webkit-","-moz-"],function(a){e+="background:"+a+f+"("+d+g+"); "}),"background:"+e}function makeOffset(a){var b=a[0],c=a[1],d="";return 0==b&&0==c?d:(["","-webkit-","-ms-","-moz-","-o-"].forEach(function(a){d+="".concat(a,"transform: translate(").concat(b,"px, ").concat(c,"px); ")}),"style=\"".concat(d,"\""))}NodeList.prototype.forEach=Array.prototype.forEach;function makeEscapeTagLiteralFn(a){return function(b){for(var c="",d=0;d<b.length;d++)c+=b[d],d<(1>=arguments.length?0:arguments.length-1)&&(c+=a(1>d+1||arguments.length<=d+1?void 0:arguments[d+1]));return c}}var jq=makeEscapeTagLiteralFn(function(a){return a.replace(/([!"#$%&'()*+,\-./:;<=>?@[\\\]^`{|}~ ])/g,"\\$1")}),conf={wiki:"http://wiki.1chan.ca/"};function reloadFrame(){parent.frames.list.document.location.reload(),parent.openMenu()}window.addEventListener("message",function(){parent.frames.live.document.location.reload()},!1);function handleFile(a){var b="drop"==a.type?a.dataTransfer.files:a.target.files,c=b[0];if(c){var d=new FileReader;d.onload=function(){return function(a){var b=null;try{b=JSON.parse(a.target.result)}catch(a){errorBoy.pushError("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0440\u0430\u0437\u043E\u0431\u0440\u0430\u0442\u044C JSON")}if(b){if(!(b.name&&b.url&&b.id&&b.id.match(/^[a-z\-_0-9]+$/)))return void errorBoy.pushError("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A. \u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u0434\u0430\u043D\u043D\u044B\u0445.");if(_.find(catalog.myDraftsRaw,{id:b.id}))return void errorBoy.pushError("\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u0441 \u0442\u0430\u043A\u0438\u043C id \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442");catalog.myDraftsRaw.push(_.cloneDeep(b)),catalog.syncRawDrafts(),b.id+="!draft",catalog.add(b,"drafts")}}.bind(this)}.bind(this)(c),d.readAsText(c)}}console.info("\u042F \u043D\u0435 \u043D\u0430 \u0430\u043D\u0433\u0443\u043B\u044F\u0440\u0435. \u041D\u0435 \u043D\u0430 \u0430\u043D\u0433\u0443\u043B\u044F\u0440\u0435.");
//# sourceMappingURL=catalog.js.map