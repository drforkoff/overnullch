{"version":3,"sources":["../../babel/src/live.js"],"names":["main","location","search","_url","exec","_description","decodeURIComponent","$","val","ajaxSetup","dataType","click","parent","toggleShare","on","ev","preventDefault","addClass","post","url","description","done","handleResponse","bind","removeClass","data","error","err","text","errorDescriptors","hasOwnProperty","errtype","errdata","inFrame","_frames","frames","list","live","build","toggle","layout","menu","open","setTimeout","secs"],"mappings":"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","file":"live.js","sourcesContent":["\"use strict\"\r\n\r\nfunction main() {\r\n  if (location.search) {\r\n    let _url = /url=([^&]+)/.exec(location.search)\r\n    , _description = /description=([^&]+)/.exec(location.search)\r\n    if (_url) {\r\n      _url = decodeURIComponent(_url[1])\r\n      $('#url').val(_url)\r\n    }\r\n    if (_description) {\r\n      _description = decodeURIComponent(_description[1])\r\n      $('#description').val(_description)\r\n    }\r\n  }\r\n\r\n\t$.ajaxSetup({ dataType: 'json' })\r\n  $('#closer').click(parent.toggleShare)\r\n  $('form').on('submit', function(ev) {\r\n  \tev.preventDefault()\r\n  \t$(this).addClass('busy')\r\n  \t$.post('api.php', {\r\n  \t\turl: $('#url').val(),\r\n  \t\tdescription: $('#description').val()\r\n  \t})\r\n  \t.done(handleResponse.bind(this))\r\n  })\r\n  $('#error-wrapper').click(() => $('form').removeClass('error'))\r\n}\r\n\r\nfunction handleResponse(data) {\r\n\t$('form').removeClass('busy'); \r\n\tif (data.error) {\r\n\t\tlet err = data.error\r\n\t\t$('form').addClass('error'); \r\n\t\t$('#errorbox')\r\n\t\t.text(typeof err === 'string'\r\n\t\t\t? errorDescriptors[err] || err\r\n\t\t\t: (errorDescriptors.hasOwnProperty(err.errtype)\r\n\t\t\t\t? errorDescriptors[err.errtype](err.errdata)\r\n\t\t\t\t: `${err.errtype} (${err.errdata})`)\r\n\t\t)\r\n\t}\r\n\telse {\r\n    let inFrame = false;\r\n    if (parent._frames && parent.frames.list && parent.frames.live) {\r\n      parent.frames.list.live.build(data.data)\r\n      parent.frames.list.live.toggle(true)\r\n      if (parent._frames.layout == 'horizontal') {\r\n        parent.frames.list.menu.open()\r\n      }\r\n      inFrame = true;\r\n    }\r\n\t\t$('form').addClass('success'); \r\n\t\tsetTimeout(() => {\r\n      if (inFrame) {\r\n        parent.$('#live').removeClass('shown'); \r\n      }\r\n\t\t\t$('input').val('')\r\n\t\t}, 1500)\r\n\t\tsetTimeout(() => {\r\n\t\t\t$('form').removeClass('success');\r\n\t\t}, 2000)\r\n\t}\r\n}\r\n\r\nconst errorDescriptors = {\r\n\t'no-data-provided': 'Недостаточно данных',\r\n\t'url-too-long': 'Слишком длинный URL',\r\n\t'description-too-long': 'Слишком длинное описание',\r\n\t'description-too-short': 'Слишком короткое описание',\r\n\t'bad-url': 'Неверный формат SQL',\r\n\t'url-exists': 'Данная ссылка уже присутствует в списке',\r\n\t'timeout': secs => `Таймаут ${secs} сек.`,\r\n\t'sql-error': 'Ошибка SQL'\r\n}"]}